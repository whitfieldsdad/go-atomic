{
  "id": "01df0353-d531-408d-a0c5-3161bf822134",
  "name": "Compress Data and lock with password for Exfiltration with winzip",
  "description": "Note: Requires winzip installation\nwzzip sample.zip -s\"blueblue\" *.txt (VARIANT)\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "b35de5b9-77e2-4d09-a34a-08b75b729613",
      "type": "execute-command",
      "data": {
        "command": "path=%path%;\"C:\\Program Files (x86)\\winzip\"\nmkdir .\\tmp\\victim-files\ncd .\\tmp\\victim-files\necho \"This file will be encrypted\" \u003e .\\encrypted_file.txt\n\"#{winzip_exe}\" -min -a -s\"hello\" archive.zip *\ndir\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "06519202-2bc6-46f0-9199-1672764a4c7e",
      "name": "Check dependency 1/1",
      "description": "Winzip must be installed\n",
      "type": "execute-command",
      "data": {
        "command": "cmd /c 'if not exist \"#{winzip_exe}\" (echo 1) else (echo 0)'\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "9f98f9cd-5ecc-40cf-95c7-4ecc2fb6972e",
      "name": "Resolve dependency 1/1",
      "description": "Winzip must be installed\n",
      "type": "execute-command",
      "data": {
        "command": "IEX(IWR \"https://raw.githubusercontent.com/redcanaryco/invoke-atomicredteam/master/Public/Invoke-WebRequestVerifyHash.ps1\" -UseBasicParsing)\nNew-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nif(Invoke-WebRequestVerifyHash \"#{winzip_url}\" \"PathToAtomicsFolder\\..\\ExternalPayloads\\winzip.exe\" #{winzip_hash}){\n  Write-Host Follow the installation prompts to continue\n  cmd /c \"PathToAtomicsFolder\\..\\ExternalPayloads\\winzip.exe\"\n}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "5d4d4e35-4794-4fc0-9f67-584cea78b446",
      "name": "Re-check dependency 1/1",
      "description": "Winzip must be installed\n",
      "type": "execute-command",
      "data": {
        "command": "cmd /c 'if not exist \"#{winzip_exe}\" (echo 1) else (echo 0)'\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "06519202-2bc6-46f0-9199-1672764a4c7e",
      "p": "on-success",
      "o": "b35de5b9-77e2-4d09-a34a-08b75b729613"
    },
    {
      "s": "06519202-2bc6-46f0-9199-1672764a4c7e",
      "p": "on-failure",
      "o": "9f98f9cd-5ecc-40cf-95c7-4ecc2fb6972e"
    },
    {
      "s": "9f98f9cd-5ecc-40cf-95c7-4ecc2fb6972e",
      "p": "on-success",
      "o": "5d4d4e35-4794-4fc0-9f67-584cea78b446"
    },
    {
      "s": "5d4d4e35-4794-4fc0-9f67-584cea78b446",
      "p": "on-failure",
      "o": "b35de5b9-77e2-4d09-a34a-08b75b729613"
    }
  ],
  "tags": [
    "T1560.001",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "winzip_exe",
      "type": "path",
      "description": "Path to installed Winzip executable",
      "value": "%ProgramFiles%\\WinZip\\winzip64.exe"
    },
    {
      "name": "winzip_url",
      "type": "url",
      "description": "Path to download Windows Credential Editor zip file",
      "value": "https://download.winzip.com/gl/nkln/winzip24-home.exe"
    },
    {
      "name": "winzip_hash",
      "type": "string",
      "description": "File hash of the Windows Credential Editor zip file",
      "value": "B59DB592B924E963C21DA8709417AC0504F6158CFCB12FE5536F4A0E0D57D7FB"
    }
  ]
}