{
  "id": "fd3c1c6a-02d2-4b72-82d9-71c527abb126",
  "name": "Regsvcs Uninstall Method Call Test",
  "description": "Executes the Uninstall Method, No Admin Rights Required, Requires SNK. Upon execution, \"I shouldn't really execute\" will be displayed\nalong with other information about the assembly being installed.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "38d17555-610f-4923-83fd-c148ca814670",
      "type": "execute-command",
      "data": {
        "command": "$key = 'BwIAAAAkAABSU0EyAAQAAAEAAQBhXtvkSeH85E31z64cAX+X2PWGc6DHP9VaoD13CljtYau9SesUzKVLJdHphY5ppg5clHIGaL7nZbp6qukLH0lLEq/vW979GWzVAgSZaGVCFpuk6p1y69cSr3STlzljJrY76JIjeS4+RhbdWHp99y8QhwRllOC0qu/WxZaffHS2te/PKzIiTuFfcP46qxQoLR8s3QZhAJBnn9TGJkbix8MTgEt7hD1DC2hXv7dKaC531ZWqGXB54OnuvFbD5P2t+vyvZuHNmAy3pX0BDXqwEfoZZ+hiIk1YUDSNOE79zwnpVP1+BN0PK5QCPCS+6zujfRlQpJ+nfHLLicweJ9uT7OG3g/P+JpXGN0/+Hitolufo7Ucjh+WvZAU//dzrGny5stQtTmLxdhZbOsNDJpsqnzwEUfL5+o8OhujBHDm/ZQ0361mVsSVWrmgDPKHGGRx+7FbdgpBEq3m15/4zzg343V9NBwt1+qZU+TSVPU0wRvkWiZRerjmDdehJIboWsx4V8aiWx8FPPngEmNz89tBAQ8zbIrJFfmtYnj1fFmkNu3lglOefcacyYEHPX/tqcBuBIg/cpcDHps/6SGCCciX3tufnEeDMAQjmLku8X4zHcgJx6FpVK7qeEuvyV0OGKvNor9b/WKQHIHjkzG+z6nWHMoMYV5VMTZ0jLM5aZQ6ypwmFZaNmtL6KDzKv8L1YN2TkKjXEoWulXNliBpelsSJyuICplrCTPGGSxPGihT3rpZ9tbLZUefrFnLNiHfVjNi53Yg4='\n$Content = [System.Convert]::FromBase64String($key)\nSet-Content $env:Temp\\key.snk -Value $Content -Encoding Byte\nC:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\csc.exe /r:System.EnterpriseServices.dll /out:\"#{output_file}\" /target:library /keyfile:$env:Temp\\key.snk #{source_file}\nC:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\regsvcs.exe #{output_file}\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "2608c4bf-1bf1-47cc-a31b-08856ea72c33",
      "type": "execute-command",
      "data": {
        "command": "Remove-Item #{output_file} -ErrorAction Ignore | Out-Null\n$parentpath = Split-Path -Path \"#{output_file}\"\nRemove-Item $parentpath\\key.snk -ErrorAction Ignore | Out-Null\nRemove-Item $parentpath\\T1218.009.tlb -ErrorAction Ignore | Out-Null\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "58763f3e-25ec-4dac-b87a-e1dcf6b32d6f",
      "name": "Check dependency 1/1",
      "description": "The CSharp source file must exist on disk at specified location (#{source_file})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{source_file}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "4e8f1315-9f85-4adf-bf22-5850a430a550",
      "name": "Resolve dependency 1/1",
      "description": "The CSharp source file must exist on disk at specified location (#{source_file})\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory (split-path \"#{source_file}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1218.009/src/T1218.009.cs\" -OutFile \"#{source_file}\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "7e08f1e9-8b30-45c1-bab9-7da8011373ee",
      "name": "Re-check dependency 1/1",
      "description": "The CSharp source file must exist on disk at specified location (#{source_file})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{source_file}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "38d17555-610f-4923-83fd-c148ca814670",
      "p": "on-success",
      "o": "2608c4bf-1bf1-47cc-a31b-08856ea72c33"
    },
    {
      "s": "38d17555-610f-4923-83fd-c148ca814670",
      "p": "on-failure",
      "o": "2608c4bf-1bf1-47cc-a31b-08856ea72c33"
    },
    {
      "s": "58763f3e-25ec-4dac-b87a-e1dcf6b32d6f",
      "p": "on-success",
      "o": "38d17555-610f-4923-83fd-c148ca814670"
    },
    {
      "s": "58763f3e-25ec-4dac-b87a-e1dcf6b32d6f",
      "p": "on-failure",
      "o": "4e8f1315-9f85-4adf-bf22-5850a430a550"
    },
    {
      "s": "4e8f1315-9f85-4adf-bf22-5850a430a550",
      "p": "on-success",
      "o": "7e08f1e9-8b30-45c1-bab9-7da8011373ee"
    },
    {
      "s": "7e08f1e9-8b30-45c1-bab9-7da8011373ee",
      "p": "on-failure",
      "o": "38d17555-610f-4923-83fd-c148ca814670"
    }
  ],
  "tags": [
    "T1218.009",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "source_file",
      "type": "path",
      "description": "Location of the CSharp source_file",
      "value": "PathToAtomicsFolder\\T1218.009\\src\\T1218.009.cs"
    },
    {
      "name": "output_file",
      "type": "path",
      "description": "Location of the payload",
      "value": "$Env:TEMP\\T1218.009.dll"
    }
  ]
}