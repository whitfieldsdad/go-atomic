{
  "id": "64b12afc-18b8-4d3f-9eab-7f6cae7c73f9",
  "name": "Remove the Zone.Identifier alternate data stream",
  "description": "Remove the Zone.Identifier alternate data stream which identifies the file as downloaded from the internet.\nRemoving this allows more freedom in executing scripts in PowerShell and avoids opening files in protected view.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "12b3aa92-f9ee-4d37-a4d5-49599ee608ad",
      "type": "execute-command",
      "data": {
        "command": "Unblock-File -Path #{file_path}",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "b49b3e57-dae6-4df1-a654-f6307d4f5d98",
      "type": "execute-command",
      "data": {
        "command": "Set-Content -Path #{file_path} -Stream Zone.Identifier -Value '[ZoneTransfer]','ZoneId=3'",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "3c976052-c4d4-4cba-81f8-5a1a1b4c84ef",
      "name": "Check dependency 1/1",
      "description": "A test file with the Zone.Identifier attribute must be present.",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path #{file_path}) { EXIT 0 } else { EXIT 1 }",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "981f6ec7-2b0d-4816-97ed-6831677b664f",
      "name": "Resolve dependency 1/1",
      "description": "A test file with the Zone.Identifier attribute must be present.",
      "type": "execute-command",
      "data": {
        "command": "Invoke-WebRequest #{file_to_download} -OutFile #{file_path}\nSet-Content -Path #{file_path} -Stream Zone.Identifier -Value '[ZoneTransfer]','ZoneId=3'",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "94186b0b-3be5-4744-aeba-f8aa28695334",
      "name": "Re-check dependency 1/1",
      "description": "A test file with the Zone.Identifier attribute must be present.",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path #{file_path}) { EXIT 0 } else { EXIT 1 }",
        "command_type": "powershell"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "12b3aa92-f9ee-4d37-a4d5-49599ee608ad",
      "p": "on-success",
      "o": "b49b3e57-dae6-4df1-a654-f6307d4f5d98"
    },
    {
      "s": "12b3aa92-f9ee-4d37-a4d5-49599ee608ad",
      "p": "on-failure",
      "o": "b49b3e57-dae6-4df1-a654-f6307d4f5d98"
    },
    {
      "s": "3c976052-c4d4-4cba-81f8-5a1a1b4c84ef",
      "p": "on-success",
      "o": "12b3aa92-f9ee-4d37-a4d5-49599ee608ad"
    },
    {
      "s": "3c976052-c4d4-4cba-81f8-5a1a1b4c84ef",
      "p": "on-failure",
      "o": "981f6ec7-2b0d-4816-97ed-6831677b664f"
    },
    {
      "s": "981f6ec7-2b0d-4816-97ed-6831677b664f",
      "p": "on-success",
      "o": "94186b0b-3be5-4744-aeba-f8aa28695334"
    },
    {
      "s": "94186b0b-3be5-4744-aeba-f8aa28695334",
      "p": "on-failure",
      "o": "12b3aa92-f9ee-4d37-a4d5-49599ee608ad"
    }
  ],
  "tags": [
    "T1553",
    "T1553.005"
  ],
  "input_arguments": [
    {
      "name": "file_to_download",
      "type": "url",
      "description": "File that will be downloaded to test against.",
      "value": "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/README.md"
    },
    {
      "name": "file_path",
      "type": "string",
      "description": "File to have the Zone.Identifier removed.",
      "value": "$env:tmp\\ReadMe.md"
    }
  ]
}