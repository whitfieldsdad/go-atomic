{
  "id": "4541e2c2-33c8-44b1-be79-9161440f1718",
  "name": "Data Encrypted with GPG4Win",
  "description": "Gpg4win is a Windows tool (also called Kleopatra which is the preferred certificate manager) that uses email and file encryption packages for symmetric encryption. It is used by attackers to encrypt disks. User will need to add pass phrase to encrypt file as automation is not allowed under newer versions.",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "49d99ee3-79d9-4e4c-a27e-606dc5fc15e8",
      "type": "execute-command",
      "data": {
        "command": "cmd /c '#{GPG_Exe_Location}' -c '#{File_to_Encrypt_Location}'\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "f225b25c-4e73-4b1b-8566-fcd894cd4767",
      "type": "execute-command",
      "data": {
        "command": "remove-item '#{File_to_Encrypt_Location}.gpg' -force -erroraction silentlycontinue | out-null\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "3926ada9-a493-4bb3-a29e-0e5a8999c7f8",
      "name": "Check dependency 1/1",
      "description": "GPG must exist at (#{GPG_Exe_Location})\n",
      "type": "execute-command",
      "data": {
        "command": "if (test-path '#{GPG_Exe_Location}'){exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "853d809f-c9c3-4e06-8460-2d59d968ee59",
      "name": "Resolve dependency 1/1",
      "description": "GPG must exist at (#{GPG_Exe_Location})\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\ninvoke-webrequest \"https://files.gpg4win.org/gpg4win-4.1.0.exe\" -outfile \"PathToAtomicsFolder\\..\\ExternalPayloads\\gpginstall.exe\"\ncmd /c \"PathToAtomicsFolder\\..\\ExternalPayloads\\gpginstall.exe\" /S\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "5e97c266-db35-44f9-880c-eabb5fc8fe18",
      "name": "Re-check dependency 1/1",
      "description": "GPG must exist at (#{GPG_Exe_Location})\n",
      "type": "execute-command",
      "data": {
        "command": "if (test-path '#{GPG_Exe_Location}'){exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "49d99ee3-79d9-4e4c-a27e-606dc5fc15e8",
      "p": "on-success",
      "o": "f225b25c-4e73-4b1b-8566-fcd894cd4767"
    },
    {
      "s": "49d99ee3-79d9-4e4c-a27e-606dc5fc15e8",
      "p": "on-failure",
      "o": "f225b25c-4e73-4b1b-8566-fcd894cd4767"
    },
    {
      "s": "3926ada9-a493-4bb3-a29e-0e5a8999c7f8",
      "p": "on-success",
      "o": "49d99ee3-79d9-4e4c-a27e-606dc5fc15e8"
    },
    {
      "s": "3926ada9-a493-4bb3-a29e-0e5a8999c7f8",
      "p": "on-failure",
      "o": "853d809f-c9c3-4e06-8460-2d59d968ee59"
    },
    {
      "s": "853d809f-c9c3-4e06-8460-2d59d968ee59",
      "p": "on-success",
      "o": "5e97c266-db35-44f9-880c-eabb5fc8fe18"
    },
    {
      "s": "5e97c266-db35-44f9-880c-eabb5fc8fe18",
      "p": "on-failure",
      "o": "49d99ee3-79d9-4e4c-a27e-606dc5fc15e8"
    }
  ],
  "tags": [
    "T1486",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "GPG_Exe_Location",
      "type": "path",
      "description": "Path of the GPG program",
      "value": "C:\\Program Files (x86)\\GnuPG\\bin\\gpg.exe"
    },
    {
      "name": "File_to_Encrypt_Location",
      "type": "path",
      "description": "Path of File",
      "value": "$env:temp\\test.txt"
    }
  ]
}