{
  "id": "5e09bed0-7d33-453b-9bf3-caea32bff719",
  "name": "Azure - Eventhub Deletion",
  "description": "Identifies an Event Hub deletion in Azure.\nAn Event Hub is an event processing service that ingests and processes large volumes of events and data.\nAn adversary may delete an Event Hub in an attempt to evade detection.\nhttps://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-about.\n",
  "platforms": [
    "iaas:azure"
  ],
  "steps": [
    {
      "id": "d435d1e5-d8d7-42d5-9947-56aa4f39dfd3",
      "type": "execute-command",
      "data": {
        "command": "$secure_pwd = \"#{password}\" | ConvertTo-SecureString -AsPlainText -Force\n$creds = New-Object System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $secure_pwd\nConnect-AzureAD -Credential $creds\nRemove-AzEventHub -ResourceGroupName #{resource_group} -Namespace #{name_space_name} -Name #{event_hub_name}\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "d84a6bb6-85d4-424d-81b6-5144b0e65d24",
      "type": "execute-command",
      "data": {
        "command": "cd \"$PathToAtomicsFolder/T1562.008/src/T1562.008-2/\"\nterraform destroy -auto-approve\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "97a91ff9-cfb2-4991-900e-11403ce863de",
      "name": "Check dependency 1/4",
      "description": "Install-Module -Name Az\n",
      "type": "execute-command",
      "data": {
        "command": "try {if (Get-InstalledModule -Name AzureAD -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "09c67216-92eb-436c-b375-e8708bdede4a",
      "name": "Resolve dependency 1/4",
      "description": "Install-Module -Name Az\n",
      "type": "execute-command",
      "data": {
        "command": "Install-Module -Name AzureAD -Force\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "978770ac-8aff-4bdf-9f3c-b118cccf3702",
      "name": "Re-check dependency 1/4",
      "description": "Install-Module -Name Az\n",
      "type": "execute-command",
      "data": {
        "command": "try {if (Get-InstalledModule -Name AzureAD -ErrorAction SilentlyContinue) {exit 0} else {exit 1}} catch {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "8bf5965e-3d1b-4e58-b7f3-39da1dfeafba",
      "name": "Check dependency 2/4",
      "description": "Check if terraform is installed.\n",
      "type": "execute-command",
      "data": {
        "command": "terraform version\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "3cfb6bc4-4aa8-4f48-9640-2b1f30a44bd0",
      "name": "Resolve dependency 2/4",
      "description": "Check if terraform is installed.\n",
      "type": "execute-command",
      "data": {
        "command": "echo Please install the terraform.\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "11fb55f5-9fb6-4713-a41e-e7c8ab978987",
      "name": "Re-check dependency 2/4",
      "description": "Check if terraform is installed.\n",
      "type": "execute-command",
      "data": {
        "command": "terraform version\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "3a405305-35cd-4c1c-9a6f-2b12639cb1d3",
      "name": "Check dependency 3/4",
      "description": "Check if the user is logged into Azure.\n",
      "type": "execute-command",
      "data": {
        "command": "az account show\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "9cfcd32e-d67b-41ae-a53b-497e022a9ea6",
      "name": "Resolve dependency 3/4",
      "description": "Check if the user is logged into Azure.\n",
      "type": "execute-command",
      "data": {
        "command": "echo Configure your Azure account using: az login. \n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "c6c3a1ce-e83e-4890-9dde-539be7973769",
      "name": "Re-check dependency 3/4",
      "description": "Check if the user is logged into Azure.\n",
      "type": "execute-command",
      "data": {
        "command": "az account show\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "1000c867-488f-447c-836c-304240ad1ce0",
      "name": "Check dependency 4/4",
      "description": "Create dependency resources using terraform\n",
      "type": "execute-command",
      "data": {
        "command": "try {if (Test-Path \"$PathToAtomicsFolder/T1562.008/src/T1562.008-2/terraform.tfstate\" ){ exit 0 } else {exit 1}} catch {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "cd0473d2-59be-40ec-9eab-fc9c6fd2dd53",
      "name": "Resolve dependency 4/4",
      "description": "Create dependency resources using terraform\n",
      "type": "execute-command",
      "data": {
        "command": "cd \"$PathToAtomicsFolder/T1562.008/src/T1562.008-2/\"\nterraform init\nterraform apply -auto-approve\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "131b7f49-deed-41b4-a025-62e705757ab1",
      "name": "Re-check dependency 4/4",
      "description": "Create dependency resources using terraform\n",
      "type": "execute-command",
      "data": {
        "command": "try {if (Test-Path \"$PathToAtomicsFolder/T1562.008/src/T1562.008-2/terraform.tfstate\" ){ exit 0 } else {exit 1}} catch {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "d435d1e5-d8d7-42d5-9947-56aa4f39dfd3",
      "p": "on-success",
      "o": "d84a6bb6-85d4-424d-81b6-5144b0e65d24"
    },
    {
      "s": "d435d1e5-d8d7-42d5-9947-56aa4f39dfd3",
      "p": "on-failure",
      "o": "d84a6bb6-85d4-424d-81b6-5144b0e65d24"
    },
    {
      "s": "97a91ff9-cfb2-4991-900e-11403ce863de",
      "p": "on-success",
      "o": "d435d1e5-d8d7-42d5-9947-56aa4f39dfd3"
    },
    {
      "s": "97a91ff9-cfb2-4991-900e-11403ce863de",
      "p": "on-failure",
      "o": "09c67216-92eb-436c-b375-e8708bdede4a"
    },
    {
      "s": "09c67216-92eb-436c-b375-e8708bdede4a",
      "p": "on-success",
      "o": "978770ac-8aff-4bdf-9f3c-b118cccf3702"
    },
    {
      "s": "978770ac-8aff-4bdf-9f3c-b118cccf3702",
      "p": "on-failure",
      "o": "d435d1e5-d8d7-42d5-9947-56aa4f39dfd3"
    },
    {
      "s": "8bf5965e-3d1b-4e58-b7f3-39da1dfeafba",
      "p": "on-success",
      "o": "d435d1e5-d8d7-42d5-9947-56aa4f39dfd3"
    },
    {
      "s": "8bf5965e-3d1b-4e58-b7f3-39da1dfeafba",
      "p": "on-failure",
      "o": "3cfb6bc4-4aa8-4f48-9640-2b1f30a44bd0"
    },
    {
      "s": "3cfb6bc4-4aa8-4f48-9640-2b1f30a44bd0",
      "p": "on-success",
      "o": "11fb55f5-9fb6-4713-a41e-e7c8ab978987"
    },
    {
      "s": "11fb55f5-9fb6-4713-a41e-e7c8ab978987",
      "p": "on-failure",
      "o": "d435d1e5-d8d7-42d5-9947-56aa4f39dfd3"
    },
    {
      "s": "3a405305-35cd-4c1c-9a6f-2b12639cb1d3",
      "p": "on-success",
      "o": "d435d1e5-d8d7-42d5-9947-56aa4f39dfd3"
    },
    {
      "s": "3a405305-35cd-4c1c-9a6f-2b12639cb1d3",
      "p": "on-failure",
      "o": "9cfcd32e-d67b-41ae-a53b-497e022a9ea6"
    },
    {
      "s": "9cfcd32e-d67b-41ae-a53b-497e022a9ea6",
      "p": "on-success",
      "o": "c6c3a1ce-e83e-4890-9dde-539be7973769"
    },
    {
      "s": "c6c3a1ce-e83e-4890-9dde-539be7973769",
      "p": "on-failure",
      "o": "d435d1e5-d8d7-42d5-9947-56aa4f39dfd3"
    },
    {
      "s": "1000c867-488f-447c-836c-304240ad1ce0",
      "p": "on-success",
      "o": "d435d1e5-d8d7-42d5-9947-56aa4f39dfd3"
    },
    {
      "s": "1000c867-488f-447c-836c-304240ad1ce0",
      "p": "on-failure",
      "o": "cd0473d2-59be-40ec-9eab-fc9c6fd2dd53"
    },
    {
      "s": "cd0473d2-59be-40ec-9eab-fc9c6fd2dd53",
      "p": "on-success",
      "o": "131b7f49-deed-41b4-a025-62e705757ab1"
    },
    {
      "s": "131b7f49-deed-41b4-a025-62e705757ab1",
      "p": "on-failure",
      "o": "d435d1e5-d8d7-42d5-9947-56aa4f39dfd3"
    }
  ],
  "tags": [
    "T1562.008",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "username",
      "type": "string",
      "description": "Azure username",
      "value": ""
    },
    {
      "name": "password",
      "type": "string",
      "description": "Azure password",
      "value": ""
    },
    {
      "name": "event_hub_name",
      "type": "string",
      "description": "Name of the eventhub",
      "value": "test_eventhub"
    },
    {
      "name": "resource_group",
      "type": "string",
      "description": "Name of the resource group",
      "value": ""
    },
    {
      "name": "name_space_name",
      "type": "string",
      "description": "Name of the NameSpace",
      "value": ""
    }
  ]
}