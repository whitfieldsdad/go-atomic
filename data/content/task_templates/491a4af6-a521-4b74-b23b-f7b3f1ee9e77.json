{
  "id": "491a4af6-a521-4b74-b23b-f7b3f1ee9e77",
  "name": "Service Installation PowerShell",
  "description": "Installs A Local Service via PowerShell.\nUpon successful execution, powershell will download `AtomicService.exe` from github. Powershell will then use `New-Service` and `Start-Service` to start service. Results will be displayed.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "32b4c054-a14d-4ce3-a78c-f2f327902430",
      "type": "execute-command",
      "data": {
        "command": "New-Service -Name \"#{service_name}\" -BinaryPathName \"#{binary_path}\"\nStart-Service -Name \"#{service_name}\"\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "8a859c7e-ba44-4f73-b628-6197a9e25c4d",
      "type": "execute-command",
      "data": {
        "command": "Stop-Service -Name \"#{service_name}\" 2\u003e\u00261 | Out-Null\ntry {(Get-WmiObject Win32_Service -filter \"name='#{service_name}'\").Delete()}\ncatch {}\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "4f14057a-ece3-443a-85fe-dc0685c620ed",
      "name": "Check dependency 1/1",
      "description": "Service binary must exist on disk at specified location (#{binary_path})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{binary_path}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "8710fe75-42fb-4113-8fe9-b148e9990b28",
      "name": "Resolve dependency 1/1",
      "description": "Service binary must exist on disk at specified location (#{binary_path})\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory (split-path \"#{binary_path}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1543.003/bin/AtomicService.exe\" -OutFile \"#{binary_path}\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "fb07c125-baea-486d-a85b-f3c7851f9ed3",
      "name": "Re-check dependency 1/1",
      "description": "Service binary must exist on disk at specified location (#{binary_path})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{binary_path}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "32b4c054-a14d-4ce3-a78c-f2f327902430",
      "p": "on-success",
      "o": "8a859c7e-ba44-4f73-b628-6197a9e25c4d"
    },
    {
      "s": "32b4c054-a14d-4ce3-a78c-f2f327902430",
      "p": "on-failure",
      "o": "8a859c7e-ba44-4f73-b628-6197a9e25c4d"
    },
    {
      "s": "4f14057a-ece3-443a-85fe-dc0685c620ed",
      "p": "on-success",
      "o": "32b4c054-a14d-4ce3-a78c-f2f327902430"
    },
    {
      "s": "4f14057a-ece3-443a-85fe-dc0685c620ed",
      "p": "on-failure",
      "o": "8710fe75-42fb-4113-8fe9-b148e9990b28"
    },
    {
      "s": "8710fe75-42fb-4113-8fe9-b148e9990b28",
      "p": "on-success",
      "o": "fb07c125-baea-486d-a85b-f3c7851f9ed3"
    },
    {
      "s": "fb07c125-baea-486d-a85b-f3c7851f9ed3",
      "p": "on-failure",
      "o": "32b4c054-a14d-4ce3-a78c-f2f327902430"
    }
  ],
  "tags": [
    "T1543.003",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "binary_path",
      "type": "path",
      "description": "Name of the service binary, include path.",
      "value": "PathToAtomicsFolder\\T1543.003\\bin\\AtomicService.exe"
    },
    {
      "name": "service_name",
      "type": "string",
      "description": "Name of the Service",
      "value": "AtomicTestService_PowerShell"
    }
  ]
}