{
  "id": "2e22641d-0498-48d2-b9ff-c71e496ccdbe",
  "name": "Windows - Discover domain trusts with nltest",
  "description": "Uses the nltest command to discover domain trusts.\nRequires the installation of nltest via Windows RSAT or the Windows Server AD DS role.\nThis technique has been used by the Trickbot malware family.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "cc7e2325-d691-47b8-a354-bfcf0e57f9c6",
      "type": "execute-command",
      "data": {
        "command": "nltest /domain_trusts\nnltest /trusted_domains\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "8ed91a04-a067-4f56-a5a5-8ab0b784ea0e",
      "name": "Check dependency 1/1",
      "description": "nltest.exe from RSAT must be present on disk\n",
      "type": "execute-command",
      "data": {
        "command": "WHERE nltest.exe \u003eNUL 2\u003e\u00261\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "b31343d4-428e-43c5-b60f-b548676283c1",
      "name": "Resolve dependency 1/1",
      "description": "nltest.exe from RSAT must be present on disk\n",
      "type": "execute-command",
      "data": {
        "command": "echo Sorry RSAT must be installed manually\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "cbc70ed1-6c5e-48af-9f65-073d3e203c5f",
      "name": "Re-check dependency 1/1",
      "description": "nltest.exe from RSAT must be present on disk\n",
      "type": "execute-command",
      "data": {
        "command": "WHERE nltest.exe \u003eNUL 2\u003e\u00261\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "8ed91a04-a067-4f56-a5a5-8ab0b784ea0e",
      "p": "on-success",
      "o": "cc7e2325-d691-47b8-a354-bfcf0e57f9c6"
    },
    {
      "s": "8ed91a04-a067-4f56-a5a5-8ab0b784ea0e",
      "p": "on-failure",
      "o": "b31343d4-428e-43c5-b60f-b548676283c1"
    },
    {
      "s": "b31343d4-428e-43c5-b60f-b548676283c1",
      "p": "on-success",
      "o": "cbc70ed1-6c5e-48af-9f65-073d3e203c5f"
    },
    {
      "s": "cbc70ed1-6c5e-48af-9f65-073d3e203c5f",
      "p": "on-failure",
      "o": "cc7e2325-d691-47b8-a354-bfcf0e57f9c6"
    }
  ],
  "tags": [
    "T1482"
  ]
}