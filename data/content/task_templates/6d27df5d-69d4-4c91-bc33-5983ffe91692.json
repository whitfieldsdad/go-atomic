{
  "id": "6d27df5d-69d4-4c91-bc33-5983ffe91692",
  "name": "Password Cracking with Hashcat",
  "description": "Execute Hashcat.exe with provided SAM file from registry of Windows and Password list to crack against",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "17b69cae-f77d-4dfd-b193-af6b2ba7ae05",
      "type": "execute-command",
      "data": {
        "command": "cd #{hashcat_exe}\\..\n#{hashcat_exe} -a 0 -m 1000 -r .\\rules\\Incisive-leetspeak.rule #{input_file_sam} #{input_file_passwords}",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "2e53fa58-386c-4f34-b6f5-2aa96e80435f",
      "type": "execute-command",
      "data": {
        "command": "del \"PathToAtomicsFolder\\..\\ExternalPayloads\\hashcat6.7z\" \u003enul 2\u003e\u00261\ndel \"PathToAtomicsFolder\\..\\ExternalPayloads\\7z1900.exe\" \u003enul 2\u003e\u00261\ndel \"PathToAtomicsFolder\\..\\ExternalPayloads\\7z\" /Q /S \u003enul 2\u003e\u00261\ndel \"PathToAtomicsFolder\\..\\ExternalPayloads\\hashcat-unzip\" /Q /S \u003enul 2\u003e\u00261",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "c7e02758-b7c3-4328-b324-aebb146554ad",
      "name": "Check dependency 1/1",
      "description": "Hashcat must exist on disk at specified location (#{hashcat_exe})",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path  $(cmd /c echo \"#{hashcat_exe}\")) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "bd8df8dc-5cdd-44af-bc8b-5223ad8e556a",
      "name": "Resolve dependency 1/1",
      "description": "Hashcat must exist on disk at specified location (#{hashcat_exe})",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://www.7-zip.org/a/7z1900.exe\" -OutFile \"PathToAtomicsFolder\\..\\ExternalPayloads\\7z1900.exe\"\nStart-Process -FilePath \"PathToAtomicsFolder\\..\\ExternalPayloads\\7z1900.exe\" -ArgumentList \"/S /D=PathToAtomicsFolder\\..\\ExternalPayloads\\7zi\" -NoNewWindow\nInvoke-WebRequest \"https://hashcat.net/files/hashcat-6.1.1.7z\" -OutFile \"PathToAtomicsFolder\\..\\ExternalPayloads\\hashcat6.7z\"\nStart-Process cmd.exe -Args  \"/c %temp%\\7z\\7z.exe x %temp%\\hashcat6.7z -aoa -o%temp%\\hashcat-unzip\" -Wait\nNew-Item -ItemType Directory (Split-Path $(cmd /c echo #{hashcat_exe})) -Force | Out-Null\nMove-Item \"PathToAtomicsFolder\\..\\ExternalPayloads\\hashcat-unzip\\hashcat-6.1.1\\*\" $(cmd /c echo #{hashcat_exe}\\..) -Force -ErrorAction Ignore",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "41fb8b35-41b4-470c-bcf8-6fc868c1e2f0",
      "name": "Re-check dependency 1/1",
      "description": "Hashcat must exist on disk at specified location (#{hashcat_exe})",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path  $(cmd /c echo \"#{hashcat_exe}\")) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "17b69cae-f77d-4dfd-b193-af6b2ba7ae05",
      "p": "on-success",
      "o": "2e53fa58-386c-4f34-b6f5-2aa96e80435f"
    },
    {
      "s": "17b69cae-f77d-4dfd-b193-af6b2ba7ae05",
      "p": "on-failure",
      "o": "2e53fa58-386c-4f34-b6f5-2aa96e80435f"
    },
    {
      "s": "c7e02758-b7c3-4328-b324-aebb146554ad",
      "p": "on-success",
      "o": "17b69cae-f77d-4dfd-b193-af6b2ba7ae05"
    },
    {
      "s": "c7e02758-b7c3-4328-b324-aebb146554ad",
      "p": "on-failure",
      "o": "bd8df8dc-5cdd-44af-bc8b-5223ad8e556a"
    },
    {
      "s": "bd8df8dc-5cdd-44af-bc8b-5223ad8e556a",
      "p": "on-success",
      "o": "41fb8b35-41b4-470c-bcf8-6fc868c1e2f0"
    },
    {
      "s": "41fb8b35-41b4-470c-bcf8-6fc868c1e2f0",
      "p": "on-failure",
      "o": "17b69cae-f77d-4dfd-b193-af6b2ba7ae05"
    }
  ],
  "tags": [
    "T1110.002",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "hashcat_exe",
      "type": "string",
      "description": "Path to Hashcat executable",
      "value": "PathToAtomicsFolder\\..\\ExternalPayloads\\hashcat6\\hashcat-6.1.1\\hashcat.exe"
    },
    {
      "name": "input_file_sam",
      "type": "string",
      "description": "Path to SAM file",
      "value": "PathToAtomicsFolder\\T1110.002\\src\\sam.txt"
    },
    {
      "name": "input_file_passwords",
      "type": "string",
      "description": "Path to password list",
      "value": "PathToAtomicsFolder\\T1110.002\\src\\password.lst"
    }
  ]
}