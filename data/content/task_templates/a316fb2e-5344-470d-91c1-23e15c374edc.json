{
  "id": "a316fb2e-5344-470d-91c1-23e15c374edc",
  "name": "Uninstall Sysmon",
  "description": "Uninstall Sysinternals Sysmon for Defense Evasion\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "c8bb52a6-50d1-41c6-8230-2d0d03f13b39",
      "type": "execute-command",
      "data": {
        "command": "sysmon -u\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "8c7f00b1-3f1a-48a1-9bad-3e7520a796a8",
      "type": "execute-command",
      "data": {
        "command": "sysmon -i -accepteula \u003enul 2\u003e\u00261\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "04db649a-e3ca-4d38-866c-c642af6658b4",
      "name": "Check dependency 1/2",
      "description": "Sysmon executable must be available\n",
      "type": "execute-command",
      "data": {
        "command": "if(cmd /c where sysmon) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "1e6c9cc6-bdcb-4edf-8c22-159029ee51ce",
      "name": "Resolve dependency 1/2",
      "description": "Sysmon executable must be available\n",
      "type": "execute-command",
      "data": {
        "command": "$parentpath = Split-Path \"#{sysmon_exe}\"; $zippath = \"$parentpath\\Sysmon.zip\"\nNew-Item -ItemType Directory $parentpath -Force | Out-Null\nInvoke-WebRequest \"https://download.sysinternals.com/files/Sysmon.zip\" -OutFile \"$zippath\"\nExpand-Archive $zippath $parentpath -Force; Remove-Item $zippath\nif(-not ($Env:Path).contains($parentpath)){$Env:Path += \";$parentpath\"}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "5c2f787b-3d41-40e2-b5fc-0fc8068981a1",
      "name": "Re-check dependency 1/2",
      "description": "Sysmon executable must be available\n",
      "type": "execute-command",
      "data": {
        "command": "if(cmd /c where sysmon) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "3e93f564-3335-494e-8be1-6949fccd76e7",
      "name": "Check dependency 2/2",
      "description": "Sysmon must be installed\n",
      "type": "execute-command",
      "data": {
        "command": "if(cmd /c sc query sysmon) { exit 0} else { exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "12768d80-959c-4e8c-b959-3e30d0abe5ea",
      "name": "Resolve dependency 2/2",
      "description": "Sysmon must be installed\n",
      "type": "execute-command",
      "data": {
        "command": "cmd /c sysmon -i -accepteula\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "eb7c46f2-3770-47a3-b4f1-d76b942eb0da",
      "name": "Re-check dependency 2/2",
      "description": "Sysmon must be installed\n",
      "type": "execute-command",
      "data": {
        "command": "if(cmd /c sc query sysmon) { exit 0} else { exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "c8bb52a6-50d1-41c6-8230-2d0d03f13b39",
      "p": "on-success",
      "o": "8c7f00b1-3f1a-48a1-9bad-3e7520a796a8"
    },
    {
      "s": "c8bb52a6-50d1-41c6-8230-2d0d03f13b39",
      "p": "on-failure",
      "o": "8c7f00b1-3f1a-48a1-9bad-3e7520a796a8"
    },
    {
      "s": "04db649a-e3ca-4d38-866c-c642af6658b4",
      "p": "on-success",
      "o": "c8bb52a6-50d1-41c6-8230-2d0d03f13b39"
    },
    {
      "s": "04db649a-e3ca-4d38-866c-c642af6658b4",
      "p": "on-failure",
      "o": "1e6c9cc6-bdcb-4edf-8c22-159029ee51ce"
    },
    {
      "s": "1e6c9cc6-bdcb-4edf-8c22-159029ee51ce",
      "p": "on-success",
      "o": "5c2f787b-3d41-40e2-b5fc-0fc8068981a1"
    },
    {
      "s": "5c2f787b-3d41-40e2-b5fc-0fc8068981a1",
      "p": "on-failure",
      "o": "c8bb52a6-50d1-41c6-8230-2d0d03f13b39"
    },
    {
      "s": "3e93f564-3335-494e-8be1-6949fccd76e7",
      "p": "on-success",
      "o": "c8bb52a6-50d1-41c6-8230-2d0d03f13b39"
    },
    {
      "s": "3e93f564-3335-494e-8be1-6949fccd76e7",
      "p": "on-failure",
      "o": "12768d80-959c-4e8c-b959-3e30d0abe5ea"
    },
    {
      "s": "12768d80-959c-4e8c-b959-3e30d0abe5ea",
      "p": "on-success",
      "o": "eb7c46f2-3770-47a3-b4f1-d76b942eb0da"
    },
    {
      "s": "eb7c46f2-3770-47a3-b4f1-d76b942eb0da",
      "p": "on-failure",
      "o": "c8bb52a6-50d1-41c6-8230-2d0d03f13b39"
    }
  ],
  "tags": [
    "T1562.001",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "sysmon_exe",
      "type": "path",
      "description": "The location of the Sysmon executable from Sysinternals (ignored if sysmon.exe is found in your PATH)",
      "value": "PathToAtomicsFolder\\T1562.001\\bin\\sysmon.exe"
    }
  ]
}