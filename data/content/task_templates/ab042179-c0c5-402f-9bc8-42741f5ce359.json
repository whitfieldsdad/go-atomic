{
  "id": "ab042179-c0c5-402f-9bc8-42741f5ce359",
  "name": "MSBuild Bypass Using Inline Tasks (VB)",
  "description": "Executes the code in a project file using msbuild.exe. The default Visual Basic example file (vb.xml) will simply print \"Hello from a Visual Basic inline task!\" to the screen.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "a3b6fff3-ebca-489f-b379-fd980bdb709b",
      "type": "execute-command",
      "data": {
        "command": "#{msbuildpath}\\#{msbuildname} \"#{filename}\"\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "f822c082-8c32-4f13-906f-9cd07bbb0cf9",
      "name": "Check dependency 1/1",
      "description": "Project file must exist on disk at specified location (#{filename})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{filename}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "82545119-332d-4463-8199-8f2c867da5a2",
      "name": "Resolve dependency 1/1",
      "description": "Project file must exist on disk at specified location (#{filename})\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory (split-path \"#{filename}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1127.001/src/vb.xml\" -OutFile \"#{filename}\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "a741bded-1a7b-44ee-b74a-75fa905e9b81",
      "name": "Re-check dependency 1/1",
      "description": "Project file must exist on disk at specified location (#{filename})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{filename}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "f822c082-8c32-4f13-906f-9cd07bbb0cf9",
      "p": "on-success",
      "o": "a3b6fff3-ebca-489f-b379-fd980bdb709b"
    },
    {
      "s": "f822c082-8c32-4f13-906f-9cd07bbb0cf9",
      "p": "on-failure",
      "o": "82545119-332d-4463-8199-8f2c867da5a2"
    },
    {
      "s": "82545119-332d-4463-8199-8f2c867da5a2",
      "p": "on-success",
      "o": "a741bded-1a7b-44ee-b74a-75fa905e9b81"
    },
    {
      "s": "a741bded-1a7b-44ee-b74a-75fa905e9b81",
      "p": "on-failure",
      "o": "a3b6fff3-ebca-489f-b379-fd980bdb709b"
    }
  ],
  "tags": [
    "T1127.001",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "msbuildpath",
      "type": "path",
      "description": "Default location of MSBuild",
      "value": "C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319"
    },
    {
      "name": "msbuildname",
      "type": "path",
      "description": "Default name of MSBuild",
      "value": "msbuild.exe"
    },
    {
      "name": "filename",
      "type": "path",
      "description": "Location of the project file",
      "value": "PathToAtomicsFolder\\T1127.001\\src\\vb.xml"
    }
  ]
}