{
  "id": "d56152ec-01d9-42a2-877c-aac1f6ebe8e6",
  "name": "GCP - Delete Activity Event Log",
  "description": "GCP provides 4 types of Cloud Audit Logs: Admin Activity, Data Access, System Events, and Policy Denied.\nAn adversary may attempt to delete logs in order to hide their activity. However, Admin Activity, System Events, and Policy Deny events logs cannot be deleted. \n\nThis Atomic attempts to delete the Activity Event log. An event is generated under the method name of `google.logging.v2.LoggingServiceV2.DeleteLog` with a Serverity of `ERROR`.\n",
  "platforms": [
    "iaas:gcp"
  ],
  "steps": [
    {
      "id": "c01e1790-ea94-48d1-89ce-a198f8b1d3b4",
      "type": "execute-command",
      "data": {
        "command": "gcloud config set project #{project-id}\ngcloud logging logs delete projects/#{project-id}/logs/cloudaudit.googleapis.com%2Factivity --quiet",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "2506472d-a460-40af-ab8b-935773c72000",
      "name": "Check dependency 1/2",
      "description": "Requires gcloud\n",
      "type": "execute-command",
      "data": {
        "command": "if [ -x \"$(command -v gcloud)\" ]; then exit 0; else exit 1; fi;",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "93930e76-2a85-4781-8882-10f664a44aaa",
      "name": "Resolve dependency 1/2",
      "description": "Requires gcloud\n",
      "type": "execute-command",
      "data": {
        "command": "echo \"Please Install Google Cloud SDK before running this atomic test : https://cloud.google.com/sdk/docs/install\"",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "b3492413-04eb-41d7-a2ce-d8f6abc6a61d",
      "name": "Re-check dependency 1/2",
      "description": "Requires gcloud\n",
      "type": "execute-command",
      "data": {
        "command": "if [ -x \"$(command -v gcloud)\" ]; then exit 0; else exit 1; fi;",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "908d100a-5d0c-4e0e-9492-42c2342dc3ca",
      "name": "Check dependency 2/2",
      "description": "Check if user is logged in \n",
      "type": "execute-command",
      "data": {
        "command": "gcloud config get-value account",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "9678e231-98b5-4981-ba3f-38ca325fb919",
      "name": "Resolve dependency 2/2",
      "description": "Check if user is logged in \n",
      "type": "execute-command",
      "data": {
        "command": "gcloud auth login --no-launch-browser",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "ad8f7d77-d816-4bd8-bf2c-fcc9671d0f3a",
      "name": "Re-check dependency 2/2",
      "description": "Check if user is logged in \n",
      "type": "execute-command",
      "data": {
        "command": "gcloud config get-value account",
        "command_type": "sh"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "2506472d-a460-40af-ab8b-935773c72000",
      "p": "on-success",
      "o": "c01e1790-ea94-48d1-89ce-a198f8b1d3b4"
    },
    {
      "s": "2506472d-a460-40af-ab8b-935773c72000",
      "p": "on-failure",
      "o": "93930e76-2a85-4781-8882-10f664a44aaa"
    },
    {
      "s": "93930e76-2a85-4781-8882-10f664a44aaa",
      "p": "on-success",
      "o": "b3492413-04eb-41d7-a2ce-d8f6abc6a61d"
    },
    {
      "s": "b3492413-04eb-41d7-a2ce-d8f6abc6a61d",
      "p": "on-failure",
      "o": "c01e1790-ea94-48d1-89ce-a198f8b1d3b4"
    },
    {
      "s": "908d100a-5d0c-4e0e-9492-42c2342dc3ca",
      "p": "on-success",
      "o": "c01e1790-ea94-48d1-89ce-a198f8b1d3b4"
    },
    {
      "s": "908d100a-5d0c-4e0e-9492-42c2342dc3ca",
      "p": "on-failure",
      "o": "9678e231-98b5-4981-ba3f-38ca325fb919"
    },
    {
      "s": "9678e231-98b5-4981-ba3f-38ca325fb919",
      "p": "on-success",
      "o": "ad8f7d77-d816-4bd8-bf2c-fcc9671d0f3a"
    },
    {
      "s": "ad8f7d77-d816-4bd8-bf2c-fcc9671d0f3a",
      "p": "on-failure",
      "o": "c01e1790-ea94-48d1-89ce-a198f8b1d3b4"
    }
  ],
  "tags": [
    "T1562",
    "T1562.008"
  ],
  "input_arguments": [
    {
      "name": "project-id",
      "type": "string",
      "description": "ID of the GCP Project you to execute the command against.",
      "value": "atomic-project-1"
    }
  ]
}