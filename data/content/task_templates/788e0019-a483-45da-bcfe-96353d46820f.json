{
  "id": "788e0019-a483-45da-bcfe-96353d46820f",
  "name": "Cat the contents of a Kubernetes service account token file",
  "description": "Access the Kubernetes service account access token stored within a container in a cluster.\n",
  "platforms": [
    "linux"
  ],
  "steps": [
    {
      "id": "02f38bed-7d96-4e25-9248-29acf3305106",
      "type": "execute-command",
      "data": {
        "command": "kubectl --context kind-atomic-cluster exec atomic-pod -- cat /run/secrets/kubernetes.io/serviceaccount/token",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "750e059a-66b0-4959-ad74-6830b381aca4",
      "type": "execute-command",
      "data": {
        "command": "kubectl --context kind-atomic-cluster delete pod atomic-pod",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "83cf34f8-2183-455c-8a1d-dbaeb37ab96b",
      "name": "Check dependency 1/6",
      "description": "Verify docker is installed.",
      "type": "execute-command",
      "data": {
        "command": "which docker",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "860b972a-5a5f-4da0-a61f-85fcfd08a11b",
      "name": "Resolve dependency 1/6",
      "description": "Verify docker is installed.",
      "type": "execute-command",
      "data": {
        "command": "if [ \"\" == \"`which docker`\" ]; then echo \"Docker Not Found\"; if [ -n \"`which apt-get`\" ]; then sudo apt-get -y install docker ; elif [ -n \"`which yum`\" ]; then sudo yum -y install docker ; fi ; else echo \"Docker installed\"; fi",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "f3fa7fef-5094-4a4e-bd87-b02a868e15c9",
      "name": "Re-check dependency 1/6",
      "description": "Verify docker is installed.",
      "type": "execute-command",
      "data": {
        "command": "which docker",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "9fa6d0a3-6e39-4261-b886-baf7e41fa795",
      "name": "Check dependency 2/6",
      "description": "Verify docker service is running.",
      "type": "execute-command",
      "data": {
        "command": "sudo systemctl status docker",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "c7de4018-76a2-4802-8a9c-4d756f3df8f8",
      "name": "Resolve dependency 2/6",
      "description": "Verify docker service is running.",
      "type": "execute-command",
      "data": {
        "command": "sudo systemctl start docker",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "b25c834c-ff1f-462f-9d09-6e9577d1b982",
      "name": "Re-check dependency 2/6",
      "description": "Verify docker service is running.",
      "type": "execute-command",
      "data": {
        "command": "sudo systemctl status docker",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "5c6a0a60-79be-45ec-b94f-1fadacf81256",
      "name": "Check dependency 3/6",
      "description": "Verify kind is in the path.",
      "type": "execute-command",
      "data": {
        "command": "which kind",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "3d4002e8-07e4-4fd0-89b0-9432c1503aea",
      "name": "Resolve dependency 3/6",
      "description": "Verify kind is in the path.",
      "type": "execute-command",
      "data": {
        "command": "curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.10.0/kind-linux-amd64\nchmod +x ./kind\nmv kind /usr/bin/kind",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "abd8f475-1fac-44d0-956a-e320504eada2",
      "name": "Re-check dependency 3/6",
      "description": "Verify kind is in the path.",
      "type": "execute-command",
      "data": {
        "command": "which kind",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "7bfbbdbe-683c-4d08-810e-e310325a1b62",
      "name": "Check dependency 4/6",
      "description": "Verify kind-atomic-cluster is created",
      "type": "execute-command",
      "data": {
        "command": "sudo kind get clusters",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "f2aadf36-8540-4838-bfce-8cd8cb550098",
      "name": "Resolve dependency 4/6",
      "description": "Verify kind-atomic-cluster is created",
      "type": "execute-command",
      "data": {
        "command": "sudo kind create cluster --name atomic-cluster",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "17cee758-c948-4344-95b6-567db85df760",
      "name": "Re-check dependency 4/6",
      "description": "Verify kind-atomic-cluster is created",
      "type": "execute-command",
      "data": {
        "command": "sudo kind get clusters",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "02c5a36e-7ef5-406f-b46d-d34bce8e7821",
      "name": "Check dependency 5/6",
      "description": "Verify kubectl is in path",
      "type": "execute-command",
      "data": {
        "command": "which kubectl",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "7929e638-a582-4752-8970-79322eba5790",
      "name": "Resolve dependency 5/6",
      "description": "Verify kubectl is in path",
      "type": "execute-command",
      "data": {
        "command": "curl -LO \"https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl\"\nchmod +x ./kubectl\nmv kubectl /usr/bin/kubectl",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "2af8aa2a-ef51-49c8-9828-db7f3b73cbe0",
      "name": "Re-check dependency 5/6",
      "description": "Verify kubectl is in path",
      "type": "execute-command",
      "data": {
        "command": "which kubectl",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "d4db0b03-fa7e-4fa8-a393-af74b4f67e55",
      "name": "Check dependency 6/6",
      "description": "Verify atomic-pod is running.",
      "type": "execute-command",
      "data": {
        "command": "kubectl --context kind-atomic-cluster get pods |grep atomic-pod",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "fe69e180-9b47-4f3e-ab0c-ce26ee1f7e95",
      "name": "Resolve dependency 6/6",
      "description": "Verify atomic-pod is running.",
      "type": "execute-command",
      "data": {
        "command": "kubectl --context kind-atomic-cluster run atomic-pod --image=alpine --command -- sleep infinity",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "4581dda5-4194-4f58-9782-eb5e07270cc1",
      "name": "Re-check dependency 6/6",
      "description": "Verify atomic-pod is running.",
      "type": "execute-command",
      "data": {
        "command": "kubectl --context kind-atomic-cluster get pods |grep atomic-pod",
        "command_type": "sh"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "02f38bed-7d96-4e25-9248-29acf3305106",
      "p": "on-success",
      "o": "750e059a-66b0-4959-ad74-6830b381aca4"
    },
    {
      "s": "02f38bed-7d96-4e25-9248-29acf3305106",
      "p": "on-failure",
      "o": "750e059a-66b0-4959-ad74-6830b381aca4"
    },
    {
      "s": "83cf34f8-2183-455c-8a1d-dbaeb37ab96b",
      "p": "on-success",
      "o": "02f38bed-7d96-4e25-9248-29acf3305106"
    },
    {
      "s": "83cf34f8-2183-455c-8a1d-dbaeb37ab96b",
      "p": "on-failure",
      "o": "860b972a-5a5f-4da0-a61f-85fcfd08a11b"
    },
    {
      "s": "860b972a-5a5f-4da0-a61f-85fcfd08a11b",
      "p": "on-success",
      "o": "f3fa7fef-5094-4a4e-bd87-b02a868e15c9"
    },
    {
      "s": "f3fa7fef-5094-4a4e-bd87-b02a868e15c9",
      "p": "on-failure",
      "o": "02f38bed-7d96-4e25-9248-29acf3305106"
    },
    {
      "s": "9fa6d0a3-6e39-4261-b886-baf7e41fa795",
      "p": "on-success",
      "o": "02f38bed-7d96-4e25-9248-29acf3305106"
    },
    {
      "s": "9fa6d0a3-6e39-4261-b886-baf7e41fa795",
      "p": "on-failure",
      "o": "c7de4018-76a2-4802-8a9c-4d756f3df8f8"
    },
    {
      "s": "c7de4018-76a2-4802-8a9c-4d756f3df8f8",
      "p": "on-success",
      "o": "b25c834c-ff1f-462f-9d09-6e9577d1b982"
    },
    {
      "s": "b25c834c-ff1f-462f-9d09-6e9577d1b982",
      "p": "on-failure",
      "o": "02f38bed-7d96-4e25-9248-29acf3305106"
    },
    {
      "s": "5c6a0a60-79be-45ec-b94f-1fadacf81256",
      "p": "on-success",
      "o": "02f38bed-7d96-4e25-9248-29acf3305106"
    },
    {
      "s": "5c6a0a60-79be-45ec-b94f-1fadacf81256",
      "p": "on-failure",
      "o": "3d4002e8-07e4-4fd0-89b0-9432c1503aea"
    },
    {
      "s": "3d4002e8-07e4-4fd0-89b0-9432c1503aea",
      "p": "on-success",
      "o": "abd8f475-1fac-44d0-956a-e320504eada2"
    },
    {
      "s": "abd8f475-1fac-44d0-956a-e320504eada2",
      "p": "on-failure",
      "o": "02f38bed-7d96-4e25-9248-29acf3305106"
    },
    {
      "s": "7bfbbdbe-683c-4d08-810e-e310325a1b62",
      "p": "on-success",
      "o": "02f38bed-7d96-4e25-9248-29acf3305106"
    },
    {
      "s": "7bfbbdbe-683c-4d08-810e-e310325a1b62",
      "p": "on-failure",
      "o": "f2aadf36-8540-4838-bfce-8cd8cb550098"
    },
    {
      "s": "f2aadf36-8540-4838-bfce-8cd8cb550098",
      "p": "on-success",
      "o": "17cee758-c948-4344-95b6-567db85df760"
    },
    {
      "s": "17cee758-c948-4344-95b6-567db85df760",
      "p": "on-failure",
      "o": "02f38bed-7d96-4e25-9248-29acf3305106"
    },
    {
      "s": "02c5a36e-7ef5-406f-b46d-d34bce8e7821",
      "p": "on-success",
      "o": "02f38bed-7d96-4e25-9248-29acf3305106"
    },
    {
      "s": "02c5a36e-7ef5-406f-b46d-d34bce8e7821",
      "p": "on-failure",
      "o": "7929e638-a582-4752-8970-79322eba5790"
    },
    {
      "s": "7929e638-a582-4752-8970-79322eba5790",
      "p": "on-success",
      "o": "2af8aa2a-ef51-49c8-9828-db7f3b73cbe0"
    },
    {
      "s": "2af8aa2a-ef51-49c8-9828-db7f3b73cbe0",
      "p": "on-failure",
      "o": "02f38bed-7d96-4e25-9248-29acf3305106"
    },
    {
      "s": "d4db0b03-fa7e-4fa8-a393-af74b4f67e55",
      "p": "on-success",
      "o": "02f38bed-7d96-4e25-9248-29acf3305106"
    },
    {
      "s": "d4db0b03-fa7e-4fa8-a393-af74b4f67e55",
      "p": "on-failure",
      "o": "fe69e180-9b47-4f3e-ab0c-ce26ee1f7e95"
    },
    {
      "s": "fe69e180-9b47-4f3e-ab0c-ce26ee1f7e95",
      "p": "on-success",
      "o": "4581dda5-4194-4f58-9782-eb5e07270cc1"
    },
    {
      "s": "4581dda5-4194-4f58-9782-eb5e07270cc1",
      "p": "on-failure",
      "o": "02f38bed-7d96-4e25-9248-29acf3305106"
    }
  ],
  "tags": [
    "T1552",
    "T1552.007"
  ],
  "input_arguments": null
}