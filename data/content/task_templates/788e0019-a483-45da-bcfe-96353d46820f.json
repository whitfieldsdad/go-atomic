{
  "id": "788e0019-a483-45da-bcfe-96353d46820f",
  "name": "Cat the contents of a Kubernetes service account token file",
  "description": "Access the Kubernetes service account access token stored within a container in a cluster.\n",
  "platforms": [
    "linux"
  ],
  "steps": [
    {
      "id": "75e4eed6-dd1e-456a-9677-078ad604fd9b",
      "type": "execute-command",
      "data": {
        "command": "kubectl --context kind-atomic-cluster exec atomic-pod -- cat /run/secrets/kubernetes.io/serviceaccount/token\n",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "8a6c6cab-c376-4bb9-996c-1a8ab8645e27",
      "type": "execute-command",
      "data": {
        "command": "kubectl --context kind-atomic-cluster delete pod atomic-pod\n",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "0f8efb65-4a90-4ce2-ad9a-8c31b49fa0f9",
      "name": "Check dependency 1/6",
      "description": "Verify docker is installed.",
      "type": "execute-command",
      "data": {
        "command": "which docker\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "688df91d-26fa-4a7f-82dd-2586ab10875f",
      "name": "Resolve dependency 1/6",
      "description": "Verify docker is installed.",
      "type": "execute-command",
      "data": {
        "command": "if [ \"\" == \"`which docker`\" ]; then echo \"Docker Not Found\"; if [ -n \"`which apt-get`\" ]; then sudo apt-get -y install docker ; elif [ -n \"`which yum`\" ]; then sudo yum -y install docker ; fi ; else echo \"Docker installed\"; fi\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "26b99e57-5205-4682-bb3c-acd1669f1157",
      "name": "Re-check dependency 1/6",
      "description": "Verify docker is installed.",
      "type": "execute-command",
      "data": {
        "command": "which docker\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "affd15ff-412a-4e3a-a675-9514413dacad",
      "name": "Check dependency 2/6",
      "description": "Verify docker service is running.",
      "type": "execute-command",
      "data": {
        "command": "sudo systemctl status docker\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "3568bf25-7eed-4007-9aa2-e14d9eb4f0b9",
      "name": "Resolve dependency 2/6",
      "description": "Verify docker service is running.",
      "type": "execute-command",
      "data": {
        "command": "sudo systemctl start docker\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "46dc11df-6388-4495-b835-0115fb49fb59",
      "name": "Re-check dependency 2/6",
      "description": "Verify docker service is running.",
      "type": "execute-command",
      "data": {
        "command": "sudo systemctl status docker\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "5df270e8-b418-429e-aa82-71df1abf24a5",
      "name": "Check dependency 3/6",
      "description": "Verify kind is in the path.",
      "type": "execute-command",
      "data": {
        "command": "which kind\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "1f6743ed-28df-470f-b50d-00802626b5b0",
      "name": "Resolve dependency 3/6",
      "description": "Verify kind is in the path.",
      "type": "execute-command",
      "data": {
        "command": "curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.10.0/kind-linux-amd64\nchmod +x ./kind\nmv kind /usr/bin/kind\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "102af535-a2f6-46ed-8e55-0b64568b0eed",
      "name": "Re-check dependency 3/6",
      "description": "Verify kind is in the path.",
      "type": "execute-command",
      "data": {
        "command": "which kind\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "d727fbda-c781-4f98-b000-b5b551a85f55",
      "name": "Check dependency 4/6",
      "description": "Verify kind-atomic-cluster is created",
      "type": "execute-command",
      "data": {
        "command": "sudo kind get clusters\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "d48e9121-7d9f-4f9a-9447-9227d7fde7b2",
      "name": "Resolve dependency 4/6",
      "description": "Verify kind-atomic-cluster is created",
      "type": "execute-command",
      "data": {
        "command": "sudo kind create cluster --name atomic-cluster\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "ea4d4e9c-5d72-47a1-b4e1-11703c0bed03",
      "name": "Re-check dependency 4/6",
      "description": "Verify kind-atomic-cluster is created",
      "type": "execute-command",
      "data": {
        "command": "sudo kind get clusters\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "4fab9c5c-2d58-41f6-9041-95ba6439bf35",
      "name": "Check dependency 5/6",
      "description": "Verify kubectl is in path",
      "type": "execute-command",
      "data": {
        "command": "which kubectl\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "ca7a80f2-2eb0-48e4-a65c-facb5e90dbc0",
      "name": "Resolve dependency 5/6",
      "description": "Verify kubectl is in path",
      "type": "execute-command",
      "data": {
        "command": "curl -LO \"https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl\"\nchmod +x ./kubectl\nmv kubectl /usr/bin/kubectl\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "e43248d1-12c3-4290-b2a9-d332f7ab145e",
      "name": "Re-check dependency 5/6",
      "description": "Verify kubectl is in path",
      "type": "execute-command",
      "data": {
        "command": "which kubectl\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "75da7124-cf69-4561-aafe-f5132ceb5a75",
      "name": "Check dependency 6/6",
      "description": "Verify atomic-pod is running.",
      "type": "execute-command",
      "data": {
        "command": "kubectl --context kind-atomic-cluster get pods |grep atomic-pod\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "aec40615-783a-408c-987c-8a09717fb5a5",
      "name": "Resolve dependency 6/6",
      "description": "Verify atomic-pod is running.",
      "type": "execute-command",
      "data": {
        "command": "kubectl --context kind-atomic-cluster run atomic-pod --image=alpine --command -- sleep infinity\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "da9a7ba5-d12e-417c-8d9b-1fe883445aee",
      "name": "Re-check dependency 6/6",
      "description": "Verify atomic-pod is running.",
      "type": "execute-command",
      "data": {
        "command": "kubectl --context kind-atomic-cluster get pods |grep atomic-pod\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "75e4eed6-dd1e-456a-9677-078ad604fd9b",
      "p": "on-success",
      "o": "8a6c6cab-c376-4bb9-996c-1a8ab8645e27"
    },
    {
      "s": "75e4eed6-dd1e-456a-9677-078ad604fd9b",
      "p": "on-failure",
      "o": "8a6c6cab-c376-4bb9-996c-1a8ab8645e27"
    },
    {
      "s": "0f8efb65-4a90-4ce2-ad9a-8c31b49fa0f9",
      "p": "on-success",
      "o": "75e4eed6-dd1e-456a-9677-078ad604fd9b"
    },
    {
      "s": "0f8efb65-4a90-4ce2-ad9a-8c31b49fa0f9",
      "p": "on-failure",
      "o": "688df91d-26fa-4a7f-82dd-2586ab10875f"
    },
    {
      "s": "688df91d-26fa-4a7f-82dd-2586ab10875f",
      "p": "on-success",
      "o": "26b99e57-5205-4682-bb3c-acd1669f1157"
    },
    {
      "s": "26b99e57-5205-4682-bb3c-acd1669f1157",
      "p": "on-failure",
      "o": "75e4eed6-dd1e-456a-9677-078ad604fd9b"
    },
    {
      "s": "affd15ff-412a-4e3a-a675-9514413dacad",
      "p": "on-success",
      "o": "75e4eed6-dd1e-456a-9677-078ad604fd9b"
    },
    {
      "s": "affd15ff-412a-4e3a-a675-9514413dacad",
      "p": "on-failure",
      "o": "3568bf25-7eed-4007-9aa2-e14d9eb4f0b9"
    },
    {
      "s": "3568bf25-7eed-4007-9aa2-e14d9eb4f0b9",
      "p": "on-success",
      "o": "46dc11df-6388-4495-b835-0115fb49fb59"
    },
    {
      "s": "46dc11df-6388-4495-b835-0115fb49fb59",
      "p": "on-failure",
      "o": "75e4eed6-dd1e-456a-9677-078ad604fd9b"
    },
    {
      "s": "5df270e8-b418-429e-aa82-71df1abf24a5",
      "p": "on-success",
      "o": "75e4eed6-dd1e-456a-9677-078ad604fd9b"
    },
    {
      "s": "5df270e8-b418-429e-aa82-71df1abf24a5",
      "p": "on-failure",
      "o": "1f6743ed-28df-470f-b50d-00802626b5b0"
    },
    {
      "s": "1f6743ed-28df-470f-b50d-00802626b5b0",
      "p": "on-success",
      "o": "102af535-a2f6-46ed-8e55-0b64568b0eed"
    },
    {
      "s": "102af535-a2f6-46ed-8e55-0b64568b0eed",
      "p": "on-failure",
      "o": "75e4eed6-dd1e-456a-9677-078ad604fd9b"
    },
    {
      "s": "d727fbda-c781-4f98-b000-b5b551a85f55",
      "p": "on-success",
      "o": "75e4eed6-dd1e-456a-9677-078ad604fd9b"
    },
    {
      "s": "d727fbda-c781-4f98-b000-b5b551a85f55",
      "p": "on-failure",
      "o": "d48e9121-7d9f-4f9a-9447-9227d7fde7b2"
    },
    {
      "s": "d48e9121-7d9f-4f9a-9447-9227d7fde7b2",
      "p": "on-success",
      "o": "ea4d4e9c-5d72-47a1-b4e1-11703c0bed03"
    },
    {
      "s": "ea4d4e9c-5d72-47a1-b4e1-11703c0bed03",
      "p": "on-failure",
      "o": "75e4eed6-dd1e-456a-9677-078ad604fd9b"
    },
    {
      "s": "4fab9c5c-2d58-41f6-9041-95ba6439bf35",
      "p": "on-success",
      "o": "75e4eed6-dd1e-456a-9677-078ad604fd9b"
    },
    {
      "s": "4fab9c5c-2d58-41f6-9041-95ba6439bf35",
      "p": "on-failure",
      "o": "ca7a80f2-2eb0-48e4-a65c-facb5e90dbc0"
    },
    {
      "s": "ca7a80f2-2eb0-48e4-a65c-facb5e90dbc0",
      "p": "on-success",
      "o": "e43248d1-12c3-4290-b2a9-d332f7ab145e"
    },
    {
      "s": "e43248d1-12c3-4290-b2a9-d332f7ab145e",
      "p": "on-failure",
      "o": "75e4eed6-dd1e-456a-9677-078ad604fd9b"
    },
    {
      "s": "75da7124-cf69-4561-aafe-f5132ceb5a75",
      "p": "on-success",
      "o": "75e4eed6-dd1e-456a-9677-078ad604fd9b"
    },
    {
      "s": "75da7124-cf69-4561-aafe-f5132ceb5a75",
      "p": "on-failure",
      "o": "aec40615-783a-408c-987c-8a09717fb5a5"
    },
    {
      "s": "aec40615-783a-408c-987c-8a09717fb5a5",
      "p": "on-success",
      "o": "da9a7ba5-d12e-417c-8d9b-1fe883445aee"
    },
    {
      "s": "da9a7ba5-d12e-417c-8d9b-1fe883445aee",
      "p": "on-failure",
      "o": "75e4eed6-dd1e-456a-9677-078ad604fd9b"
    }
  ],
  "tags": [
    "T1552",
    "T1552.007"
  ]
}