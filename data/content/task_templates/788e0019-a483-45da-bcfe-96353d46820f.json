{
  "id": "788e0019-a483-45da-bcfe-96353d46820f",
  "name": "Cat the contents of a Kubernetes service account token file",
  "description": "Access the Kubernetes service account access token stored within a container in a cluster.\n",
  "platforms": [
    "linux"
  ],
  "steps": [
    {
      "id": "cbe1fd79-09a2-4ff1-b52c-b14746bd871d",
      "type": "execute-command",
      "data": {
        "command": "kubectl --context kind-atomic-cluster exec atomic-pod -- cat /run/secrets/kubernetes.io/serviceaccount/token",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "59399625-5afb-4508-b26c-fc42214fe18c",
      "type": "execute-command",
      "data": {
        "command": "kubectl --context kind-atomic-cluster delete pod atomic-pod",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "b7cdfa22-03b9-4cf8-a97d-92e810a7132d",
      "name": "Check dependency 1/6",
      "description": "Verify docker is installed.",
      "type": "execute-command",
      "data": {
        "command": "which docker",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "fe25ae63-7bf5-40a9-9b25-98886276f5c7",
      "name": "Resolve dependency 1/6",
      "description": "Verify docker is installed.",
      "type": "execute-command",
      "data": {
        "command": "if [ \"\" == \"`which docker`\" ]; then echo \"Docker Not Found\"; if [ -n \"`which apt-get`\" ]; then sudo apt-get -y install docker ; elif [ -n \"`which yum`\" ]; then sudo yum -y install docker ; fi ; else echo \"Docker installed\"; fi",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "db457ad5-c98d-42e1-b37e-ca02e8ae70bb",
      "name": "Re-check dependency 1/6",
      "description": "Verify docker is installed.",
      "type": "execute-command",
      "data": {
        "command": "which docker",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "ffb4fe30-dcb0-41d9-8db7-707b52753f84",
      "name": "Check dependency 2/6",
      "description": "Verify docker service is running.",
      "type": "execute-command",
      "data": {
        "command": "sudo systemctl status docker",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "c26566b7-0930-471f-aa46-7236e2d44543",
      "name": "Resolve dependency 2/6",
      "description": "Verify docker service is running.",
      "type": "execute-command",
      "data": {
        "command": "sudo systemctl start docker",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "f686bfe0-627e-415e-8da5-b91f5ac3ac48",
      "name": "Re-check dependency 2/6",
      "description": "Verify docker service is running.",
      "type": "execute-command",
      "data": {
        "command": "sudo systemctl status docker",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "af568d9b-f22d-4330-8bf3-f7e148838473",
      "name": "Check dependency 3/6",
      "description": "Verify kind is in the path.",
      "type": "execute-command",
      "data": {
        "command": "which kind",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "a2c2fafc-95b4-469b-81d0-bf0ec6189631",
      "name": "Resolve dependency 3/6",
      "description": "Verify kind is in the path.",
      "type": "execute-command",
      "data": {
        "command": "curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.10.0/kind-linux-amd64\nchmod +x ./kind\nmv kind /usr/bin/kind",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "11fa695a-3d38-4d80-9297-8c2d72a5efe7",
      "name": "Re-check dependency 3/6",
      "description": "Verify kind is in the path.",
      "type": "execute-command",
      "data": {
        "command": "which kind",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "e013bb01-6f6f-4fdf-84c7-aadcad2e3e19",
      "name": "Check dependency 4/6",
      "description": "Verify kind-atomic-cluster is created",
      "type": "execute-command",
      "data": {
        "command": "sudo kind get clusters",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "b639d554-74da-4d18-a760-6b2b1061abd2",
      "name": "Resolve dependency 4/6",
      "description": "Verify kind-atomic-cluster is created",
      "type": "execute-command",
      "data": {
        "command": "sudo kind create cluster --name atomic-cluster",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "ec9d6f02-5583-4956-bf52-8df03569e9d8",
      "name": "Re-check dependency 4/6",
      "description": "Verify kind-atomic-cluster is created",
      "type": "execute-command",
      "data": {
        "command": "sudo kind get clusters",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "fb359f65-0ded-40ee-a4eb-cebbc4257eec",
      "name": "Check dependency 5/6",
      "description": "Verify kubectl is in path",
      "type": "execute-command",
      "data": {
        "command": "which kubectl",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "113545aa-8098-4464-b35d-f7db51cb9b4d",
      "name": "Resolve dependency 5/6",
      "description": "Verify kubectl is in path",
      "type": "execute-command",
      "data": {
        "command": "curl -LO \"https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl\"\nchmod +x ./kubectl\nmv kubectl /usr/bin/kubectl",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "83425ec9-f956-41bd-a4eb-2e5d2992cf8a",
      "name": "Re-check dependency 5/6",
      "description": "Verify kubectl is in path",
      "type": "execute-command",
      "data": {
        "command": "which kubectl",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "1e7c1aac-5740-4917-8328-c93d300e5362",
      "name": "Check dependency 6/6",
      "description": "Verify atomic-pod is running.",
      "type": "execute-command",
      "data": {
        "command": "kubectl --context kind-atomic-cluster get pods |grep atomic-pod",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "ba19cc8e-799f-45b2-a360-ca66ea9a5a24",
      "name": "Resolve dependency 6/6",
      "description": "Verify atomic-pod is running.",
      "type": "execute-command",
      "data": {
        "command": "kubectl --context kind-atomic-cluster run atomic-pod --image=alpine --command -- sleep infinity",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "112ee8b2-3823-4385-88c9-e487e6cd5a30",
      "name": "Re-check dependency 6/6",
      "description": "Verify atomic-pod is running.",
      "type": "execute-command",
      "data": {
        "command": "kubectl --context kind-atomic-cluster get pods |grep atomic-pod",
        "command_type": "sh"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "cbe1fd79-09a2-4ff1-b52c-b14746bd871d",
      "p": "on-success",
      "o": "59399625-5afb-4508-b26c-fc42214fe18c"
    },
    {
      "s": "cbe1fd79-09a2-4ff1-b52c-b14746bd871d",
      "p": "on-failure",
      "o": "59399625-5afb-4508-b26c-fc42214fe18c"
    },
    {
      "s": "b7cdfa22-03b9-4cf8-a97d-92e810a7132d",
      "p": "on-success",
      "o": "cbe1fd79-09a2-4ff1-b52c-b14746bd871d"
    },
    {
      "s": "b7cdfa22-03b9-4cf8-a97d-92e810a7132d",
      "p": "on-failure",
      "o": "fe25ae63-7bf5-40a9-9b25-98886276f5c7"
    },
    {
      "s": "fe25ae63-7bf5-40a9-9b25-98886276f5c7",
      "p": "on-success",
      "o": "db457ad5-c98d-42e1-b37e-ca02e8ae70bb"
    },
    {
      "s": "db457ad5-c98d-42e1-b37e-ca02e8ae70bb",
      "p": "on-failure",
      "o": "cbe1fd79-09a2-4ff1-b52c-b14746bd871d"
    },
    {
      "s": "ffb4fe30-dcb0-41d9-8db7-707b52753f84",
      "p": "on-success",
      "o": "cbe1fd79-09a2-4ff1-b52c-b14746bd871d"
    },
    {
      "s": "ffb4fe30-dcb0-41d9-8db7-707b52753f84",
      "p": "on-failure",
      "o": "c26566b7-0930-471f-aa46-7236e2d44543"
    },
    {
      "s": "c26566b7-0930-471f-aa46-7236e2d44543",
      "p": "on-success",
      "o": "f686bfe0-627e-415e-8da5-b91f5ac3ac48"
    },
    {
      "s": "f686bfe0-627e-415e-8da5-b91f5ac3ac48",
      "p": "on-failure",
      "o": "cbe1fd79-09a2-4ff1-b52c-b14746bd871d"
    },
    {
      "s": "af568d9b-f22d-4330-8bf3-f7e148838473",
      "p": "on-success",
      "o": "cbe1fd79-09a2-4ff1-b52c-b14746bd871d"
    },
    {
      "s": "af568d9b-f22d-4330-8bf3-f7e148838473",
      "p": "on-failure",
      "o": "a2c2fafc-95b4-469b-81d0-bf0ec6189631"
    },
    {
      "s": "a2c2fafc-95b4-469b-81d0-bf0ec6189631",
      "p": "on-success",
      "o": "11fa695a-3d38-4d80-9297-8c2d72a5efe7"
    },
    {
      "s": "11fa695a-3d38-4d80-9297-8c2d72a5efe7",
      "p": "on-failure",
      "o": "cbe1fd79-09a2-4ff1-b52c-b14746bd871d"
    },
    {
      "s": "e013bb01-6f6f-4fdf-84c7-aadcad2e3e19",
      "p": "on-success",
      "o": "cbe1fd79-09a2-4ff1-b52c-b14746bd871d"
    },
    {
      "s": "e013bb01-6f6f-4fdf-84c7-aadcad2e3e19",
      "p": "on-failure",
      "o": "b639d554-74da-4d18-a760-6b2b1061abd2"
    },
    {
      "s": "b639d554-74da-4d18-a760-6b2b1061abd2",
      "p": "on-success",
      "o": "ec9d6f02-5583-4956-bf52-8df03569e9d8"
    },
    {
      "s": "ec9d6f02-5583-4956-bf52-8df03569e9d8",
      "p": "on-failure",
      "o": "cbe1fd79-09a2-4ff1-b52c-b14746bd871d"
    },
    {
      "s": "fb359f65-0ded-40ee-a4eb-cebbc4257eec",
      "p": "on-success",
      "o": "cbe1fd79-09a2-4ff1-b52c-b14746bd871d"
    },
    {
      "s": "fb359f65-0ded-40ee-a4eb-cebbc4257eec",
      "p": "on-failure",
      "o": "113545aa-8098-4464-b35d-f7db51cb9b4d"
    },
    {
      "s": "113545aa-8098-4464-b35d-f7db51cb9b4d",
      "p": "on-success",
      "o": "83425ec9-f956-41bd-a4eb-2e5d2992cf8a"
    },
    {
      "s": "83425ec9-f956-41bd-a4eb-2e5d2992cf8a",
      "p": "on-failure",
      "o": "cbe1fd79-09a2-4ff1-b52c-b14746bd871d"
    },
    {
      "s": "1e7c1aac-5740-4917-8328-c93d300e5362",
      "p": "on-success",
      "o": "cbe1fd79-09a2-4ff1-b52c-b14746bd871d"
    },
    {
      "s": "1e7c1aac-5740-4917-8328-c93d300e5362",
      "p": "on-failure",
      "o": "ba19cc8e-799f-45b2-a360-ca66ea9a5a24"
    },
    {
      "s": "ba19cc8e-799f-45b2-a360-ca66ea9a5a24",
      "p": "on-success",
      "o": "112ee8b2-3823-4385-88c9-e487e6cd5a30"
    },
    {
      "s": "112ee8b2-3823-4385-88c9-e487e6cd5a30",
      "p": "on-failure",
      "o": "cbe1fd79-09a2-4ff1-b52c-b14746bd871d"
    }
  ],
  "tags": [
    "T1552",
    "T1552.007"
  ]
}