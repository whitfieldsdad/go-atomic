{
  "id": "e9313014-985a-48ef-80d9-cde604ffc187",
  "name": "Windows Screen Capture (CopyFromScreen)",
  "description": "Take a screen capture of the desktop through a call to the [Graphics.CopyFromScreen] .NET API.\n\n[Graphics.CopyFromScreen]: https://docs.microsoft.com/en-us/dotnet/api/system.drawing.graphics.copyfromscreen\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "84ef87d9-6843-4496-a782-108e9d97aa8c",
      "type": "execute-command",
      "data": {
        "command": "Add-Type -AssemblyName System.Windows.Forms\n$screen = [Windows.Forms.SystemInformation]::VirtualScreen\n$bitmap = New-Object Drawing.Bitmap $screen.Width, $screen.Height\n$graphic = [Drawing.Graphics]::FromImage($bitmap)\n$graphic.CopyFromScreen($screen.Left, $screen.Top, 0, 0, $bitmap.Size)\n$bitmap.Save(\"#{output_file}\")\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "61a6dd52-4664-4ae7-8f07-f17f9bf6e932",
      "type": "execute-command",
      "data": {
        "command": "Remove-Item #{output_file} -ErrorAction Ignore\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "84ef87d9-6843-4496-a782-108e9d97aa8c",
      "p": "on-success",
      "o": "61a6dd52-4664-4ae7-8f07-f17f9bf6e932"
    },
    {
      "s": "84ef87d9-6843-4496-a782-108e9d97aa8c",
      "p": "on-failure",
      "o": "61a6dd52-4664-4ae7-8f07-f17f9bf6e932"
    }
  ],
  "tags": [
    "T1113",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "output_file",
      "type": "path",
      "description": "Path where captured results will be placed",
      "value": "$env:TEMP\\T1113.png"
    }
  ]
}