{
  "id": "a5b2f6a0-24b4-493e-9590-c699f75723ca",
  "name": "Packet Capture Windows Command Prompt",
  "description": "Perform a packet capture using the windows command prompt. This will require a host that has Wireshark/Tshark\ninstalled.\n\nUpon successful execution, tshark will execute and capture 5 packets on interface \"Ethernet\".\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "a1f5b842-6097-4497-8a34-e198e0ac622f",
      "type": "execute-command",
      "data": {
        "command": "\"c:\\Program Files\\Wireshark\\tshark.exe\" -i #{interface} -c 5\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "4dd54884-a7c7-4058-bc35-0c448f5e5b5b",
      "name": "Check dependency 1/2",
      "description": "tshark must be installed and in the default path of \"c:\\Program Files\\Wireshark\\Tshark.exe\".\n",
      "type": "execute-command",
      "data": {
        "command": "if (test-path \"#{tshark_path}\") {exit 0} else {exit 1}",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "7b268e3d-5922-4200-b96f-7d1db3318aa5",
      "name": "Resolve dependency 1/2",
      "description": "tshark must be installed and in the default path of \"c:\\Program Files\\Wireshark\\Tshark.exe\".\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest -OutFile \"PathToAtomicsFolder\\..\\ExternalPayloads\\wireshark_installer.exe\" #{wireshark_url}\nStart-Process \"PathToAtomicsFolder\\..\\ExternalPayloads\\wireshark_installer.exe\" /S\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "d0dae898-be47-44df-86f2-4b8bd52b6dd5",
      "name": "Re-check dependency 1/2",
      "description": "tshark must be installed and in the default path of \"c:\\Program Files\\Wireshark\\Tshark.exe\".\n",
      "type": "execute-command",
      "data": {
        "command": "if (test-path \"#{tshark_path}\") {exit 0} else {exit 1}",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "a96f1a7a-0601-4e1f-90e5-a0832c0c24b7",
      "name": "Check dependency 2/2",
      "description": "npcap must be installed.\n",
      "type": "execute-command",
      "data": {
        "command": "if (test-path \"#{npcap_path}\") {exit 0} else {exit 1}",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "73f9c703-8713-431a-b65a-282e48dcd97a",
      "name": "Resolve dependency 2/2",
      "description": "npcap must be installed.\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest -OutFile \"PathToAtomicsFolder\\..\\ExternalPayloads\\npcap_installer.exe\" #{npcap_url}\nStart-Process \"PathToAtomicsFolder\\..\\ExternalPayloads\\npcap_installer.exe\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "c0840280-fe9f-4dc0-869d-fad48db9df22",
      "name": "Re-check dependency 2/2",
      "description": "npcap must be installed.\n",
      "type": "execute-command",
      "data": {
        "command": "if (test-path \"#{npcap_path}\") {exit 0} else {exit 1}",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "4dd54884-a7c7-4058-bc35-0c448f5e5b5b",
      "p": "on-success",
      "o": "a1f5b842-6097-4497-8a34-e198e0ac622f"
    },
    {
      "s": "4dd54884-a7c7-4058-bc35-0c448f5e5b5b",
      "p": "on-failure",
      "o": "7b268e3d-5922-4200-b96f-7d1db3318aa5"
    },
    {
      "s": "7b268e3d-5922-4200-b96f-7d1db3318aa5",
      "p": "on-success",
      "o": "d0dae898-be47-44df-86f2-4b8bd52b6dd5"
    },
    {
      "s": "d0dae898-be47-44df-86f2-4b8bd52b6dd5",
      "p": "on-failure",
      "o": "a1f5b842-6097-4497-8a34-e198e0ac622f"
    },
    {
      "s": "a96f1a7a-0601-4e1f-90e5-a0832c0c24b7",
      "p": "on-success",
      "o": "a1f5b842-6097-4497-8a34-e198e0ac622f"
    },
    {
      "s": "a96f1a7a-0601-4e1f-90e5-a0832c0c24b7",
      "p": "on-failure",
      "o": "73f9c703-8713-431a-b65a-282e48dcd97a"
    },
    {
      "s": "73f9c703-8713-431a-b65a-282e48dcd97a",
      "p": "on-success",
      "o": "c0840280-fe9f-4dc0-869d-fad48db9df22"
    },
    {
      "s": "c0840280-fe9f-4dc0-869d-fad48db9df22",
      "p": "on-failure",
      "o": "a1f5b842-6097-4497-8a34-e198e0ac622f"
    }
  ],
  "tags": [
    "T1040",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "wireshark_url",
      "type": "url",
      "description": "wireshark installer download URL",
      "value": "https://1.eu.dl.wireshark.org/win64/Wireshark-win64-latest.exe"
    },
    {
      "name": "tshark_path",
      "type": "path",
      "description": "path to tshark.exe",
      "value": "c:\\program files\\wireshark\\tshark.exe"
    },
    {
      "name": "npcap_url",
      "type": "url",
      "description": "npcap installed download URL",
      "value": "https://nmap.org/npcap/dist/npcap-1.31.exe"
    },
    {
      "name": "npcap_path",
      "type": "path",
      "description": "path to npcap.sys",
      "value": "C:\\Program Files\\Npcap\\npcap.sys"
    },
    {
      "name": "interface",
      "type": "string",
      "description": "Specify interface to perform PCAP on.",
      "value": "Ethernet"
    }
  ]
}