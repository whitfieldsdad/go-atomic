{
  "id": "502a7dc4-9d6f-4d28-abf2-f0e84692562d",
  "name": "Detect Virtualization Environment (Windows)",
  "description": "Windows Management Instrumentation(WMI) objects contains system information which helps to detect virtualization. This command will specifically attempt to get the CurrentTemperature value from this object and will check to see if the attempt results in an error that contains the word supported. This is meant to find the result of Not supported, which is the result if run in a virtual machine\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "f533dd2a-d6ab-4356-b77d-fdf048714b2a",
      "type": "execute-command",
      "data": {
        "command": "$error.clear()\nGet-WmiObject -Query \"SELECT * FROM MSAcpi_ThermalZoneTemperature\" -ErrorAction SilentlyContinue\nif($error) {echo \"Virtualization Environment detected\"}\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "973a072f-0af2-4047-b64c-43158bef5db4",
      "type": "execute-command",
      "data": {
        "command": "$error.clear()\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "f533dd2a-d6ab-4356-b77d-fdf048714b2a",
      "p": "on-success",
      "o": "973a072f-0af2-4047-b64c-43158bef5db4"
    },
    {
      "s": "f533dd2a-d6ab-4356-b77d-fdf048714b2a",
      "p": "on-failure",
      "o": "973a072f-0af2-4047-b64c-43158bef5db4"
    }
  ],
  "tags": [
    "T1497.001",
    "atomic-red-team"
  ]
}