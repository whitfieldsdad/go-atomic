{
  "id": "899a7fb5-d197-4951-8614-f19ac4a73ad4",
  "name": "Modify/delete iptables firewall rules",
  "description": "Instead of completely \"disabling\" iptables, adversaries may choose to delete a certain rule, which, for example, blocks data exfiltration via ftp.\nBy doing so, they may cause less noise to avoid detection. \n",
  "platforms": [
    "linux"
  ],
  "steps": [
    {
      "id": "0254517b-3c74-4cb4-87a3-631a229e9943",
      "type": "execute-command",
      "data": {
        "command": "iptables-save \u003e /tmp/iptables.rules\niptables -D OUTPUT -p tcp --dport 21 -j DROP\n",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "d681a475-51ca-4dec-8088-029c6a41a289",
      "type": "execute-command",
      "data": {
        "command": "iptables-restore \u003c /tmp/iptables.rules\n",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "1ea5415a-80c1-42de-9dc0-149244751684",
      "name": "Check dependency 1/1",
      "description": "Check if iptables is installed on the machine.\n",
      "type": "execute-command",
      "data": {
        "command": "if [ ! -x \"$(command -v iptables)\" ]; then echo -e \"\\n***** iptables NOT installed *****\\n\"; exit 1; fi\nif ! echo \"$(iptables -L)\" | grep -q \"DROP .*dpt:ftp\"; then echo -e \"\\n***** this firewall rule is NOT activated *****\\n***** activate it by executing \\\"iptables -A OUTPUT -p tcp --dport 21 -j DROP\\\" *****\\n\"; exit 1; fi\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "46242c03-d6cf-48b9-b9e6-65bf0fbcc8a3",
      "name": "Resolve dependency 1/1",
      "description": "Check if iptables is installed on the machine.\n",
      "type": "execute-command",
      "data": {
        "command": "echo \"\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "947fccf0-b7a6-4301-b157-673ddc562c0c",
      "name": "Re-check dependency 1/1",
      "description": "Check if iptables is installed on the machine.\n",
      "type": "execute-command",
      "data": {
        "command": "if [ ! -x \"$(command -v iptables)\" ]; then echo -e \"\\n***** iptables NOT installed *****\\n\"; exit 1; fi\nif ! echo \"$(iptables -L)\" | grep -q \"DROP .*dpt:ftp\"; then echo -e \"\\n***** this firewall rule is NOT activated *****\\n***** activate it by executing \\\"iptables -A OUTPUT -p tcp --dport 21 -j DROP\\\" *****\\n\"; exit 1; fi\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "0254517b-3c74-4cb4-87a3-631a229e9943",
      "p": "on-success",
      "o": "d681a475-51ca-4dec-8088-029c6a41a289"
    },
    {
      "s": "0254517b-3c74-4cb4-87a3-631a229e9943",
      "p": "on-failure",
      "o": "d681a475-51ca-4dec-8088-029c6a41a289"
    },
    {
      "s": "1ea5415a-80c1-42de-9dc0-149244751684",
      "p": "on-success",
      "o": "0254517b-3c74-4cb4-87a3-631a229e9943"
    },
    {
      "s": "1ea5415a-80c1-42de-9dc0-149244751684",
      "p": "on-failure",
      "o": "46242c03-d6cf-48b9-b9e6-65bf0fbcc8a3"
    },
    {
      "s": "46242c03-d6cf-48b9-b9e6-65bf0fbcc8a3",
      "p": "on-success",
      "o": "947fccf0-b7a6-4301-b157-673ddc562c0c"
    },
    {
      "s": "947fccf0-b7a6-4301-b157-673ddc562c0c",
      "p": "on-failure",
      "o": "0254517b-3c74-4cb4-87a3-631a229e9943"
    }
  ],
  "tags": [
    "T1562.004",
    "atomic-red-team"
  ]
}