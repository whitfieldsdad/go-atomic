{
  "id": "899a7fb5-d197-4951-8614-f19ac4a73ad4",
  "name": "Modify/delete iptables firewall rules",
  "description": "Instead of completely \"disabling\" iptables, adversaries may choose to delete a certain rule, which, for example, blocks data exfiltration via ftp.\nBy doing so, they may cause less noise to avoid detection. \n",
  "platforms": [
    "linux"
  ],
  "steps": [
    {
      "id": "28ceb8d6-3e96-431a-bea1-615289c40708",
      "type": "execute-command",
      "data": {
        "command": "iptables-save \u003e /tmp/iptables.rules\niptables -D OUTPUT -p tcp --dport 21 -j DROP\n",
        "command_type": "sh"
      },
      "elevation_required": true
    },
    {
      "id": "81118267-6c04-49c2-81cd-4391c393cd91",
      "type": "execute-command",
      "data": {
        "command": "iptables-restore \u003c /tmp/iptables.rules\n",
        "command_type": "sh"
      },
      "elevation_required": true
    },
    {
      "id": "2d640b46-01b8-4f0d-90e6-d56368e07d50",
      "name": "Check dependency 1/1",
      "description": "Check if iptables is installed on the machine.\n",
      "type": "execute-command",
      "data": {
        "command": "if [ ! -x \"$(command -v iptables)\" ]; then echo -e \"\\n***** iptables NOT installed *****\\n\"; exit 1; fi\nif ! echo \"$(iptables -L)\" | grep -q \"DROP .*dpt:ftp\"; then echo -e \"\\n***** this firewall rule is NOT activated *****\\n***** activate it by executing \\\"iptables -A OUTPUT -p tcp --dport 21 -j DROP\\\" *****\\n\"; exit 1; fi\n",
        "command_type": ""
      },
      "elevation_required": true
    },
    {
      "id": "6d425b3f-cf28-4973-8fbb-60788767d324",
      "name": "Resolve dependency 1/1",
      "description": "Check if iptables is installed on the machine.\n",
      "type": "execute-command",
      "data": {
        "command": "echo \"\"\n",
        "command_type": ""
      },
      "elevation_required": true
    },
    {
      "id": "adaf06b5-c54f-4765-8bcc-303a154856ca",
      "name": "Re-check dependency 1/1",
      "description": "Check if iptables is installed on the machine.\n",
      "type": "execute-command",
      "data": {
        "command": "if [ ! -x \"$(command -v iptables)\" ]; then echo -e \"\\n***** iptables NOT installed *****\\n\"; exit 1; fi\nif ! echo \"$(iptables -L)\" | grep -q \"DROP .*dpt:ftp\"; then echo -e \"\\n***** this firewall rule is NOT activated *****\\n***** activate it by executing \\\"iptables -A OUTPUT -p tcp --dport 21 -j DROP\\\" *****\\n\"; exit 1; fi\n",
        "command_type": ""
      },
      "elevation_required": true
    }
  ],
  "flows": [
    {
      "s": "28ceb8d6-3e96-431a-bea1-615289c40708",
      "p": "on-success",
      "o": "81118267-6c04-49c2-81cd-4391c393cd91"
    },
    {
      "s": "28ceb8d6-3e96-431a-bea1-615289c40708",
      "p": "on-failure",
      "o": "81118267-6c04-49c2-81cd-4391c393cd91"
    },
    {
      "s": "2d640b46-01b8-4f0d-90e6-d56368e07d50",
      "p": "on-success",
      "o": "28ceb8d6-3e96-431a-bea1-615289c40708"
    },
    {
      "s": "2d640b46-01b8-4f0d-90e6-d56368e07d50",
      "p": "on-failure",
      "o": "6d425b3f-cf28-4973-8fbb-60788767d324"
    },
    {
      "s": "6d425b3f-cf28-4973-8fbb-60788767d324",
      "p": "on-success",
      "o": "adaf06b5-c54f-4765-8bcc-303a154856ca"
    },
    {
      "s": "adaf06b5-c54f-4765-8bcc-303a154856ca",
      "p": "on-failure",
      "o": "28ceb8d6-3e96-431a-bea1-615289c40708"
    }
  ],
  "tags": [
    "T1562",
    "T1562.004"
  ]
}