{
  "id": "899a7fb5-d197-4951-8614-f19ac4a73ad4",
  "name": "Modify/delete iptables firewall rules",
  "description": "Instead of completely \"disabling\" iptables, adversaries may choose to delete a certain rule, which, for example, blocks data exfiltration via ftp.\nBy doing so, they may cause less noise to avoid detection. \n",
  "platforms": [
    "linux"
  ],
  "steps": [
    {
      "id": "4ab89480-d035-49e0-abc1-dcc616e4e712",
      "type": "execute-command",
      "data": {
        "command": "iptables-save \u003e /tmp/iptables.rules\niptables -D OUTPUT -p tcp --dport 21 -j DROP",
        "command_type": "sh"
      },
      "elevation_required": true
    },
    {
      "id": "16ce3dd7-218e-4974-805f-59db23bafbbc",
      "type": "execute-command",
      "data": {
        "command": "iptables-restore \u003c /tmp/iptables.rules",
        "command_type": "sh"
      },
      "elevation_required": true
    },
    {
      "id": "88452aba-d292-465f-9cad-304fc1dd70b8",
      "name": "Check dependency 1/1",
      "description": "Check if iptables is installed on the machine.\n",
      "type": "execute-command",
      "data": {
        "command": "if [ ! -x \"$(command -v iptables)\" ]; then echo -e \"\\n***** iptables NOT installed *****\\n\"; exit 1; fi\nif ! echo \"$(iptables -L)\" | grep -q \"DROP .*dpt:ftp\"; then echo -e \"\\n***** this firewall rule is NOT activated *****\\n***** activate it by executing \\\"iptables -A OUTPUT -p tcp --dport 21 -j DROP\\\" *****\\n\"; exit 1; fi",
        "command_type": "sh"
      },
      "elevation_required": true
    },
    {
      "id": "e942a0c8-97f3-4e2f-9d0d-42d679af46b4",
      "name": "Resolve dependency 1/1",
      "description": "Check if iptables is installed on the machine.\n",
      "type": "execute-command",
      "data": {
        "command": "echo \"\"",
        "command_type": "sh"
      },
      "elevation_required": true
    },
    {
      "id": "96965947-f4a4-486c-a70b-9bd7a4a4ebe5",
      "name": "Re-check dependency 1/1",
      "description": "Check if iptables is installed on the machine.\n",
      "type": "execute-command",
      "data": {
        "command": "if [ ! -x \"$(command -v iptables)\" ]; then echo -e \"\\n***** iptables NOT installed *****\\n\"; exit 1; fi\nif ! echo \"$(iptables -L)\" | grep -q \"DROP .*dpt:ftp\"; then echo -e \"\\n***** this firewall rule is NOT activated *****\\n***** activate it by executing \\\"iptables -A OUTPUT -p tcp --dport 21 -j DROP\\\" *****\\n\"; exit 1; fi",
        "command_type": "sh"
      },
      "elevation_required": true
    }
  ],
  "flows": [
    {
      "s": "4ab89480-d035-49e0-abc1-dcc616e4e712",
      "p": "on-success",
      "o": "16ce3dd7-218e-4974-805f-59db23bafbbc"
    },
    {
      "s": "4ab89480-d035-49e0-abc1-dcc616e4e712",
      "p": "on-failure",
      "o": "16ce3dd7-218e-4974-805f-59db23bafbbc"
    },
    {
      "s": "88452aba-d292-465f-9cad-304fc1dd70b8",
      "p": "on-success",
      "o": "4ab89480-d035-49e0-abc1-dcc616e4e712"
    },
    {
      "s": "88452aba-d292-465f-9cad-304fc1dd70b8",
      "p": "on-failure",
      "o": "e942a0c8-97f3-4e2f-9d0d-42d679af46b4"
    },
    {
      "s": "e942a0c8-97f3-4e2f-9d0d-42d679af46b4",
      "p": "on-success",
      "o": "96965947-f4a4-486c-a70b-9bd7a4a4ebe5"
    },
    {
      "s": "96965947-f4a4-486c-a70b-9bd7a4a4ebe5",
      "p": "on-failure",
      "o": "4ab89480-d035-49e0-abc1-dcc616e4e712"
    }
  ],
  "tags": [
    "T1562",
    "T1562.004"
  ],
  "input_arguments": null
}