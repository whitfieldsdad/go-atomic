{
  "id": "870ba71e-6858-4f6d-895c-bb6237f6121b",
  "name": "Enumerate Users Not Requiring Pre Auth (ASRepRoast)",
  "description": "When successful, accounts that do not require kerberos pre-auth will be returned\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "14eee402-5e88-4fb1-8d9e-b631b258219b",
      "type": "execute-command",
      "data": {
        "command": "get-aduser -f * -pr DoesNotRequirePreAuth | where {$_.DoesNotRequirePreAuth -eq $TRUE}\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "7b0ea821-9d8e-4e3e-bdf3-5f32579ef539",
      "name": "Check dependency 1/2",
      "description": "Computer must be domain joined.\n",
      "type": "execute-command",
      "data": {
        "command": "if((Get-CIMInstance -Class Win32_ComputerSystem).PartOfDomain) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "10de5741-4aa3-4f46-993a-363b38d981ff",
      "name": "Resolve dependency 1/2",
      "description": "Computer must be domain joined.\n",
      "type": "execute-command",
      "data": {
        "command": "Write-Host Joining this computer to a domain must be done manually.\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "84f861ab-b00d-4570-b7a8-f11d6e1ad74d",
      "name": "Re-check dependency 1/2",
      "description": "Computer must be domain joined.\n",
      "type": "execute-command",
      "data": {
        "command": "if((Get-CIMInstance -Class Win32_ComputerSystem).PartOfDomain) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "5afcc8b1-cceb-44b6-91c2-a7d6aedc6c3e",
      "name": "Check dependency 2/2",
      "description": "Requires the Active Directory module for powershell to be installed.\n",
      "type": "execute-command",
      "data": {
        "command": "if(Get-Module -ListAvailable -Name ActiveDirectory) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "7ff795ef-91dd-4604-b0cb-d0d0bb5ba8ad",
      "name": "Resolve dependency 2/2",
      "description": "Requires the Active Directory module for powershell to be installed.\n",
      "type": "execute-command",
      "data": {
        "command": "Add-WindowsCapability -Online -Name \"Rsat.ActiveDirectory.DS-LDS.Tools~~~~0.0.1.0\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "17919c17-dd13-4af8-8018-4326b594c5b4",
      "name": "Re-check dependency 2/2",
      "description": "Requires the Active Directory module for powershell to be installed.\n",
      "type": "execute-command",
      "data": {
        "command": "if(Get-Module -ListAvailable -Name ActiveDirectory) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "7b0ea821-9d8e-4e3e-bdf3-5f32579ef539",
      "p": "on-success",
      "o": "14eee402-5e88-4fb1-8d9e-b631b258219b"
    },
    {
      "s": "7b0ea821-9d8e-4e3e-bdf3-5f32579ef539",
      "p": "on-failure",
      "o": "10de5741-4aa3-4f46-993a-363b38d981ff"
    },
    {
      "s": "10de5741-4aa3-4f46-993a-363b38d981ff",
      "p": "on-success",
      "o": "84f861ab-b00d-4570-b7a8-f11d6e1ad74d"
    },
    {
      "s": "84f861ab-b00d-4570-b7a8-f11d6e1ad74d",
      "p": "on-failure",
      "o": "14eee402-5e88-4fb1-8d9e-b631b258219b"
    },
    {
      "s": "5afcc8b1-cceb-44b6-91c2-a7d6aedc6c3e",
      "p": "on-success",
      "o": "14eee402-5e88-4fb1-8d9e-b631b258219b"
    },
    {
      "s": "5afcc8b1-cceb-44b6-91c2-a7d6aedc6c3e",
      "p": "on-failure",
      "o": "7ff795ef-91dd-4604-b0cb-d0d0bb5ba8ad"
    },
    {
      "s": "7ff795ef-91dd-4604-b0cb-d0d0bb5ba8ad",
      "p": "on-success",
      "o": "17919c17-dd13-4af8-8018-4326b594c5b4"
    },
    {
      "s": "17919c17-dd13-4af8-8018-4326b594c5b4",
      "p": "on-failure",
      "o": "14eee402-5e88-4fb1-8d9e-b631b258219b"
    }
  ],
  "tags": [
    "T1069.002",
    "atomic-red-team"
  ]
}