{
  "id": "efe86d95-44c4-4509-ae42-7bfd9d1f5b3d",
  "name": "WinRM Access with Evil-WinRM",
  "description": "An adversary may attempt to use Evil-WinRM with a valid account to interact with remote systems that have WinRM enabled",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "43cb8a00-f24e-47c0-8ff6-2793cb47c39f",
      "type": "execute-command",
      "data": {
        "command": "evil-winrm -i #{destination_address} -u #{user_name} -p #{password}",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "ae48d153-2373-4240-92ff-92fcff8ec5ba",
      "name": "Check dependency 1/2",
      "description": "Computer must have Ruby Installed",
      "type": "execute-command",
      "data": {
        "command": "try {if (ruby -v) {exit 0} else {exit 1}} catch {exit 1}",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "59e61fc7-72ed-4851-b946-35445eb88c14",
      "name": "Resolve dependency 1/2",
      "description": "Computer must have Ruby Installed",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest  -OutFile \"PathToAtomicsFolder\\..\\ExternalPayloads\\rubyinstaller-2.7.1-1-x64.exe\" https://github.com/oneclick/rubyinstaller2/releases/download/RubyInstaller-2.7.1-1/rubyinstaller-2.7.1-1-x64.exe\n$file1= \"PathToAtomicsFolder\\..\\ExternalPayloads\\rubyinstaller-2.7.1-1-x64.exe\"\nStart-Process $file1 /S;",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "c63f6c2d-0470-4087-9f17-82af33b54939",
      "name": "Re-check dependency 1/2",
      "description": "Computer must have Ruby Installed",
      "type": "execute-command",
      "data": {
        "command": "try {if (ruby -v) {exit 0} else {exit 1}} catch {exit 1}",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "4b4b51e4-00f7-43ad-a5d2-c4d3b88dc36a",
      "name": "Check dependency 2/2",
      "description": "Computer must have Evil-WinRM installed",
      "type": "execute-command",
      "data": {
        "command": "try {if (evil-winrm -h) {exit 0} else {exit 1}} catch {exit 1}",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "2805164c-7ea3-4c18-91d9-85974935c8ec",
      "name": "Resolve dependency 2/2",
      "description": "Computer must have Evil-WinRM installed",
      "type": "execute-command",
      "data": {
        "command": "gem install evil-winrm",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "51ebc1f6-77c3-428c-858e-aa386541e7a1",
      "name": "Re-check dependency 2/2",
      "description": "Computer must have Evil-WinRM installed",
      "type": "execute-command",
      "data": {
        "command": "try {if (evil-winrm -h) {exit 0} else {exit 1}} catch {exit 1}",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "ae48d153-2373-4240-92ff-92fcff8ec5ba",
      "p": "on-success",
      "o": "43cb8a00-f24e-47c0-8ff6-2793cb47c39f"
    },
    {
      "s": "ae48d153-2373-4240-92ff-92fcff8ec5ba",
      "p": "on-failure",
      "o": "59e61fc7-72ed-4851-b946-35445eb88c14"
    },
    {
      "s": "59e61fc7-72ed-4851-b946-35445eb88c14",
      "p": "on-success",
      "o": "c63f6c2d-0470-4087-9f17-82af33b54939"
    },
    {
      "s": "c63f6c2d-0470-4087-9f17-82af33b54939",
      "p": "on-failure",
      "o": "43cb8a00-f24e-47c0-8ff6-2793cb47c39f"
    },
    {
      "s": "4b4b51e4-00f7-43ad-a5d2-c4d3b88dc36a",
      "p": "on-success",
      "o": "43cb8a00-f24e-47c0-8ff6-2793cb47c39f"
    },
    {
      "s": "4b4b51e4-00f7-43ad-a5d2-c4d3b88dc36a",
      "p": "on-failure",
      "o": "2805164c-7ea3-4c18-91d9-85974935c8ec"
    },
    {
      "s": "2805164c-7ea3-4c18-91d9-85974935c8ec",
      "p": "on-success",
      "o": "51ebc1f6-77c3-428c-858e-aa386541e7a1"
    },
    {
      "s": "51ebc1f6-77c3-428c-858e-aa386541e7a1",
      "p": "on-failure",
      "o": "43cb8a00-f24e-47c0-8ff6-2793cb47c39f"
    }
  ],
  "tags": [
    "T1021.006",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "password",
      "type": "string",
      "description": "Password",
      "value": "P@ssw0rd1"
    },
    {
      "name": "user_name",
      "type": "string",
      "description": "Username",
      "value": "Domain\\Administrator"
    },
    {
      "name": "destination_address",
      "type": "string",
      "description": "Remote Host IP or Hostname",
      "value": "Target"
    }
  ]
}