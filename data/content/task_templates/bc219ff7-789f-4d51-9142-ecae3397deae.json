{
  "id": "bc219ff7-789f-4d51-9142-ecae3397deae",
  "name": "Shared Library Injection via LD_PRELOAD",
  "description": "This test injects a shared object library via the LD_PRELOAD environment variable to execute. This technique was used by threat actor Rocke during the exploitation of Linux web servers. This requires the `glibc` package.\n\nUpon successful execution, bash will utilize LD_PRELOAD to load the shared object library `/etc/ld.so.preload`. Output will be via stdout.\n",
  "platforms": [
    "linux"
  ],
  "steps": [
    {
      "id": "0f43f9ed-d62f-4829-9625-c8d4b42d1d01",
      "type": "execute-command",
      "data": {
        "command": "LD_PRELOAD=#{path_to_shared_library} ls\n",
        "command_type": "bash"
      },
      "elevation_required": false
    },
    {
      "id": "ea5084df-392e-4159-adcb-8cadba6b2b89",
      "name": "Check dependency 1/1",
      "description": "The shared library must exist on disk at specified location (#{path_to_shared_library})\n",
      "type": "execute-command",
      "data": {
        "command": "if [ -f #{path_to_shared_library} ]; then exit 0; else exit 1; fi;\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "fa8743a1-40c3-47fd-8b78-04b39f24bc43",
      "name": "Resolve dependency 1/1",
      "description": "The shared library must exist on disk at specified location (#{path_to_shared_library})\n",
      "type": "execute-command",
      "data": {
        "command": "gcc -shared -fPIC -o #{path_to_shared_library} #{path_to_shared_library_source}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "ed0deea7-cd8e-4e21-9d62-753976a52e2d",
      "name": "Re-check dependency 1/1",
      "description": "The shared library must exist on disk at specified location (#{path_to_shared_library})\n",
      "type": "execute-command",
      "data": {
        "command": "if [ -f #{path_to_shared_library} ]; then exit 0; else exit 1; fi;\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "ea5084df-392e-4159-adcb-8cadba6b2b89",
      "p": "on-success",
      "o": "0f43f9ed-d62f-4829-9625-c8d4b42d1d01"
    },
    {
      "s": "ea5084df-392e-4159-adcb-8cadba6b2b89",
      "p": "on-failure",
      "o": "fa8743a1-40c3-47fd-8b78-04b39f24bc43"
    },
    {
      "s": "fa8743a1-40c3-47fd-8b78-04b39f24bc43",
      "p": "on-success",
      "o": "ed0deea7-cd8e-4e21-9d62-753976a52e2d"
    },
    {
      "s": "ed0deea7-cd8e-4e21-9d62-753976a52e2d",
      "p": "on-failure",
      "o": "0f43f9ed-d62f-4829-9625-c8d4b42d1d01"
    }
  ],
  "tags": [
    "T1574.006",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "path_to_shared_library_source",
      "type": "path",
      "description": "Path to a shared library source code",
      "value": "PathToAtomicsFolder/T1574.006/src/Linux/T1574.006.c"
    },
    {
      "name": "path_to_shared_library",
      "type": "path",
      "description": "Path to a shared library object",
      "value": "/tmp/T1574006.so"
    }
  ]
}