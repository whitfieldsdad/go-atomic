{
  "id": "8dbfc15c-527b-4ab0-a272-019f469d367f",
  "name": "Cobalt Strike post-exploitation pipe (before 4.2)",
  "description": "Uses the [Named Pipes Micro Emulation](https://github.com/center-for-threat-informed-defense/adversary_emulation_library/tree/master/micro_emulation_plans/src/named_pipes) executable from the Center for Threat Informed Defense to create a named pipe for inter-process communication.\n\nThe named pipe executable will pause for 30 seconds to allow the client and server to exchange a message through the pipe.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "b6ee8ee9-97e2-4627-b79b-ceaaabd5b0e5",
      "type": "execute-command",
      "data": {
        "command": "\"PathToAtomicsFolder\\..\\ExternalPayloads\\build\\namedpipes_executor.exe\" --pipe 5\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "a9a61cf6-f570-4bf9-8188-c2cfe5825136",
      "name": "Check dependency 1/1",
      "description": "Named pipe executors must exist on disk\n",
      "type": "execute-command",
      "data": {
        "command": "if ((Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\build\\namedpipes_executor.exe\") -and (Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\build\\namedpipes_client.exe\") -and (\"Test-Path PathToAtomicsFolder\\..\\ExternalPayloads\\build\\namedpipes_server.exe\")) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "a900d638-3326-4caa-a97e-c30ff99b9dc0",
      "name": "Resolve dependency 1/1",
      "description": "Named pipe executors must exist on disk\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\n[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/invoke-atomicredteam/master/Public/Invoke-FetchFromZip.ps1\" -UseBasicParsing)\n$zipUrl  = \"https://github.com/center-for-threat-informed-defense/adversary_emulation_library/raw/master/micro_emulation_plans/src/named_pipes/named_pipes.zip\"\nInvoke-FetchFromZip $zipUrl \"*.exe\" \"PathToAtomicsFolder\\..\\ExternalPayloads\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "d37649b4-8a3b-46e6-947f-82d619f00b59",
      "name": "Re-check dependency 1/1",
      "description": "Named pipe executors must exist on disk\n",
      "type": "execute-command",
      "data": {
        "command": "if ((Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\build\\namedpipes_executor.exe\") -and (Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\build\\namedpipes_client.exe\") -and (\"Test-Path PathToAtomicsFolder\\..\\ExternalPayloads\\build\\namedpipes_server.exe\")) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "a9a61cf6-f570-4bf9-8188-c2cfe5825136",
      "p": "on-success",
      "o": "b6ee8ee9-97e2-4627-b79b-ceaaabd5b0e5"
    },
    {
      "s": "a9a61cf6-f570-4bf9-8188-c2cfe5825136",
      "p": "on-failure",
      "o": "a900d638-3326-4caa-a97e-c30ff99b9dc0"
    },
    {
      "s": "a900d638-3326-4caa-a97e-c30ff99b9dc0",
      "p": "on-success",
      "o": "d37649b4-8a3b-46e6-947f-82d619f00b59"
    },
    {
      "s": "d37649b4-8a3b-46e6-947f-82d619f00b59",
      "p": "on-failure",
      "o": "b6ee8ee9-97e2-4627-b79b-ceaaabd5b0e5"
    }
  ],
  "tags": [
    "T1559",
    "atomic-red-team"
  ]
}