{
  "id": "c7ac59cb-13cc-4622-81dc-6d2fee9bfac7",
  "name": "Change login shell",
  "description": "An adversary may want to use a different login shell. The chsh command changes the user login shell. The following test, creates an art user with a /bin/bash shell, changes the users shell to sh, then deletes the art user. \n",
  "platforms": [
    "linux"
  ],
  "steps": [
    {
      "id": "1a77cf55-9d43-4ea9-94e0-fef3ed01b9e0",
      "type": "execute-command",
      "data": {
        "command": "[ \"$(uname)\" = 'FreeBSD' ] \u0026\u0026 pw useradd art -g wheel -s /bin/csh || useradd -s /bin/bash art\ncat /etc/passwd |grep ^art\nchsh -s /bin/sh art\ncat /etc/passwd |grep ^art",
        "command_type": "bash"
      },
      "elevation_required": true
    },
    {
      "id": "eb5a0c39-c1b3-472a-a440-1065c38810bc",
      "type": "execute-command",
      "data": {
        "command": "[ \"$(uname)\" = 'FreeBSD' ] \u0026\u0026 rmuser -y art || userdel art",
        "command_type": "bash"
      },
      "elevation_required": true
    },
    {
      "id": "956047c6-496b-40ec-bbb3-d7219d2593a6",
      "name": "Check dependency 1/1",
      "description": "chsh - change login shell, must be installed\n",
      "type": "execute-command",
      "data": {
        "command": "if [ -f /usr/bin/chsh ]; then echo \"exit 0\"; else echo \"exit 1\"; exit 1; fi",
        "command_type": "bash"
      },
      "elevation_required": true
    },
    {
      "id": "2c48eaf8-24f6-4055-ac60-45d99e2167f7",
      "name": "Resolve dependency 1/1",
      "description": "chsh - change login shell, must be installed\n",
      "type": "execute-command",
      "data": {
        "command": "echo \"Automated installer not implemented yet, please install chsh manually\"",
        "command_type": "bash"
      },
      "elevation_required": true
    },
    {
      "id": "ffb182e9-c2f7-403f-926c-51deea8fbc7f",
      "name": "Re-check dependency 1/1",
      "description": "chsh - change login shell, must be installed\n",
      "type": "execute-command",
      "data": {
        "command": "if [ -f /usr/bin/chsh ]; then echo \"exit 0\"; else echo \"exit 1\"; exit 1; fi",
        "command_type": "bash"
      },
      "elevation_required": true
    }
  ],
  "flows": [
    {
      "s": "1a77cf55-9d43-4ea9-94e0-fef3ed01b9e0",
      "p": "on-success",
      "o": "eb5a0c39-c1b3-472a-a440-1065c38810bc"
    },
    {
      "s": "1a77cf55-9d43-4ea9-94e0-fef3ed01b9e0",
      "p": "on-failure",
      "o": "eb5a0c39-c1b3-472a-a440-1065c38810bc"
    },
    {
      "s": "956047c6-496b-40ec-bbb3-d7219d2593a6",
      "p": "on-success",
      "o": "1a77cf55-9d43-4ea9-94e0-fef3ed01b9e0"
    },
    {
      "s": "956047c6-496b-40ec-bbb3-d7219d2593a6",
      "p": "on-failure",
      "o": "2c48eaf8-24f6-4055-ac60-45d99e2167f7"
    },
    {
      "s": "2c48eaf8-24f6-4055-ac60-45d99e2167f7",
      "p": "on-success",
      "o": "ffb182e9-c2f7-403f-926c-51deea8fbc7f"
    },
    {
      "s": "ffb182e9-c2f7-403f-926c-51deea8fbc7f",
      "p": "on-failure",
      "o": "1a77cf55-9d43-4ea9-94e0-fef3ed01b9e0"
    }
  ],
  "tags": [
    "T1059",
    "T1059.004"
  ],
  "input_arguments": null
}