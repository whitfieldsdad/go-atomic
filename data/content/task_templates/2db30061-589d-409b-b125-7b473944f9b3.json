{
  "id": "2db30061-589d-409b-b125-7b473944f9b3",
  "name": "Build Image On Host",
  "description": "Adversaries may build a container image directly on a host to bypass defenses that monitor for the retrieval of malicious images from a public registry. An adversary may take advantage of that build API to build a custom image on the host that includes malware downloaded from their C2 server, and then they then may utilize Deploy Container using that custom image.",
  "platforms": [
    "containers"
  ],
  "steps": [
    {
      "id": "96f51201-48d4-41eb-85f1-a459df4e46bf",
      "type": "execute-command",
      "data": {
        "command": "docker build -t t1612  $PathtoAtomicsFolder/T1612/src/\ndocker run --name t1612_container  -d -t t1612\ndocker exec t1612_container ./test.sh",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "d1f8d038-383a-4f4f-afb0-8c7c82179172",
      "type": "execute-command",
      "data": {
        "command": "docker stop t1612_container\ndocker rmi -f t1612",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "e52d96d1-49ce-49e7-aa30-729fe3f8b064",
      "name": "Check dependency 1/2",
      "description": "Verify docker is installed.",
      "type": "execute-command",
      "data": {
        "command": "which docker",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "102b4b9f-a9ee-43f6-b876-2e0b82ad0f4d",
      "name": "Resolve dependency 1/2",
      "description": "Verify docker is installed.",
      "type": "execute-command",
      "data": {
        "command": "if [ \"\" == \"`which docker`\" ]; then echo \"Docker Not Found\"; if [ -n \"`which apt-get`\" ]; then sudo apt-get -y install docker ; elif [ -n \"`which yum`\" ]; then sudo yum -y install docker ; fi ; else echo \"Docker installed\"; fi",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "b15eb570-90a2-40c8-b30b-f99dcfeb88f7",
      "name": "Re-check dependency 1/2",
      "description": "Verify docker is installed.",
      "type": "execute-command",
      "data": {
        "command": "which docker",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "77a5daa2-7c8a-4675-9bc3-3e6ce3908537",
      "name": "Check dependency 2/2",
      "description": "Verify docker service is running.",
      "type": "execute-command",
      "data": {
        "command": "sudo systemctl status docker  --no-pager",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "176505f4-9de7-4c60-8078-b67d6c9928c1",
      "name": "Resolve dependency 2/2",
      "description": "Verify docker service is running.",
      "type": "execute-command",
      "data": {
        "command": "sudo systemctl start docker",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "f24f8bf2-e16c-42e6-ae3c-85d73e9bbd08",
      "name": "Re-check dependency 2/2",
      "description": "Verify docker service is running.",
      "type": "execute-command",
      "data": {
        "command": "sudo systemctl status docker  --no-pager",
        "command_type": "sh"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "96f51201-48d4-41eb-85f1-a459df4e46bf",
      "p": "on-success",
      "o": "d1f8d038-383a-4f4f-afb0-8c7c82179172"
    },
    {
      "s": "96f51201-48d4-41eb-85f1-a459df4e46bf",
      "p": "on-failure",
      "o": "d1f8d038-383a-4f4f-afb0-8c7c82179172"
    },
    {
      "s": "e52d96d1-49ce-49e7-aa30-729fe3f8b064",
      "p": "on-success",
      "o": "96f51201-48d4-41eb-85f1-a459df4e46bf"
    },
    {
      "s": "e52d96d1-49ce-49e7-aa30-729fe3f8b064",
      "p": "on-failure",
      "o": "102b4b9f-a9ee-43f6-b876-2e0b82ad0f4d"
    },
    {
      "s": "102b4b9f-a9ee-43f6-b876-2e0b82ad0f4d",
      "p": "on-success",
      "o": "b15eb570-90a2-40c8-b30b-f99dcfeb88f7"
    },
    {
      "s": "b15eb570-90a2-40c8-b30b-f99dcfeb88f7",
      "p": "on-failure",
      "o": "96f51201-48d4-41eb-85f1-a459df4e46bf"
    },
    {
      "s": "77a5daa2-7c8a-4675-9bc3-3e6ce3908537",
      "p": "on-success",
      "o": "96f51201-48d4-41eb-85f1-a459df4e46bf"
    },
    {
      "s": "77a5daa2-7c8a-4675-9bc3-3e6ce3908537",
      "p": "on-failure",
      "o": "176505f4-9de7-4c60-8078-b67d6c9928c1"
    },
    {
      "s": "176505f4-9de7-4c60-8078-b67d6c9928c1",
      "p": "on-success",
      "o": "f24f8bf2-e16c-42e6-ae3c-85d73e9bbd08"
    },
    {
      "s": "f24f8bf2-e16c-42e6-ae3c-85d73e9bbd08",
      "p": "on-failure",
      "o": "96f51201-48d4-41eb-85f1-a459df4e46bf"
    }
  ],
  "tags": [
    "T1612"
  ]
}