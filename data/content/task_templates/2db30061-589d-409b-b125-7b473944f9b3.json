{
  "id": "2db30061-589d-409b-b125-7b473944f9b3",
  "name": "Build Image On Host",
  "description": "Adversaries may build a container image directly on a host to bypass defenses that monitor for the retrieval of malicious images from a public registry. An adversary may take advantage of that build API to build a custom image on the host that includes malware downloaded from their C2 server, and then they then may utilize Deploy Container using that custom image.",
  "platforms": [
    "containers"
  ],
  "steps": [
    {
      "id": "f951ac78-3755-4163-ab65-41a7d460e07b",
      "type": "execute-command",
      "data": {
        "command": "docker build -t t1612  $PathtoAtomicsFolder/T1612/src/\ndocker run --name t1612_container  -d -t t1612\ndocker exec t1612_container ./test.sh",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "818f4962-5028-4aaf-84d2-4a59f5f9c5ba",
      "type": "execute-command",
      "data": {
        "command": "docker stop t1612_container\ndocker rmi -f t1612",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "bb712fc3-2d1f-47cc-95d5-53fdb1f5f8f4",
      "name": "Check dependency 1/2",
      "description": "Verify docker is installed.",
      "type": "execute-command",
      "data": {
        "command": "which docker\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "bf3bc07e-6329-4461-a676-38a0a1449be1",
      "name": "Resolve dependency 1/2",
      "description": "Verify docker is installed.",
      "type": "execute-command",
      "data": {
        "command": "if [ \"\" == \"`which docker`\" ]; then echo \"Docker Not Found\"; if [ -n \"`which apt-get`\" ]; then sudo apt-get -y install docker ; elif [ -n \"`which yum`\" ]; then sudo yum -y install docker ; fi ; else echo \"Docker installed\"; fi\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "1749b27e-f8ee-4ec2-83f1-cd7e2480f0be",
      "name": "Re-check dependency 1/2",
      "description": "Verify docker is installed.",
      "type": "execute-command",
      "data": {
        "command": "which docker\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "40328d01-7ea6-48f3-a6d2-e86e8ee2564b",
      "name": "Check dependency 2/2",
      "description": "Verify docker service is running.",
      "type": "execute-command",
      "data": {
        "command": "sudo systemctl status docker  --no-pager\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "3388a3b3-1c44-480e-b1b6-def9b22af3a0",
      "name": "Resolve dependency 2/2",
      "description": "Verify docker service is running.",
      "type": "execute-command",
      "data": {
        "command": "sudo systemctl start docker\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "e049a64a-12e4-4709-964d-87180f39282d",
      "name": "Re-check dependency 2/2",
      "description": "Verify docker service is running.",
      "type": "execute-command",
      "data": {
        "command": "sudo systemctl status docker  --no-pager\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "f951ac78-3755-4163-ab65-41a7d460e07b",
      "p": "on-success",
      "o": "818f4962-5028-4aaf-84d2-4a59f5f9c5ba"
    },
    {
      "s": "f951ac78-3755-4163-ab65-41a7d460e07b",
      "p": "on-failure",
      "o": "818f4962-5028-4aaf-84d2-4a59f5f9c5ba"
    },
    {
      "s": "bb712fc3-2d1f-47cc-95d5-53fdb1f5f8f4",
      "p": "on-success",
      "o": "f951ac78-3755-4163-ab65-41a7d460e07b"
    },
    {
      "s": "bb712fc3-2d1f-47cc-95d5-53fdb1f5f8f4",
      "p": "on-failure",
      "o": "bf3bc07e-6329-4461-a676-38a0a1449be1"
    },
    {
      "s": "bf3bc07e-6329-4461-a676-38a0a1449be1",
      "p": "on-success",
      "o": "1749b27e-f8ee-4ec2-83f1-cd7e2480f0be"
    },
    {
      "s": "1749b27e-f8ee-4ec2-83f1-cd7e2480f0be",
      "p": "on-failure",
      "o": "f951ac78-3755-4163-ab65-41a7d460e07b"
    },
    {
      "s": "40328d01-7ea6-48f3-a6d2-e86e8ee2564b",
      "p": "on-success",
      "o": "f951ac78-3755-4163-ab65-41a7d460e07b"
    },
    {
      "s": "40328d01-7ea6-48f3-a6d2-e86e8ee2564b",
      "p": "on-failure",
      "o": "3388a3b3-1c44-480e-b1b6-def9b22af3a0"
    },
    {
      "s": "3388a3b3-1c44-480e-b1b6-def9b22af3a0",
      "p": "on-success",
      "o": "e049a64a-12e4-4709-964d-87180f39282d"
    },
    {
      "s": "e049a64a-12e4-4709-964d-87180f39282d",
      "p": "on-failure",
      "o": "f951ac78-3755-4163-ab65-41a7d460e07b"
    }
  ],
  "tags": [
    "T1612",
    "atomic-red-team"
  ]
}