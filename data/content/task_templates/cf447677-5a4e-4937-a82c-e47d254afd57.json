{
  "id": "cf447677-5a4e-4937-a82c-e47d254afd57",
  "name": "Add domain to Trusted sites Zone",
  "description": "Attackers may add a domain to the trusted site zone to bypass defenses. Doing this enables attacks such as c2 over office365.\nUpon execution, details of the new registry entries will be displayed.\nAdditionally, open Registry Editor to view the modified entry in HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\.\n\nhttps://www.blackhat.com/docs/us-17/wednesday/us-17-Dods-Infecting-The-Enterprise-Abusing-Office365-Powershell-For-Covert-C2.pdf\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "05cd02ea-f269-4415-833d-611b5d48edee",
      "type": "execute-command",
      "data": {
        "command": "$key= \"HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\Domains\\#{bad_domain}\\\"\n$name =\"bad-subdomain\"\nnew-item $key -Name $name -Force\nnew-itemproperty $key$name -Name https -Value 2 -Type DWORD;\nnew-itemproperty $key$name -Name http  -Value 2 -Type DWORD;\nnew-itemproperty $key$name -Name *     -Value 2 -Type DWORD;\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "f0a4a278-e46c-4069-bcd8-7db1f9cbab77",
      "type": "execute-command",
      "data": {
        "command": "$key = \"HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\Domains\\#{bad_domain}\\\"\nRemove-item  $key -Recurse -ErrorAction Ignore\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "05cd02ea-f269-4415-833d-611b5d48edee",
      "p": "on-success",
      "o": "f0a4a278-e46c-4069-bcd8-7db1f9cbab77"
    },
    {
      "s": "05cd02ea-f269-4415-833d-611b5d48edee",
      "p": "on-failure",
      "o": "f0a4a278-e46c-4069-bcd8-7db1f9cbab77"
    }
  ],
  "tags": [
    "T1112"
  ],
  "input_arguments": [
    {
      "name": "bad_domain",
      "type": "string",
      "description": "Domain to add to trusted site zone",
      "value": "bad-domain.com"
    }
  ]
}