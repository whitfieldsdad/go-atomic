{
  "id": "7762e120-5879-44ff-97f8-008b401b9a98",
  "name": "Copy a sensitive File over Administrative share with Powershell",
  "description": "Copy from sensitive File from the c$ of another LAN computer with powershell\nhttps://twitter.com/SBousseaden/status/1211636381086339073",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "5865b4f6-6435-4416-9b3a-cfdef56c2ddb",
      "type": "execute-command",
      "data": {
        "command": "copy-item -Path \"\\\\#{remote}\\C$\\#{share_file}\" -Destination \"$Env:TEMP\\#{local_file}\"",
        "command_type": "powershell"
      },
      "elevation_required": true
    },
    {
      "id": "4b397bb3-3c3e-4081-85c4-e86e7a09655a",
      "type": "execute-command",
      "data": {
        "command": "Remove-Item -Path \"\\\\#{remote}\\C$\\#{share_file}\"\nRemove-Item -Path \"$Env:TEMP\\#{local_file}\"",
        "command_type": "powershell"
      },
      "elevation_required": true
    },
    {
      "id": "826f73fd-a1a3-415d-b8f4-93a59fdb263c",
      "name": "Check dependency 1/2",
      "description": "Administrative share must exist on #{remote}\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"\\\\#{remote}\\C$\") {exit 0} else {exit 1}",
        "command_type": "powershell"
      },
      "elevation_required": true
    },
    {
      "id": "0cbe58c1-d584-4e0a-a9f3-5356cf3a42ed",
      "name": "Resolve dependency 1/2",
      "description": "Administrative share must exist on #{remote}\n",
      "type": "execute-command",
      "data": {
        "command": "Write-Host 'Please Enable \"C$\" share on #{remote}'",
        "command_type": "powershell"
      },
      "elevation_required": true
    },
    {
      "id": "d5fe5dc9-55bd-4297-9450-372764c282b7",
      "name": "Re-check dependency 1/2",
      "description": "Administrative share must exist on #{remote}\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"\\\\#{remote}\\C$\") {exit 0} else {exit 1}",
        "command_type": "powershell"
      },
      "elevation_required": true
    },
    {
      "id": "d2f24cc2-1622-45da-9d28-9ce99626f11b",
      "name": "Check dependency 2/2",
      "description": "\"\\\\#{remote}\\C$\\#{share_file}\" must exist on #{remote}\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"\\\\#{remote}\\C$\\#{share_file}\") {exit 0} else {exit 1}",
        "command_type": "powershell"
      },
      "elevation_required": true
    },
    {
      "id": "57b0571d-bdf7-438c-a0cc-e161401d9c1d",
      "name": "Resolve dependency 2/2",
      "description": "\"\\\\#{remote}\\C$\\#{share_file}\" must exist on #{remote}\n",
      "type": "execute-command",
      "data": {
        "command": "Out-File -FilePath \"\\\\#{remote}\\C$\\#{share_file}\"",
        "command_type": "powershell"
      },
      "elevation_required": true
    },
    {
      "id": "cce0e5c4-f5dd-48eb-8ff4-085786e00afa",
      "name": "Re-check dependency 2/2",
      "description": "\"\\\\#{remote}\\C$\\#{share_file}\" must exist on #{remote}\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"\\\\#{remote}\\C$\\#{share_file}\") {exit 0} else {exit 1}",
        "command_type": "powershell"
      },
      "elevation_required": true
    }
  ],
  "flows": [
    {
      "s": "5865b4f6-6435-4416-9b3a-cfdef56c2ddb",
      "p": "on-success",
      "o": "4b397bb3-3c3e-4081-85c4-e86e7a09655a"
    },
    {
      "s": "5865b4f6-6435-4416-9b3a-cfdef56c2ddb",
      "p": "on-failure",
      "o": "4b397bb3-3c3e-4081-85c4-e86e7a09655a"
    },
    {
      "s": "826f73fd-a1a3-415d-b8f4-93a59fdb263c",
      "p": "on-success",
      "o": "5865b4f6-6435-4416-9b3a-cfdef56c2ddb"
    },
    {
      "s": "826f73fd-a1a3-415d-b8f4-93a59fdb263c",
      "p": "on-failure",
      "o": "0cbe58c1-d584-4e0a-a9f3-5356cf3a42ed"
    },
    {
      "s": "0cbe58c1-d584-4e0a-a9f3-5356cf3a42ed",
      "p": "on-success",
      "o": "d5fe5dc9-55bd-4297-9450-372764c282b7"
    },
    {
      "s": "d5fe5dc9-55bd-4297-9450-372764c282b7",
      "p": "on-failure",
      "o": "5865b4f6-6435-4416-9b3a-cfdef56c2ddb"
    },
    {
      "s": "d2f24cc2-1622-45da-9d28-9ce99626f11b",
      "p": "on-success",
      "o": "5865b4f6-6435-4416-9b3a-cfdef56c2ddb"
    },
    {
      "s": "d2f24cc2-1622-45da-9d28-9ce99626f11b",
      "p": "on-failure",
      "o": "57b0571d-bdf7-438c-a0cc-e161401d9c1d"
    },
    {
      "s": "57b0571d-bdf7-438c-a0cc-e161401d9c1d",
      "p": "on-success",
      "o": "cce0e5c4-f5dd-48eb-8ff4-085786e00afa"
    },
    {
      "s": "cce0e5c4-f5dd-48eb-8ff4-085786e00afa",
      "p": "on-failure",
      "o": "5865b4f6-6435-4416-9b3a-cfdef56c2ddb"
    }
  ],
  "tags": [
    "T1039"
  ],
  "input_arguments": [
    {
      "name": "remote",
      "type": "string",
      "description": "Remote server name",
      "value": "127.0.0.1"
    },
    {
      "name": "share_file",
      "type": "path",
      "description": "Remote Path to the file",
      "value": "Windows\\temp\\Easter_Bunny.password"
    },
    {
      "name": "local_file",
      "type": "string",
      "description": "Local name",
      "value": "Easter_egg.password"
    }
  ]
}