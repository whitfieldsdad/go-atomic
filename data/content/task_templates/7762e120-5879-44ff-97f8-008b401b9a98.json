{
  "id": "7762e120-5879-44ff-97f8-008b401b9a98",
  "name": "Copy a sensitive File over Administrative share with Powershell",
  "description": "Copy from sensitive File from the c$ of another LAN computer with powershell\nhttps://twitter.com/SBousseaden/status/1211636381086339073",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "78df2b4e-eea5-4ac5-8ff4-9ee25af74e8c",
      "type": "execute-command",
      "data": {
        "command": "copy-item -Path \"\\\\#{remote}\\C$\\#{share_file}\" -Destination \"$Env:TEMP\\#{local_file}\"",
        "command_type": "powershell"
      },
      "elevation_required": true
    },
    {
      "id": "dd5778c7-8107-4bc2-8fd7-35af8b071b18",
      "type": "execute-command",
      "data": {
        "command": "Remove-Item -Path \"\\\\#{remote}\\C$\\#{share_file}\"\nRemove-Item -Path \"$Env:TEMP\\#{local_file}\"",
        "command_type": "powershell"
      },
      "elevation_required": true
    },
    {
      "id": "d9e98791-72df-41a1-a789-1f95604b5e9d",
      "name": "Check dependency 1/2",
      "description": "Administrative share must exist on #{remote}\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"\\\\#{remote}\\C$\") {exit 0} else {exit 1}",
        "command_type": "powershell"
      },
      "elevation_required": true
    },
    {
      "id": "a5c00f29-542b-4442-9809-3ba82894836b",
      "name": "Resolve dependency 1/2",
      "description": "Administrative share must exist on #{remote}\n",
      "type": "execute-command",
      "data": {
        "command": "Write-Host 'Please Enable \"C$\" share on #{remote}'",
        "command_type": "powershell"
      },
      "elevation_required": true
    },
    {
      "id": "dbc30307-9e94-4d5b-acef-cb4fd4cf4096",
      "name": "Re-check dependency 1/2",
      "description": "Administrative share must exist on #{remote}\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"\\\\#{remote}\\C$\") {exit 0} else {exit 1}",
        "command_type": "powershell"
      },
      "elevation_required": true
    },
    {
      "id": "1d63ae9e-cb57-48ed-be87-70c9899a7d6a",
      "name": "Check dependency 2/2",
      "description": "\"\\\\#{remote}\\C$\\#{share_file}\" must exist on #{remote}\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"\\\\#{remote}\\C$\\#{share_file}\") {exit 0} else {exit 1}",
        "command_type": "powershell"
      },
      "elevation_required": true
    },
    {
      "id": "3a3dddf1-45c9-406b-9e1e-d68019b12081",
      "name": "Resolve dependency 2/2",
      "description": "\"\\\\#{remote}\\C$\\#{share_file}\" must exist on #{remote}\n",
      "type": "execute-command",
      "data": {
        "command": "Out-File -FilePath \"\\\\#{remote}\\C$\\#{share_file}\"",
        "command_type": "powershell"
      },
      "elevation_required": true
    },
    {
      "id": "3a839b4e-56f2-44c0-a868-9c2852431c24",
      "name": "Re-check dependency 2/2",
      "description": "\"\\\\#{remote}\\C$\\#{share_file}\" must exist on #{remote}\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"\\\\#{remote}\\C$\\#{share_file}\") {exit 0} else {exit 1}",
        "command_type": "powershell"
      },
      "elevation_required": true
    }
  ],
  "flows": [
    {
      "s": "78df2b4e-eea5-4ac5-8ff4-9ee25af74e8c",
      "p": "on-success",
      "o": "dd5778c7-8107-4bc2-8fd7-35af8b071b18"
    },
    {
      "s": "78df2b4e-eea5-4ac5-8ff4-9ee25af74e8c",
      "p": "on-failure",
      "o": "dd5778c7-8107-4bc2-8fd7-35af8b071b18"
    },
    {
      "s": "d9e98791-72df-41a1-a789-1f95604b5e9d",
      "p": "on-success",
      "o": "78df2b4e-eea5-4ac5-8ff4-9ee25af74e8c"
    },
    {
      "s": "d9e98791-72df-41a1-a789-1f95604b5e9d",
      "p": "on-failure",
      "o": "a5c00f29-542b-4442-9809-3ba82894836b"
    },
    {
      "s": "a5c00f29-542b-4442-9809-3ba82894836b",
      "p": "on-success",
      "o": "dbc30307-9e94-4d5b-acef-cb4fd4cf4096"
    },
    {
      "s": "dbc30307-9e94-4d5b-acef-cb4fd4cf4096",
      "p": "on-failure",
      "o": "78df2b4e-eea5-4ac5-8ff4-9ee25af74e8c"
    },
    {
      "s": "1d63ae9e-cb57-48ed-be87-70c9899a7d6a",
      "p": "on-success",
      "o": "78df2b4e-eea5-4ac5-8ff4-9ee25af74e8c"
    },
    {
      "s": "1d63ae9e-cb57-48ed-be87-70c9899a7d6a",
      "p": "on-failure",
      "o": "3a3dddf1-45c9-406b-9e1e-d68019b12081"
    },
    {
      "s": "3a3dddf1-45c9-406b-9e1e-d68019b12081",
      "p": "on-success",
      "o": "3a839b4e-56f2-44c0-a868-9c2852431c24"
    },
    {
      "s": "3a839b4e-56f2-44c0-a868-9c2852431c24",
      "p": "on-failure",
      "o": "78df2b4e-eea5-4ac5-8ff4-9ee25af74e8c"
    }
  ],
  "tags": [
    "T1039"
  ],
  "input_arguments": [
    {
      "name": "local_file",
      "type": "string",
      "description": "Local name",
      "value": "Easter_egg.password"
    },
    {
      "name": "remote",
      "type": "string",
      "description": "Remote server name",
      "value": "127.0.0.1"
    },
    {
      "name": "share_file",
      "type": "path",
      "description": "Remote Path to the file",
      "value": "Windows\\temp\\Easter_Bunny.password"
    }
  ]
}