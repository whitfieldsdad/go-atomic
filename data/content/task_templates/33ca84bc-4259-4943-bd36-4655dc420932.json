{
  "id": "33ca84bc-4259-4943-bd36-4655dc420932",
  "name": "AWS CloudWatch Log Stream Deletes",
  "description": "Creates a new cloudWatch log stream in AWS, Upon successful creation it will Delete the stream. Attackers can use this technique to evade defenses by \ndeleting the log stream. Once it is deleted, the logs created by the attackers will not be logged. https://www.elastic.co/guide/en/security/current/aws-cloudwatch-log-stream-deletion.html\n",
  "platforms": [
    "iaas:aws"
  ],
  "steps": [
    {
      "id": "a0a0f70f-5441-4153-867e-f23523fc1e25",
      "type": "execute-command",
      "data": {
        "command": "aws logs create-log-group --log-group-name #{cloudwatch_log_group_name} --region #{region} --output json\necho \"*** Log Group Created ***\"\naws logs create-log-stream --log-group-name #{cloudwatch_log_group_name} --log-stream-name #{cloudwatch_log_stream_name}\necho \"*** Log Stream Created ***\"\naws logs delete-log-stream --log-group-name #{cloudwatch_log_group_name} --log-stream-name #{cloudwatch_log_stream_name}\necho \"*** Log Stream Deleted ***\"\naws logs delete-log-group --log-group-name #{cloudwatch_log_group_name} --region #{region} --output json\necho \"*** Log Group Deleted ***\"",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "b25a638e-5652-4b01-a1e6-443dd945e78a",
      "name": "Check dependency 1/1",
      "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
      "type": "execute-command",
      "data": {
        "command": "cat ~/.aws/credentials | grep \"default\"",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "afe7f736-2dc2-4710-9da2-b137d5263b7e",
      "name": "Resolve dependency 1/1",
      "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
      "type": "execute-command",
      "data": {
        "command": "echo Please install the aws-cli and configure your AWS defult profile using: aws configure",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "f5a13898-9849-47e7-ac5a-b69968009dff",
      "name": "Re-check dependency 1/1",
      "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
      "type": "execute-command",
      "data": {
        "command": "cat ~/.aws/credentials | grep \"default\"",
        "command_type": "sh"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "b25a638e-5652-4b01-a1e6-443dd945e78a",
      "p": "on-success",
      "o": "a0a0f70f-5441-4153-867e-f23523fc1e25"
    },
    {
      "s": "b25a638e-5652-4b01-a1e6-443dd945e78a",
      "p": "on-failure",
      "o": "afe7f736-2dc2-4710-9da2-b137d5263b7e"
    },
    {
      "s": "afe7f736-2dc2-4710-9da2-b137d5263b7e",
      "p": "on-success",
      "o": "f5a13898-9849-47e7-ac5a-b69968009dff"
    },
    {
      "s": "f5a13898-9849-47e7-ac5a-b69968009dff",
      "p": "on-failure",
      "o": "a0a0f70f-5441-4153-867e-f23523fc1e25"
    }
  ],
  "tags": [
    "T1562",
    "T1562.008"
  ],
  "input_arguments": [
    {
      "name": "cloudwatch_log_group_name",
      "type": "string",
      "description": "Name of the cloudWatch log group",
      "value": "test-logs"
    },
    {
      "name": "cloudwatch_log_stream_name",
      "type": "string",
      "description": "Name of the cloudWatch log stream",
      "value": "20150601"
    },
    {
      "name": "region",
      "type": "string",
      "description": "Name of the region",
      "value": "us-west-2"
    }
  ]
}