{
  "id": "979356b9-b588-4e49-bba4-c35517c484f5",
  "name": "AWS - Scan for Anonymous Access to S3",
  "description": "Upon successful execution, this test will test for anonymous access to AWS S3 buckets and dumps all the files to a local folder. \n",
  "platforms": [
    "iaas:aws"
  ],
  "steps": [
    {
      "id": "2c3e14d3-849a-4e3f-8d59-0820311ca783",
      "type": "execute-command",
      "data": {
        "command": "aws --no-sign-request s3 cp --recursive s3://#{s3_bucket_name} /tmp/#{s3_bucket_name}\n",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "5a7ca01f-eb1a-4674-a70f-682bad8f66d8",
      "type": "execute-command",
      "data": {
        "command": "aws s3 rb s3://#{s3_bucket_name} --force \nrm -rf /tmp/#{s3_bucket_name}\n",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "85cae8e2-3384-449b-a033-a253baa0c195",
      "name": "Check dependency 1/1",
      "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
      "type": "execute-command",
      "data": {
        "command": "cat ~/.aws/credentials | grep \"default\"\naws s3api create-bucket --bucket #{s3_bucket_name}\naws s3api put-bucket-policy --bucket #{s3_bucket_name} --policy file://$PathToAtomicsFolder/T1530/src/policy.json\ntouch /tmp/T1530.txt\naws s3 cp /tmp/T1530.txt s3://#{s3_bucket_name}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "b6e44b95-21a9-426a-bd11-4b095f832431",
      "name": "Resolve dependency 1/1",
      "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
      "type": "execute-command",
      "data": {
        "command": "echo Please install the aws-cli and configure your AWS default profile using: aws configure\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "6b0fe7e4-03c5-49a3-bcfe-f8109478cde0",
      "name": "Re-check dependency 1/1",
      "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
      "type": "execute-command",
      "data": {
        "command": "cat ~/.aws/credentials | grep \"default\"\naws s3api create-bucket --bucket #{s3_bucket_name}\naws s3api put-bucket-policy --bucket #{s3_bucket_name} --policy file://$PathToAtomicsFolder/T1530/src/policy.json\ntouch /tmp/T1530.txt\naws s3 cp /tmp/T1530.txt s3://#{s3_bucket_name}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "2c3e14d3-849a-4e3f-8d59-0820311ca783",
      "p": "on-success",
      "o": "5a7ca01f-eb1a-4674-a70f-682bad8f66d8"
    },
    {
      "s": "2c3e14d3-849a-4e3f-8d59-0820311ca783",
      "p": "on-failure",
      "o": "5a7ca01f-eb1a-4674-a70f-682bad8f66d8"
    },
    {
      "s": "85cae8e2-3384-449b-a033-a253baa0c195",
      "p": "on-success",
      "o": "2c3e14d3-849a-4e3f-8d59-0820311ca783"
    },
    {
      "s": "85cae8e2-3384-449b-a033-a253baa0c195",
      "p": "on-failure",
      "o": "b6e44b95-21a9-426a-bd11-4b095f832431"
    },
    {
      "s": "b6e44b95-21a9-426a-bd11-4b095f832431",
      "p": "on-success",
      "o": "6b0fe7e4-03c5-49a3-bcfe-f8109478cde0"
    },
    {
      "s": "6b0fe7e4-03c5-49a3-bcfe-f8109478cde0",
      "p": "on-failure",
      "o": "2c3e14d3-849a-4e3f-8d59-0820311ca783"
    }
  ],
  "tags": [
    "T1530",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "s3_bucket_name",
      "type": "string",
      "description": "Name of the bucket",
      "value": "redatomic-test2"
    }
  ]
}