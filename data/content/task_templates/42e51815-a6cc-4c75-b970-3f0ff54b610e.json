{
  "id": "42e51815-a6cc-4c75-b970-3f0ff54b610e",
  "name": "UltraVNC Execution",
  "description": "An adversary may attempt to trick the user into downloading UltraVNC for use as a C2 channel.\nUpon successful execution, UltraVNC will be executed.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "cca11d6c-fc32-4a11-95e8-3f57b3b731b1",
      "type": "execute-command",
      "data": {
        "command": "Start-Process #{UltraVNC_Viewer_Path}\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "c80ae39c-3734-4305-8d91-37da8de3e4c6",
      "type": "execute-command",
      "data": {
        "command": "Stop-Process -Name \"vncviewer\" -force -erroraction silentlycontinue\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "f5ae14b8-d039-4ab6-9287-748820a098d2",
      "name": "Check dependency 1/1",
      "description": "UltraVNC must exist at (#{UltraVNC_Viewer_Path})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path #{UltraVNC_Viewer_Path}) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "b0c05d91-04bb-47d9-ab6b-864203113498",
      "name": "Resolve dependency 1/1",
      "description": "UltraVNC must exist at (#{UltraVNC_Viewer_Path})\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://www.uvnc.eu/download/1381/UltraVNC_1_3_81_X64_Setup.exe\" -OutFile \"PathToAtomicsFolder\\..\\ExternalPayloads\\vncsetup.exe\"\nstart-process \"PathToAtomicsFolder\\..\\ExternalPayloads\\vncsetup.exe\" /silent\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "456ac06b-301e-41ba-b191-66d4af4a79ba",
      "name": "Re-check dependency 1/1",
      "description": "UltraVNC must exist at (#{UltraVNC_Viewer_Path})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path #{UltraVNC_Viewer_Path}) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "cca11d6c-fc32-4a11-95e8-3f57b3b731b1",
      "p": "on-success",
      "o": "c80ae39c-3734-4305-8d91-37da8de3e4c6"
    },
    {
      "s": "cca11d6c-fc32-4a11-95e8-3f57b3b731b1",
      "p": "on-failure",
      "o": "c80ae39c-3734-4305-8d91-37da8de3e4c6"
    },
    {
      "s": "f5ae14b8-d039-4ab6-9287-748820a098d2",
      "p": "on-success",
      "o": "cca11d6c-fc32-4a11-95e8-3f57b3b731b1"
    },
    {
      "s": "f5ae14b8-d039-4ab6-9287-748820a098d2",
      "p": "on-failure",
      "o": "b0c05d91-04bb-47d9-ab6b-864203113498"
    },
    {
      "s": "b0c05d91-04bb-47d9-ab6b-864203113498",
      "p": "on-success",
      "o": "456ac06b-301e-41ba-b191-66d4af4a79ba"
    },
    {
      "s": "456ac06b-301e-41ba-b191-66d4af4a79ba",
      "p": "on-failure",
      "o": "cca11d6c-fc32-4a11-95e8-3f57b3b731b1"
    }
  ],
  "tags": [
    "T1219",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "UltraVNC_Viewer_Path",
      "type": "path",
      "description": "Path of UltraVNC Viewer executable",
      "value": "$env:ProgramFiles\\'uvnc bvba\\UltraVnc\\vncviewer.exe'"
    }
  ]
}