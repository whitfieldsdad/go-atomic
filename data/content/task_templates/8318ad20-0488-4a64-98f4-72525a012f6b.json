{
  "id": "8318ad20-0488-4a64-98f4-72525a012f6b",
  "name": "Snake Malware Registry Blob",
  "description": "The following Atomic Test creates a registry blob in HKLM:\\SOFTWARE\\Classes\\.wav\\OpenWithProgIds, which is related to Snake Malware. Per the report, upon execution, Snake's WerFault.exe will attempt to decrypt an encrypted blob within the Windows\nregistry that is typically found at HKLM:\\SOFTWARE\\Classes\\.wav\\OpenWithProgIds. The encrypted data includes the AES key, IV, and path that is used to find and decrypt the file containing Snake's kernel driver and kernel driver loader.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "848df4de-b53e-40e7-8725-80cbadd2347a",
      "type": "execute-command",
      "data": {
        "command": "$typicalPath = \"HKLM:\\SOFTWARE\\Classes\\.wav\\OpenWithProgIds\"; $randomBytes = New-Object Byte[] 0x1000; (New-Object Random).NextBytes($randomBytes); New-ItemProperty -Path $typicalPath -Name \"AtomicSnake\" -Value $randomBytes -PropertyType Binary -Force | Out-Null",
        "command_type": "powershell"
      },
      "elevation_required": true
    },
    {
      "id": "75f0d42f-0751-4843-b817-b2cfe15dcd48",
      "type": "execute-command",
      "data": {
        "command": "$typicalPath = \"HKLM:\\SOFTWARE\\Classes\\.wav\\OpenWithProgIds\"; Remove-ItemProperty -Path $typicalPath -Name \"AtomicSnake\" -ErrorAction SilentlyContinue | Out-Null",
        "command_type": "powershell"
      },
      "elevation_required": true
    }
  ],
  "flows": [
    {
      "s": "848df4de-b53e-40e7-8725-80cbadd2347a",
      "p": "on-success",
      "o": "75f0d42f-0751-4843-b817-b2cfe15dcd48"
    },
    {
      "s": "848df4de-b53e-40e7-8725-80cbadd2347a",
      "p": "on-failure",
      "o": "75f0d42f-0751-4843-b817-b2cfe15dcd48"
    }
  ],
  "tags": [
    "T1112"
  ]
}