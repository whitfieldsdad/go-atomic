{
  "id": "a21bb23e-e677-4ee7-af90-6931b57b6350",
  "name": "Run BloodHound from local disk",
  "description": "Upon execution SharpHound will be downloaded to disk, imported and executed. It will set up collection methods, run and then compress and store the data to the temp directory on the machine. If system is unable to contact a domain, proper execution will not occur.\n\nSuccessful execution will produce stdout message stating \"SharpHound Enumeration Completed\". Upon completion, final output will be a *BloodHound.zip file.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "f917d8c7-c4b2-46b3-9a1a-53540ec5b86a",
      "type": "execute-command",
      "data": {
        "command": "import-module \"PathToAtomicsFolder\\..\\ExternalPayloads\\SharpHound.ps1\"\ntry { Invoke-BloodHound -OutputDirectory $env:Temp }\ncatch { $_; exit $_.Exception.HResult}\nStart-Sleep 5\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "c0aa7f09-7714-4c0c-90c6-e7a644c90cc9",
      "type": "execute-command",
      "data": {
        "command": "Remove-Item $env:Temp\\*BloodHound.zip -Force\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "7e79ffcc-7fa1-4d7b-a0f6-83b495d98f44",
      "name": "Check dependency 1/1",
      "description": "SharpHound.ps1 must be located at \"PathToAtomicsFolder\\..\\ExternalPayloads\\SharpHound.ps1\"\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\SharpHound.ps1\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "b3e5de71-b35a-4b50-870a-195f5c49687c",
      "name": "Resolve dependency 1/1",
      "description": "SharpHound.ps1 must be located at \"PathToAtomicsFolder\\..\\ExternalPayloads\\SharpHound.ps1\"\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://raw.githubusercontent.com/BloodHoundAD/BloodHound/804503962b6dc554ad7d324cfa7f2b4a566a14e2/Ingestors/SharpHound.ps1\" -OutFile \"PathToAtomicsFolder\\..\\ExternalPayloads\\SharpHound.ps1\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "16a874c9-207f-4a33-bf5b-6f30e8bac6cf",
      "name": "Re-check dependency 1/1",
      "description": "SharpHound.ps1 must be located at \"PathToAtomicsFolder\\..\\ExternalPayloads\\SharpHound.ps1\"\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\SharpHound.ps1\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "f917d8c7-c4b2-46b3-9a1a-53540ec5b86a",
      "p": "on-success",
      "o": "c0aa7f09-7714-4c0c-90c6-e7a644c90cc9"
    },
    {
      "s": "f917d8c7-c4b2-46b3-9a1a-53540ec5b86a",
      "p": "on-failure",
      "o": "c0aa7f09-7714-4c0c-90c6-e7a644c90cc9"
    },
    {
      "s": "7e79ffcc-7fa1-4d7b-a0f6-83b495d98f44",
      "p": "on-success",
      "o": "f917d8c7-c4b2-46b3-9a1a-53540ec5b86a"
    },
    {
      "s": "7e79ffcc-7fa1-4d7b-a0f6-83b495d98f44",
      "p": "on-failure",
      "o": "b3e5de71-b35a-4b50-870a-195f5c49687c"
    },
    {
      "s": "b3e5de71-b35a-4b50-870a-195f5c49687c",
      "p": "on-success",
      "o": "16a874c9-207f-4a33-bf5b-6f30e8bac6cf"
    },
    {
      "s": "16a874c9-207f-4a33-bf5b-6f30e8bac6cf",
      "p": "on-failure",
      "o": "f917d8c7-c4b2-46b3-9a1a-53540ec5b86a"
    }
  ],
  "tags": [
    "T1059.001",
    "atomic-red-team"
  ]
}