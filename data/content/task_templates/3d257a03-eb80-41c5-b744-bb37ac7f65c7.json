{
  "id": "3d257a03-eb80-41c5-b744-bb37ac7f65c7",
  "name": "System Discovery - SocGholish whoami",
  "description": "SocGholish performs whoami discovery commands and outputs the results to a tmp file. \nThe test will generate a filename similar to the random one generated during execution and write the file to AppData\\Temp.\n\nReference: https://redcanary.com/threat-detection-report/threats/socgholish/\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "1be0c93c-4782-4a65-b68e-5d4205348e75",
      "type": "execute-command",
      "data": {
        "command": "$TokenSet = @{\n  U = [Char[]]'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\n  N = [Char[]]'0123456789'\n}\n$Upper = Get-Random -Count 5 -InputObject $TokenSet.U\n$Number = Get-Random -Count 5 -InputObject $TokenSet.N\n$StringSet = $Upper + $Number\n$rad = (Get-Random -Count 5 -InputObject $StringSet) -join ''\n$file = \"rad\" + $rad + \".tmp\"\n\nwhoami.exe /all \u003e\u003e #{output_path}\\$file\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "5fe338b0-d95c-4cad-a942-6920fae05366",
      "type": "execute-command",
      "data": {
        "command": "Remove-Item -Path #{output_path}\\rad*.tmp -Force\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "1be0c93c-4782-4a65-b68e-5d4205348e75",
      "p": "on-success",
      "o": "5fe338b0-d95c-4cad-a942-6920fae05366"
    },
    {
      "s": "1be0c93c-4782-4a65-b68e-5d4205348e75",
      "p": "on-failure",
      "o": "5fe338b0-d95c-4cad-a942-6920fae05366"
    }
  ],
  "tags": [
    "T1033",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "output_path",
      "type": "string",
      "description": "Location of output file",
      "value": "$env:temp"
    }
  ]
}