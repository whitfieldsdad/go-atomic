{
  "id": "bd13b9fc-b758-496a-b81a-397462f82c72",
  "name": "Cobalt Strike Artifact Kit pipe",
  "description": "Uses the [Named Pipes Micro Emulation](https://github.com/center-for-threat-informed-defense/adversary_emulation_library/tree/master/micro_emulation_plans/src/named_pipes) executable from the Center for Threat Informed Defense to create a named pipe for inter-process communication.\n\nThe named pipe executable will pause for 30 seconds to allow the client and server to exchange a message through the pipe.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "fe91da08-0e25-4de3-8037-a24088d564a1",
      "type": "execute-command",
      "data": {
        "command": "\"PathToAtomicsFolder\\..\\ExternalPayloads\\build\\namedpipes_executor.exe\" --pipe 1\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "bf7c96da-e1fb-4c20-957c-78ac60796457",
      "name": "Check dependency 1/1",
      "description": "Named pipe executors must exist on disk\n",
      "type": "execute-command",
      "data": {
        "command": "if ((Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\build\\namedpipes_executor.exe\") -and (Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\build\\namedpipes_client.exe\") -and (Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\build\\namedpipes_server.exe\")) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "a3498133-bd92-4ac2-862a-afc667ce952f",
      "name": "Resolve dependency 1/1",
      "description": "Named pipe executors must exist on disk\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\n[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/invoke-atomicredteam/master/Public/Invoke-FetchFromZip.ps1\" -UseBasicParsing)\n$zipUrl  = \"https://github.com/center-for-threat-informed-defense/adversary_emulation_library/raw/master/micro_emulation_plans/src/named_pipes/named_pipes.zip\"\nInvoke-FetchFromZip $zipUrl \"*.exe\" \"PathToAtomicsFolder\\..\\ExternalPayloads\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "74e33081-82ba-4386-81a5-fda60fececd0",
      "name": "Re-check dependency 1/1",
      "description": "Named pipe executors must exist on disk\n",
      "type": "execute-command",
      "data": {
        "command": "if ((Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\build\\namedpipes_executor.exe\") -and (Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\build\\namedpipes_client.exe\") -and (Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\build\\namedpipes_server.exe\")) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "bf7c96da-e1fb-4c20-957c-78ac60796457",
      "p": "on-success",
      "o": "fe91da08-0e25-4de3-8037-a24088d564a1"
    },
    {
      "s": "bf7c96da-e1fb-4c20-957c-78ac60796457",
      "p": "on-failure",
      "o": "a3498133-bd92-4ac2-862a-afc667ce952f"
    },
    {
      "s": "a3498133-bd92-4ac2-862a-afc667ce952f",
      "p": "on-success",
      "o": "74e33081-82ba-4386-81a5-fda60fececd0"
    },
    {
      "s": "74e33081-82ba-4386-81a5-fda60fececd0",
      "p": "on-failure",
      "o": "fe91da08-0e25-4de3-8037-a24088d564a1"
    }
  ],
  "tags": [
    "T1559",
    "atomic-red-team"
  ]
}