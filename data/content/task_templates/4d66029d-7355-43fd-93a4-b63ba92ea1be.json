{
  "id": "4d66029d-7355-43fd-93a4-b63ba92ea1be",
  "name": "Dylib Injection via DYLD_INSERT_LIBRARIES",
  "description": "injects a dylib that opens calculator via env variable\n",
  "platforms": [
    "darwin"
  ],
  "steps": [
    {
      "id": "68422f6d-a576-4c63-ba73-fbd8d247c5b5",
      "type": "execute-command",
      "data": {
        "command": "DYLD_INSERT_LIBRARIES=#{dylib_file} #{file_to_inject}\n",
        "command_type": "bash"
      },
      "elevation_required": false
    },
    {
      "id": "e78e9ef0-0698-4d13-96ed-78c39deb50c6",
      "type": "execute-command",
      "data": {
        "command": "kill `pgrep Calculator`\nkill `pgrep firefox`\n",
        "command_type": "bash"
      },
      "elevation_required": false
    },
    {
      "id": "f7e33812-a90b-40fe-aba6-8d78ba37da3e",
      "name": "Check dependency 1/1",
      "description": "Compile the dylib from (#{source_file}). Destination is #{dylib_file}\n",
      "type": "execute-command",
      "data": {
        "command": "gcc -dynamiclib #{source_file} -o #{dylib_file}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "5a7ad038-6b11-4de1-9291-55799d0d6390",
      "name": "Resolve dependency 1/1",
      "description": "Compile the dylib from (#{source_file}). Destination is #{dylib_file}\n",
      "type": "execute-command",
      "data": {
        "command": "gcc -dynamiclib #{source_file} -o #{dylib_file}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "2b0b46ca-adb2-408f-86d6-e0f65e487f25",
      "name": "Re-check dependency 1/1",
      "description": "Compile the dylib from (#{source_file}). Destination is #{dylib_file}\n",
      "type": "execute-command",
      "data": {
        "command": "gcc -dynamiclib #{source_file} -o #{dylib_file}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "68422f6d-a576-4c63-ba73-fbd8d247c5b5",
      "p": "on-success",
      "o": "e78e9ef0-0698-4d13-96ed-78c39deb50c6"
    },
    {
      "s": "68422f6d-a576-4c63-ba73-fbd8d247c5b5",
      "p": "on-failure",
      "o": "e78e9ef0-0698-4d13-96ed-78c39deb50c6"
    },
    {
      "s": "f7e33812-a90b-40fe-aba6-8d78ba37da3e",
      "p": "on-success",
      "o": "68422f6d-a576-4c63-ba73-fbd8d247c5b5"
    },
    {
      "s": "f7e33812-a90b-40fe-aba6-8d78ba37da3e",
      "p": "on-failure",
      "o": "5a7ad038-6b11-4de1-9291-55799d0d6390"
    },
    {
      "s": "5a7ad038-6b11-4de1-9291-55799d0d6390",
      "p": "on-success",
      "o": "2b0b46ca-adb2-408f-86d6-e0f65e487f25"
    },
    {
      "s": "2b0b46ca-adb2-408f-86d6-e0f65e487f25",
      "p": "on-failure",
      "o": "68422f6d-a576-4c63-ba73-fbd8d247c5b5"
    }
  ],
  "tags": [
    "T1574.006",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "dylib_file",
      "type": "path",
      "description": "Path of dylib file",
      "value": "/tmp/T1574006MOS.dylib"
    },
    {
      "name": "file_to_inject",
      "type": "path",
      "description": "Path of executable to be injected. Mostly works on non-apple default apps.",
      "value": "/Applications/Firefox.app/Contents/MacOS/firefox"
    },
    {
      "name": "source_file",
      "type": "path",
      "description": "Path of c source file",
      "value": "PathToAtomicsFolder/T1574.006/src/MacOS/T1574.006.c"
    }
  ]
}