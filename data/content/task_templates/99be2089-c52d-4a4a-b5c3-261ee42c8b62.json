{
  "id": "99be2089-c52d-4a4a-b5c3-261ee42c8b62",
  "name": "Execution through API - CreateProcess",
  "description": "Execute program by leveraging Win32 API's. By default, this will launch calc.exe from the command prompt.",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "5c17130f-5ce5-4130-b45f-a79c42a5d52a",
      "type": "execute-command",
      "data": {
        "command": "C:\\Windows\\Microsoft.NET\\Framework\\v4.0.30319\\csc.exe /out:\"#{output_file}\" /target:exe \"#{source_file}\"\n%tmp%/T1106.exe\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "fc09ac22-1766-4d3b-a0dd-4053344cd421",
      "name": "Check dependency 1/1",
      "description": "#{source_file} must exist on system.\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{source_file}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "f6e67c10-9eea-40d9-830c-ee4ececb9118",
      "name": "Resolve dependency 1/1",
      "description": "#{source_file} must exist on system.\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory (split-path \"#{source_file}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1106/src/CreateProcess.cs\" -OutFile \"#{source_file}\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "54d14b84-2142-4784-a761-f1c0977efc87",
      "name": "Re-check dependency 1/1",
      "description": "#{source_file} must exist on system.\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{source_file}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "fc09ac22-1766-4d3b-a0dd-4053344cd421",
      "p": "on-success",
      "o": "5c17130f-5ce5-4130-b45f-a79c42a5d52a"
    },
    {
      "s": "fc09ac22-1766-4d3b-a0dd-4053344cd421",
      "p": "on-failure",
      "o": "f6e67c10-9eea-40d9-830c-ee4ececb9118"
    },
    {
      "s": "f6e67c10-9eea-40d9-830c-ee4ececb9118",
      "p": "on-success",
      "o": "54d14b84-2142-4784-a761-f1c0977efc87"
    },
    {
      "s": "54d14b84-2142-4784-a761-f1c0977efc87",
      "p": "on-failure",
      "o": "5c17130f-5ce5-4130-b45f-a79c42a5d52a"
    }
  ],
  "tags": [
    "T1106",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "source_file",
      "type": "path",
      "description": "Location of the CSharp source file to compile and execute",
      "value": "PathToAtomicsFolder\\T1106\\src\\CreateProcess.cs"
    },
    {
      "name": "output_file",
      "type": "path",
      "description": "Location of the payload",
      "value": "%tmp%\\T1106.exe"
    }
  ]
}