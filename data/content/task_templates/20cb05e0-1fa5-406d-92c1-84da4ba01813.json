{
  "id": "20cb05e0-1fa5-406d-92c1-84da4ba01813",
  "name": "Decompile Local CHM File",
  "description": "Uses hh.exe to decompile a local compiled HTML Help file.\nUpon successful execution the chm file will decompile to disk.\nReference:https://www.ptsecurity.com/ww-en/analytics/pt-esc-threat-intelligence/higaisa-or-winnti-apt-41-backdoors-old-and-new/\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "f5b0a047-1f9f-4388-9051-cc3869dc2544",
      "type": "execute-command",
      "data": {
        "command": "hh.exe -decompile %temp% \"#{local_chm_file}\"\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "c9160177-6d74-40b7-9c41-2e77e38b4e18",
      "type": "execute-command",
      "data": {
        "command": "del %temp%\\T1218.001.html \u003enul 2\u003e\u00261\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "1b707715-0f7a-4ae4-baea-3807b521f404",
      "name": "Check dependency 1/1",
      "description": "The payload must exist on disk at specified location (#{local_chm_file})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{local_chm_file}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "265ae9c9-f5c3-462f-bec5-05bbe4480e09",
      "name": "Resolve dependency 1/1",
      "description": "The payload must exist on disk at specified location (#{local_chm_file})\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory (split-path \"#{local_chm_file}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1218.001/src/T1218.001.chm\" -OutFile \"#{local_chm_file}\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "6585383b-4770-4afa-847a-f49507276034",
      "name": "Re-check dependency 1/1",
      "description": "The payload must exist on disk at specified location (#{local_chm_file})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{local_chm_file}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "f5b0a047-1f9f-4388-9051-cc3869dc2544",
      "p": "on-success",
      "o": "c9160177-6d74-40b7-9c41-2e77e38b4e18"
    },
    {
      "s": "f5b0a047-1f9f-4388-9051-cc3869dc2544",
      "p": "on-failure",
      "o": "c9160177-6d74-40b7-9c41-2e77e38b4e18"
    },
    {
      "s": "1b707715-0f7a-4ae4-baea-3807b521f404",
      "p": "on-success",
      "o": "f5b0a047-1f9f-4388-9051-cc3869dc2544"
    },
    {
      "s": "1b707715-0f7a-4ae4-baea-3807b521f404",
      "p": "on-failure",
      "o": "265ae9c9-f5c3-462f-bec5-05bbe4480e09"
    },
    {
      "s": "265ae9c9-f5c3-462f-bec5-05bbe4480e09",
      "p": "on-success",
      "o": "6585383b-4770-4afa-847a-f49507276034"
    },
    {
      "s": "6585383b-4770-4afa-847a-f49507276034",
      "p": "on-failure",
      "o": "f5b0a047-1f9f-4388-9051-cc3869dc2544"
    }
  ],
  "tags": [
    "T1218.001",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "local_chm_file",
      "type": "path",
      "description": "Local .chm payload",
      "value": "PathToAtomicsFolder\\T1218.001\\src\\T1218.001.chm"
    }
  ]
}