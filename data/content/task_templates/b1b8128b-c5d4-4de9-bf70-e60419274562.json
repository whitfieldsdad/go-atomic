{
  "id": "b1b8128b-c5d4-4de9-bf70-e60419274562",
  "name": "MSP360 Connect Execution",
  "description": "An adversary may attempt to trick the user into downloading MSP360 Connect for use as a C2 channel.\nUpon successful execution, MSP360 Connect will be executed.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "23ae1d01-2e34-4614-b797-c30082696ca4",
      "type": "execute-command",
      "data": {
        "command": "Start-Process #{MSP360_Connect_Path}\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "eda14b19-a583-4dee-b7f0-56a817e35f22",
      "type": "execute-command",
      "data": {
        "command": "Stop-Process -Name \"Connect\" -force -erroraction silentlycontinue\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "76078066-0643-4371-a50d-9fc46b2ee133",
      "name": "Check dependency 1/1",
      "description": "MSP360 must exist at (#{MSP360_Connect_Path})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path #{MSP360_Connect_Path}) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "ce462e9c-493d-4258-845e-8b700edad3fd",
      "name": "Resolve dependency 1/1",
      "description": "MSP360 must exist at (#{MSP360_Connect_Path})\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest -OutFile \"PathToAtomicsFolder\\..\\ExternalPayloads\\msp360connect.exe\" \"https://s3.amazonaws.com/cb_setups/_current/cbra/setup.exe?X-Amz-Expires=604800\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIA2WIZE3YN7NOSY65U/20230515/us-east-1/s3/aws4_request\u0026X-Amz-Date=20230515T024742Z\u0026X-Amz-SignedHeaders=host\u0026response-content-disposition=attachment;filename=ConnectStandaloneSetup_v3.3.0.15_netv4.5.1_cFA9100C6.exe\u0026X-Amz-Signature=1fe3ddf93f8431b182fac90341f80a4ebf8665ddcc0e36dd385ee20d0ce865c9\"\nstart-process \"PathToAtomicsFolder\\..\\ExternalPayloads\\msp360connect.exe\" /S    \n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "922a6317-448a-4449-b1dc-41e4845724ea",
      "name": "Re-check dependency 1/1",
      "description": "MSP360 must exist at (#{MSP360_Connect_Path})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path #{MSP360_Connect_Path}) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "23ae1d01-2e34-4614-b797-c30082696ca4",
      "p": "on-success",
      "o": "eda14b19-a583-4dee-b7f0-56a817e35f22"
    },
    {
      "s": "23ae1d01-2e34-4614-b797-c30082696ca4",
      "p": "on-failure",
      "o": "eda14b19-a583-4dee-b7f0-56a817e35f22"
    },
    {
      "s": "76078066-0643-4371-a50d-9fc46b2ee133",
      "p": "on-success",
      "o": "23ae1d01-2e34-4614-b797-c30082696ca4"
    },
    {
      "s": "76078066-0643-4371-a50d-9fc46b2ee133",
      "p": "on-failure",
      "o": "ce462e9c-493d-4258-845e-8b700edad3fd"
    },
    {
      "s": "ce462e9c-493d-4258-845e-8b700edad3fd",
      "p": "on-success",
      "o": "922a6317-448a-4449-b1dc-41e4845724ea"
    },
    {
      "s": "922a6317-448a-4449-b1dc-41e4845724ea",
      "p": "on-failure",
      "o": "23ae1d01-2e34-4614-b797-c30082696ca4"
    }
  ],
  "tags": [
    "T1219",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "MSP360_Connect_Path",
      "type": "path",
      "description": "Path of MSP360 executable",
      "value": "$env:ProgramFiles\\Connect\\Connect.exe"
    }
  ]
}