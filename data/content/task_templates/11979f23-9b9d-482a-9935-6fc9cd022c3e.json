{
  "id": "11979f23-9b9d-482a-9935-6fc9cd022c3e",
  "name": "Event Monitor Daemon Persistence",
  "description": "This test adds persistence via a plist to execute via the macOS Event Monitor Daemon. \n",
  "platforms": [
    "darwin"
  ],
  "steps": [
    {
      "id": "d37df986-2e6d-4fab-9f48-2a6c94b3b25c",
      "type": "execute-command",
      "data": {
        "command": "sudo cp #{script_location} #{script_destination}\nsudo touch /private/var/db/emondClients/#{empty_file}\n",
        "command_type": "bash"
      },
      "elevation_required": false
    },
    {
      "id": "90b14ff0-156f-4720-81df-8c9cfa22e2cd",
      "type": "execute-command",
      "data": {
        "command": "sudo rm #{script_destination}\nsudo rm /private/var/db/emondClients/#{empty_file}",
        "command_type": "bash"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "d37df986-2e6d-4fab-9f48-2a6c94b3b25c",
      "p": "on-success",
      "o": "90b14ff0-156f-4720-81df-8c9cfa22e2cd"
    },
    {
      "s": "d37df986-2e6d-4fab-9f48-2a6c94b3b25c",
      "p": "on-failure",
      "o": "90b14ff0-156f-4720-81df-8c9cfa22e2cd"
    }
  ],
  "tags": [
    "T1543.001",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "empty_file",
      "type": "string",
      "description": "Random name of the empty file used to trigger emond service",
      "value": "randomflag"
    },
    {
      "name": "script_location",
      "type": "path",
      "description": "evil plist location",
      "value": "$PathToAtomicsFolder/T1543.001/src/atomicredteam_T1543_001.plist"
    },
    {
      "name": "script_destination",
      "type": "path",
      "description": "Path where to move the evil plist",
      "value": "/etc/emond.d/rules/atomicredteam_T1543_001.plist"
    }
  ]
}