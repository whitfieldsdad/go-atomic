{
  "id": "08cbf59f-85da-4369-a5f4-049cffd7709f",
  "name": "Encrypt files using ccrypt (FreeBSD/Linux)",
  "description": "Attempts to encrypt data on target systems as root to simulate an inturruption authentication to target system. If root permissions are not available then attempts to encrypt data within user's home directory.\n",
  "platforms": [
    "linux"
  ],
  "steps": [
    {
      "id": "9982caba-b753-4fa2-af30-16a0132915fd",
      "type": "execute-command",
      "data": {
        "command": "if [ $USER == \"root\" ]; then $which_ccencrypt #{root_input_file_path}; file #{root_input_file_path}.cpt; #{impact_command}; else $which_ccencrypt #{user_input_file_path}; file #{user_input_file_path}.cpt; #{impact_command}; fi",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "b08f50a8-1121-44ba-8eb7-fe19b46937fe",
      "type": "execute-command",
      "data": {
        "command": "if [ $USER == \"root\" ]; then mv #{cped_file_path} #{root_input_file_path}; else cp #{cped_file_path} #{user_input_file_path}; fi",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "df4460a0-a3c8-4ef6-8c28-1401b5250277",
      "name": "Check dependency 1/1",
      "description": "Finds where ccencrypt and ccdecrypt is located and copies input file\n",
      "type": "execute-command",
      "data": {
        "command": "which_ccencrypt=`which ccencrypt`\nwhich_ccdecrypt=`which ccdecrypt`\nif [ $USER == \"root\" ]; then cp #{root_input_file_path} #{cped_file_path}; else cp #{user_input_file_path} #{cped_file_path}; fi",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "9e7cf111-0115-4b6e-a6cf-6e7e480b3b52",
      "name": "Resolve dependency 1/1",
      "description": "Finds where ccencrypt and ccdecrypt is located and copies input file\n",
      "type": "execute-command",
      "data": {
        "command": "(which pkg \u0026\u0026 pkg install -y ccript)||(which yum \u0026\u0026 yum -y install epel-release ccrypt)||(which apt-get \u0026\u0026 DEBIAN_FRONTEND=noninteractive apt-get install -y ccrypt)",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "82300be5-36cc-4bd1-9e03-d9b58834ed5f",
      "name": "Re-check dependency 1/1",
      "description": "Finds where ccencrypt and ccdecrypt is located and copies input file\n",
      "type": "execute-command",
      "data": {
        "command": "which_ccencrypt=`which ccencrypt`\nwhich_ccdecrypt=`which ccdecrypt`\nif [ $USER == \"root\" ]; then cp #{root_input_file_path} #{cped_file_path}; else cp #{user_input_file_path} #{cped_file_path}; fi",
        "command_type": "sh"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "9982caba-b753-4fa2-af30-16a0132915fd",
      "p": "on-success",
      "o": "b08f50a8-1121-44ba-8eb7-fe19b46937fe"
    },
    {
      "s": "9982caba-b753-4fa2-af30-16a0132915fd",
      "p": "on-failure",
      "o": "b08f50a8-1121-44ba-8eb7-fe19b46937fe"
    },
    {
      "s": "df4460a0-a3c8-4ef6-8c28-1401b5250277",
      "p": "on-success",
      "o": "9982caba-b753-4fa2-af30-16a0132915fd"
    },
    {
      "s": "df4460a0-a3c8-4ef6-8c28-1401b5250277",
      "p": "on-failure",
      "o": "9e7cf111-0115-4b6e-a6cf-6e7e480b3b52"
    },
    {
      "s": "9e7cf111-0115-4b6e-a6cf-6e7e480b3b52",
      "p": "on-success",
      "o": "82300be5-36cc-4bd1-9e03-d9b58834ed5f"
    },
    {
      "s": "82300be5-36cc-4bd1-9e03-d9b58834ed5f",
      "p": "on-failure",
      "o": "9982caba-b753-4fa2-af30-16a0132915fd"
    }
  ],
  "tags": [
    "T1486"
  ],
  "input_arguments": [
    {
      "name": "user_input_file_path",
      "type": "path",
      "description": "path to file that you want to be encrypted if you are normal user",
      "value": "~/.bash_history"
    },
    {
      "name": "impact_command",
      "type": "string",
      "description": "command to show impact of encryption",
      "value": "sudo su"
    },
    {
      "name": "cped_file_path",
      "type": "path",
      "description": "path where you want your copied file to be",
      "value": "/tmp/passwd"
    },
    {
      "name": "root_input_file_path",
      "type": "path",
      "description": "path to the file that you want to be encrypted if you are root user",
      "value": "/etc/passwd"
    }
  ]
}