{
  "id": "3c898f62-626c-47d5-aad2-6de873d69153",
  "name": "Windows Screencapture",
  "description": "Use Psr.exe binary to collect screenshots of user display. Test will do left mouse click to simulate user behaviour\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "6c6c6e1b-a04e-4ac0-a0ae-5e0573dc7bc5",
      "type": "execute-command",
      "data": {
        "command": "cmd /c start /b psr.exe /start /output #{output_file} /sc 1 /gui 0 /stopevent 12\nAdd-Type -MemberDefinition '[DllImport(\"user32.dll\")] public static extern void mouse_event(int flags, int dx, int dy, int cButtons, int info);' -Name U32 -Namespace W;\n[W.U32]::mouse_event(0x02 -bor 0x04 -bor 0x01, 0, 0, 0, 0);\ncmd /c \"timeout #{recording_time} \u003e NULL \u0026\u0026 psr.exe /stop\"\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "cf80832b-9e03-4331-bc58-31c6d9780a2c",
      "type": "execute-command",
      "data": {
        "command": "rm #{output_file} -ErrorAction Ignore\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "6c6c6e1b-a04e-4ac0-a0ae-5e0573dc7bc5",
      "p": "on-success",
      "o": "cf80832b-9e03-4331-bc58-31c6d9780a2c"
    },
    {
      "s": "6c6c6e1b-a04e-4ac0-a0ae-5e0573dc7bc5",
      "p": "on-failure",
      "o": "cf80832b-9e03-4331-bc58-31c6d9780a2c"
    }
  ],
  "tags": [
    "T1113",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "recording_time",
      "type": "integer",
      "description": "Time to take screenshots",
      "value": "5"
    },
    {
      "name": "output_file",
      "type": "path",
      "description": "Output file path",
      "value": "c:\\temp\\T1113_desktop.zip"
    }
  ]
}