{
  "id": "19acf63b-55c4-4b6a-8552-00a8865105c8",
  "name": "UltraViewer - RAT Execution",
  "description": "A recent trend by threat actors, once a foothold is established, maintain long term persistence using third party remote services such as UltraViewer to provide the operator with access to the network using legitimate services. \n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "da9ad766-d02d-4b20-af16-cfea2bd03cad",
      "type": "execute-command",
      "data": {
        "command": "Start-Process -Wait -FilePath \"#{UltraViewer_Path}\" -Argument \"/silent\" -PassThru\nStart-Process 'C:\\Program Files (x86)\\UltraViewer\\UltraViewer_Desktop.exe'\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "397b1afc-cc66-47b6-a6bc-517fd149ca40",
      "type": "execute-command",
      "data": {
        "command": "Stop-Process -Name \"UltraViewer_Desktop\" -Force -ErrorAction SilentlyContinue\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "300c564a-4be6-4841-a0f7-d25b24516678",
      "name": "Check dependency 1/1",
      "description": "Ultraviewer installer must be downloaded and exist on the disk at the specified location. (#{UltraViewer_Path})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{UltraViewer_Path}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "3b3670c0-7a82-4d33-90a7-0c49bdd947c0",
      "name": "Resolve dependency 1/1",
      "description": "Ultraviewer installer must be downloaded and exist on the disk at the specified location. (#{UltraViewer_Path})\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\n(New-Object Net.WebClient).DownloadFile(\"https://www.ultraviewer.net/en/UltraViewer_setup_6.5_en.exe\",\"#{UltraViewer_Path}\")\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "b8fe6c3f-faad-4bc7-bbd2-236e036d117d",
      "name": "Re-check dependency 1/1",
      "description": "Ultraviewer installer must be downloaded and exist on the disk at the specified location. (#{UltraViewer_Path})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{UltraViewer_Path}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "da9ad766-d02d-4b20-af16-cfea2bd03cad",
      "p": "on-success",
      "o": "397b1afc-cc66-47b6-a6bc-517fd149ca40"
    },
    {
      "s": "da9ad766-d02d-4b20-af16-cfea2bd03cad",
      "p": "on-failure",
      "o": "397b1afc-cc66-47b6-a6bc-517fd149ca40"
    },
    {
      "s": "300c564a-4be6-4841-a0f7-d25b24516678",
      "p": "on-success",
      "o": "da9ad766-d02d-4b20-af16-cfea2bd03cad"
    },
    {
      "s": "300c564a-4be6-4841-a0f7-d25b24516678",
      "p": "on-failure",
      "o": "3b3670c0-7a82-4d33-90a7-0c49bdd947c0"
    },
    {
      "s": "3b3670c0-7a82-4d33-90a7-0c49bdd947c0",
      "p": "on-success",
      "o": "b8fe6c3f-faad-4bc7-bbd2-236e036d117d"
    },
    {
      "s": "b8fe6c3f-faad-4bc7-bbd2-236e036d117d",
      "p": "on-failure",
      "o": "da9ad766-d02d-4b20-af16-cfea2bd03cad"
    }
  ],
  "tags": [
    "T1219",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "UltraViewer_Path",
      "type": "path",
      "description": "Path to the UltraViewer executable.",
      "value": "PathToAtomicsFolder\\..\\ExternalPayloads\\T1219_UltraViewer.exe"
    }
  ]
}