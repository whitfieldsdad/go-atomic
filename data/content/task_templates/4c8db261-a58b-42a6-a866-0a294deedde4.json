{
  "id": "4c8db261-a58b-42a6-a866-0a294deedde4",
  "name": "Running Chrome VPN Extensions via the Registry 2 vpn extension",
  "description": "Running Chrome VPN Extensions via the Registry install 2 vpn extension, please see \"T1133\\src\\list of vpn extension.txt\" to view complete list\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "2ca23144-5a0a-4a94-9732-df896109ae32",
      "type": "execute-command",
      "data": {
        "command": "$extList = #{extension_id}\nforeach ($extension in $extList) {\n  New-Item -Path HKLM:\\Software\\Wow6432Node\\Google\\Chrome\\Extensions\\$extension -Force\n  New-ItemProperty -Path \"HKLM:\\Software\\Wow6432Node\\Google\\Chrome\\Extensions\\$extension\" -Name \"update_url\" -Value \"https://clients2.google.com/service/update2/crx\" -PropertyType \"String\" -Force}\nStart chrome\nStart-Sleep -Seconds 30\nStop-Process -Name \"chrome\"\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "9a755546-101b-4dc9-88f7-b4a0a7c6438d",
      "type": "execute-command",
      "data": {
        "command": "$extList = #{extension_id}\nforeach ($extension in $extList) {\nRemove-Item -Path \"HKLM:\\Software\\Wow6432Node\\Google\\Chrome\\Extensions\\$extension\" -ErrorAction Ignore}\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "f9b8f258-7474-48ad-827d-5562fde120ae",
      "name": "Check dependency 1/1",
      "description": "Chrome must be installed\n",
      "type": "execute-command",
      "data": {
        "command": "if ((Test-Path \"C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe\") -Or (Test-Path \"C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe\")) {exit 0} else {exit 1}",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "8c65bb47-b9af-4d21-9361-15eaad04fb87",
      "name": "Resolve dependency 1/1",
      "description": "Chrome must be installed\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest -OutFile \"PathToAtomicsFolder\\..\\ExternalPayloads\\ChromeStandaloneSetup64.exe\" #{chrome_url}\nStart-Process \"PathToAtomicsFolder\\..\\ExternalPayloads\\ChromeStandaloneSetup64.exe\" /S\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "0321b24e-7222-4369-8265-537505294ac3",
      "name": "Re-check dependency 1/1",
      "description": "Chrome must be installed\n",
      "type": "execute-command",
      "data": {
        "command": "if ((Test-Path \"C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe\") -Or (Test-Path \"C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe\")) {exit 0} else {exit 1}",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "2ca23144-5a0a-4a94-9732-df896109ae32",
      "p": "on-success",
      "o": "9a755546-101b-4dc9-88f7-b4a0a7c6438d"
    },
    {
      "s": "2ca23144-5a0a-4a94-9732-df896109ae32",
      "p": "on-failure",
      "o": "9a755546-101b-4dc9-88f7-b4a0a7c6438d"
    },
    {
      "s": "f9b8f258-7474-48ad-827d-5562fde120ae",
      "p": "on-success",
      "o": "2ca23144-5a0a-4a94-9732-df896109ae32"
    },
    {
      "s": "f9b8f258-7474-48ad-827d-5562fde120ae",
      "p": "on-failure",
      "o": "8c65bb47-b9af-4d21-9361-15eaad04fb87"
    },
    {
      "s": "8c65bb47-b9af-4d21-9361-15eaad04fb87",
      "p": "on-success",
      "o": "0321b24e-7222-4369-8265-537505294ac3"
    },
    {
      "s": "0321b24e-7222-4369-8265-537505294ac3",
      "p": "on-failure",
      "o": "2ca23144-5a0a-4a94-9732-df896109ae32"
    }
  ],
  "tags": [
    "T1133",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "chrome_url",
      "type": "url",
      "description": "chrome installer download URL",
      "value": "https://dl.google.com/tag/s/appguid%3D%7B8A69D345-D564-463C-AFF1-A69D9E530F96%7D%26iid%3D%7BFD62DDBC-14C6-20BD-706F-C7744738E422%7D%26lang%3Den%26browser%3D3%26usagestats%3D0%26appname%3DGoogle%2520Chrome%26needsadmin%3Dprefers%26ap%3Dx64-stable-statsdef_1%26installdataindex%3Dempty/chrome/install/ChromeStandaloneSetup64.exe"
    },
    {
      "name": "extension_id",
      "type": "string",
      "description": "chrome extension id",
      "value": "\"fcfhplploccackoneaefokcmbjfbkenj\", \"fdcgdnkidjaadafnichfpabhfomcebme\"\n"
    }
  ]
}