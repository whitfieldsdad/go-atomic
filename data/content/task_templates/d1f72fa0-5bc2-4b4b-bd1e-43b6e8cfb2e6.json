{
  "id": "d1f72fa0-5bc2-4b4b-bd1e-43b6e8cfb2e6",
  "name": "Cobalt Strike SSH (postex_ssh) pipe",
  "description": "Uses the [Named Pipes Micro Emulation](https://github.com/center-for-threat-informed-defense/adversary_emulation_library/tree/master/micro_emulation_plans/src/named_pipes) executable from the Center for Threat Informed Defense to create a named pipe for inter-process communication.\n\nThe named pipe executable will pause for 30 seconds to allow the client and server to exchange a message through the pipe.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "6d595726-c869-4f36-8516-afbc7f247464",
      "type": "execute-command",
      "data": {
        "command": "\"PathToAtomicsFolder\\..\\ExternalPayloads\\build\\namedpipes_executor.exe\" --pipe 3\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "4022c3f7-5602-464c-aa07-3b250ad05f58",
      "name": "Check dependency 1/1",
      "description": "Named pipe executors must exist on disk\n",
      "type": "execute-command",
      "data": {
        "command": "if ((Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\build\\namedpipes_executor.exe\") -and (Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\build\\namedpipes_client.exe\") -and (Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\build\\namedpipes_server.exe\")) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "0e68e984-6e03-4d5f-8a1a-937470ac44d3",
      "name": "Resolve dependency 1/1",
      "description": "Named pipe executors must exist on disk\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction ignore -Force | Out-Null\n[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (iwr \"https://raw.githubusercontent.com/redcanaryco/invoke-atomicredteam/master/Public/Invoke-FetchFromZip.ps1\" -UseBasicParsing)\n$zipUrl  = \"https://github.com/center-for-threat-informed-defense/adversary_emulation_library/raw/master/micro_emulation_plans/src/named_pipes/named_pipes.zip\"\nInvoke-FetchFromZip $zipUrl \"*.exe\" \"PathToAtomicsFolder\\..\\ExternalPayloads\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "9e0812ae-a636-4599-aeb6-395dadcf2a94",
      "name": "Re-check dependency 1/1",
      "description": "Named pipe executors must exist on disk\n",
      "type": "execute-command",
      "data": {
        "command": "if ((Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\build\\namedpipes_executor.exe\") -and (Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\build\\namedpipes_client.exe\") -and (Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\build\\namedpipes_server.exe\")) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "4022c3f7-5602-464c-aa07-3b250ad05f58",
      "p": "on-success",
      "o": "6d595726-c869-4f36-8516-afbc7f247464"
    },
    {
      "s": "4022c3f7-5602-464c-aa07-3b250ad05f58",
      "p": "on-failure",
      "o": "0e68e984-6e03-4d5f-8a1a-937470ac44d3"
    },
    {
      "s": "0e68e984-6e03-4d5f-8a1a-937470ac44d3",
      "p": "on-success",
      "o": "9e0812ae-a636-4599-aeb6-395dadcf2a94"
    },
    {
      "s": "9e0812ae-a636-4599-aeb6-395dadcf2a94",
      "p": "on-failure",
      "o": "6d595726-c869-4f36-8516-afbc7f247464"
    }
  ],
  "tags": [
    "T1559",
    "atomic-red-team"
  ]
}