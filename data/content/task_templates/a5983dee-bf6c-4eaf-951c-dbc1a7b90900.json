{
  "id": "a5983dee-bf6c-4eaf-951c-dbc1a7b90900",
  "name": "Launch Agent",
  "description": "Create a plist and execute it\n",
  "platforms": [
    "darwin"
  ],
  "steps": [
    {
      "id": "3d7159af-5954-4058-be7d-37e21e3aa73f",
      "type": "execute-command",
      "data": {
        "command": "if [ ! -d ~/Library/LaunchAgents ]; then mkdir ~/Library/LaunchAgents; fi;\nsudo cp #{path_malicious_plist} ~/Library/LaunchAgents/#{plist_filename}\nsudo launchctl load -w ~/Library/LaunchAgents/#{plist_filename}\n",
        "command_type": "bash"
      },
      "elevation_required": false
    },
    {
      "id": "f729f794-d883-48f8-b878-845ad5bff142",
      "type": "execute-command",
      "data": {
        "command": "sudo launchctl unload ~/Library/LaunchAgents/#{plist_filename}\nsudo rm ~/Library/LaunchAgents/#{plist_filename}\n",
        "command_type": "bash"
      },
      "elevation_required": false
    },
    {
      "id": "0f0cc4ff-5a13-45b4-91c4-f22f97e8dc7a",
      "name": "Check dependency 1/1",
      "description": "The shared library must exist on disk at specified location (#{path_malicious_plist})\n",
      "type": "execute-command",
      "data": {
        "command": "if [ -f #{path_malicious_plist} ]; then exit 0; else exit 1; fi;\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "373eb381-a1ac-4277-bfe2-d14e65289bfb",
      "name": "Resolve dependency 1/1",
      "description": "The shared library must exist on disk at specified location (#{path_malicious_plist})\n",
      "type": "execute-command",
      "data": {
        "command": "echo \"The shared library doesn't exist. Check the path\"; exit 1;\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "7b3c5b00-3ad1-4033-8df7-5f11d2b4b8ce",
      "name": "Re-check dependency 1/1",
      "description": "The shared library must exist on disk at specified location (#{path_malicious_plist})\n",
      "type": "execute-command",
      "data": {
        "command": "if [ -f #{path_malicious_plist} ]; then exit 0; else exit 1; fi;\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "3d7159af-5954-4058-be7d-37e21e3aa73f",
      "p": "on-success",
      "o": "f729f794-d883-48f8-b878-845ad5bff142"
    },
    {
      "s": "3d7159af-5954-4058-be7d-37e21e3aa73f",
      "p": "on-failure",
      "o": "f729f794-d883-48f8-b878-845ad5bff142"
    },
    {
      "s": "0f0cc4ff-5a13-45b4-91c4-f22f97e8dc7a",
      "p": "on-success",
      "o": "3d7159af-5954-4058-be7d-37e21e3aa73f"
    },
    {
      "s": "0f0cc4ff-5a13-45b4-91c4-f22f97e8dc7a",
      "p": "on-failure",
      "o": "373eb381-a1ac-4277-bfe2-d14e65289bfb"
    },
    {
      "s": "373eb381-a1ac-4277-bfe2-d14e65289bfb",
      "p": "on-success",
      "o": "7b3c5b00-3ad1-4033-8df7-5f11d2b4b8ce"
    },
    {
      "s": "7b3c5b00-3ad1-4033-8df7-5f11d2b4b8ce",
      "p": "on-failure",
      "o": "3d7159af-5954-4058-be7d-37e21e3aa73f"
    }
  ],
  "tags": [
    "T1543.001",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "path_malicious_plist",
      "type": "string",
      "description": "Name of file to store in cron folder",
      "value": "$PathToAtomicsFolder/T1543.001/src/atomicredteam_T1543_001.plist"
    },
    {
      "name": "plist_filename",
      "type": "string",
      "description": "filename",
      "value": "com.atomicredteam.plist"
    }
  ]
}