{
  "id": "03ab8df5-3a6b-4417-b6bd-bb7a5cfd74cf",
  "name": "Launch Daemon",
  "description": "Utilize LaunchDaemon to launch `Hello World`\n",
  "platforms": [
    "darwin"
  ],
  "steps": [
    {
      "id": "a5ca85d0-d2c5-446c-93dd-b32bcbf48b05",
      "type": "execute-command",
      "data": {
        "command": "sudo cp #{path_malicious_plist} /Library/LaunchDaemons/#{plist_filename}\nsudo launchctl load -w /Library/LaunchDaemons/#{plist_filename}\n",
        "command_type": "bash"
      },
      "elevation_required": false
    },
    {
      "id": "ee5c317e-1168-42f2-8867-937d53e7fbf3",
      "type": "execute-command",
      "data": {
        "command": "sudo launchctl unload /Library/LaunchDaemons/#{plist_filename}\nsudo rm /Library/LaunchDaemons/#{plist_filename}\nsudo rm /tmp/T1543_004_atomicredteam.txt\n",
        "command_type": "bash"
      },
      "elevation_required": false
    },
    {
      "id": "04a638d2-f0cb-4db4-b458-2a383468cb82",
      "name": "Check dependency 1/1",
      "description": "The shared library must exist on disk at specified location (#{path_malicious_plist})\n",
      "type": "execute-command",
      "data": {
        "command": "if [ -f #{path_malicious_plist} ]; then exit 0; else exit 1; fi;\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "68162cb6-8067-42a5-8284-40d8141b0f30",
      "name": "Resolve dependency 1/1",
      "description": "The shared library must exist on disk at specified location (#{path_malicious_plist})\n",
      "type": "execute-command",
      "data": {
        "command": "echo \"The plist file doesn't exist. Check the path and try again.\"; exit 1;\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "45fa1592-efbe-4c13-97fb-f218309e6c34",
      "name": "Re-check dependency 1/1",
      "description": "The shared library must exist on disk at specified location (#{path_malicious_plist})\n",
      "type": "execute-command",
      "data": {
        "command": "if [ -f #{path_malicious_plist} ]; then exit 0; else exit 1; fi;\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "a5ca85d0-d2c5-446c-93dd-b32bcbf48b05",
      "p": "on-success",
      "o": "ee5c317e-1168-42f2-8867-937d53e7fbf3"
    },
    {
      "s": "a5ca85d0-d2c5-446c-93dd-b32bcbf48b05",
      "p": "on-failure",
      "o": "ee5c317e-1168-42f2-8867-937d53e7fbf3"
    },
    {
      "s": "04a638d2-f0cb-4db4-b458-2a383468cb82",
      "p": "on-success",
      "o": "a5ca85d0-d2c5-446c-93dd-b32bcbf48b05"
    },
    {
      "s": "04a638d2-f0cb-4db4-b458-2a383468cb82",
      "p": "on-failure",
      "o": "68162cb6-8067-42a5-8284-40d8141b0f30"
    },
    {
      "s": "68162cb6-8067-42a5-8284-40d8141b0f30",
      "p": "on-success",
      "o": "45fa1592-efbe-4c13-97fb-f218309e6c34"
    },
    {
      "s": "45fa1592-efbe-4c13-97fb-f218309e6c34",
      "p": "on-failure",
      "o": "a5ca85d0-d2c5-446c-93dd-b32bcbf48b05"
    }
  ],
  "tags": [
    "T1543.004",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "plist_filename",
      "type": "string",
      "description": "filename",
      "value": "com.atomicredteam.plist"
    },
    {
      "name": "path_malicious_plist",
      "type": "string",
      "description": "Name of file to store in cron folder",
      "value": "$PathToAtomicsFolder/T1543.004/src/atomicredteam_T1543_004.plist"
    }
  ]
}