{
  "id": "eb121494-82d1-4148-9e2b-e624e03fbf3d",
  "name": "Staging Local Certificates via Export-Certificate",
  "description": "Export all user certificates and add to a compressed archive.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "559d2893-e5ec-4376-af43-16d35950b7dc",
      "type": "execute-command",
      "data": {
        "command": "$archive=\"$env:PUBLIC\\T1649\\atomic_certs.zip\"\n$exfilpath=\"$env:PUBLIC\\T1649\\certs\"\nAdd-Type -assembly \"system.io.compression.filesystem\"\nRemove-Item $(split-path $exfilpath) -Recurse -Force -ErrorAction Ignore\nmkdir $exfilpath | Out-Null\nforeach ($cert in (gci Cert:\\CurrentUser\\My)) { Export-Certificate -Cert $cert -FilePath $exfilpath\\$($cert.FriendlyName).cer}\n[io.compression.zipfile]::CreateFromDirectory($exfilpath, $archive)\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "77be3e71-bfc7-4437-90bf-28dad1eb9a08",
      "type": "execute-command",
      "data": {
        "command": "$exfilpath=\"$env:PUBLIC\\T1649\\certs\"\nRemove-Item $(split-path $exfilpath) -Recurse -Force -ErrorAction Ignore\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "559d2893-e5ec-4376-af43-16d35950b7dc",
      "p": "on-success",
      "o": "77be3e71-bfc7-4437-90bf-28dad1eb9a08"
    },
    {
      "s": "559d2893-e5ec-4376-af43-16d35950b7dc",
      "p": "on-failure",
      "o": "77be3e71-bfc7-4437-90bf-28dad1eb9a08"
    }
  ],
  "tags": [
    "T1649",
    "atomic-red-team"
  ]
}