{
  "id": "eb121494-82d1-4148-9e2b-e624e03fbf3d",
  "name": "Staging Local Certificates via Export-Certificate",
  "description": "Export all user certificates and add to a compressed archive.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "4852575c-cad5-408a-914d-02f842b86cb4",
      "type": "execute-command",
      "data": {
        "command": "$archive=\"$env:PUBLIC\\T1649\\atomic_certs.zip\"\n$exfilpath=\"$env:PUBLIC\\T1649\\certs\"\nAdd-Type -assembly \"system.io.compression.filesystem\"\nRemove-Item $(split-path $exfilpath) -Recurse -Force -ErrorAction Ignore\nmkdir $exfilpath | Out-Null\nforeach ($cert in (gci Cert:\\CurrentUser\\My)) { Export-Certificate -Cert $cert -FilePath $exfilpath\\$($cert.FriendlyName).cer}\n[io.compression.zipfile]::CreateFromDirectory($exfilpath, $archive)",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "a3f2f73c-9a94-4aea-b515-d52a4eb6e051",
      "type": "execute-command",
      "data": {
        "command": "$exfilpath=\"$env:PUBLIC\\T1649\\certs\"\nRemove-Item $(split-path $exfilpath) -Recurse -Force -ErrorAction Ignore",
        "command_type": "powershell"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "4852575c-cad5-408a-914d-02f842b86cb4",
      "p": "on-success",
      "o": "a3f2f73c-9a94-4aea-b515-d52a4eb6e051"
    },
    {
      "s": "4852575c-cad5-408a-914d-02f842b86cb4",
      "p": "on-failure",
      "o": "a3f2f73c-9a94-4aea-b515-d52a4eb6e051"
    }
  ],
  "tags": [
    "T1649"
  ]
}