{
  "id": "eb121494-82d1-4148-9e2b-e624e03fbf3d",
  "name": "Staging Local Certificates via Export-Certificate",
  "description": "Export all user certificates and add to a compressed archive.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "45c630ce-eab5-49d5-b369-c1a4080fefbc",
      "type": "execute-command",
      "data": {
        "command": "$archive=\"$env:PUBLIC\\T1649\\atomic_certs.zip\"\n$exfilpath=\"$env:PUBLIC\\T1649\\certs\"\nAdd-Type -assembly \"system.io.compression.filesystem\"\nRemove-Item $(split-path $exfilpath) -Recurse -Force -ErrorAction Ignore\nmkdir $exfilpath | Out-Null\nforeach ($cert in (gci Cert:\\CurrentUser\\My)) { Export-Certificate -Cert $cert -FilePath $exfilpath\\$($cert.FriendlyName).cer}\n[io.compression.zipfile]::CreateFromDirectory($exfilpath, $archive)\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "daa7382a-3fab-41ab-b7ac-ee7a20489c56",
      "type": "execute-command",
      "data": {
        "command": "$exfilpath=\"$env:PUBLIC\\T1649\\certs\"\nRemove-Item $(split-path $exfilpath) -Recurse -Force -ErrorAction Ignore\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "45c630ce-eab5-49d5-b369-c1a4080fefbc",
      "p": "on-success",
      "o": "daa7382a-3fab-41ab-b7ac-ee7a20489c56"
    },
    {
      "s": "45c630ce-eab5-49d5-b369-c1a4080fefbc",
      "p": "on-failure",
      "o": "daa7382a-3fab-41ab-b7ac-ee7a20489c56"
    }
  ],
  "tags": [
    "T1649"
  ]
}