{
  "id": "8a930abe-841c-4d4f-a877-72e9fe90b9ea",
  "name": "Enable Apple Remote Desktop Agent",
  "description": "ARD leverages a blend of protocols, including VNC to send the screen and control buffers and SSH for secure file transfer. \nAdversaries can abuse ARD to gain remote code execution and perform lateral movement.\n\nReferences:  https://www.mandiant.com/resources/blog/leveraging-apple-remote-desktop-for-good-and-evil\n",
  "platforms": [
    "darwin"
  ],
  "steps": [
    {
      "id": "f33e32e2-b6d6-4ddb-8e27-d77caad852f8",
      "type": "execute-command",
      "data": {
        "command": "sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -activate -configure -allowAccessFor -allUsers -privs -all -quiet",
        "command_type": "sh"
      },
      "elevation_required": true
    },
    {
      "id": "ec8ba87d-e773-4190-b168-ccfe73723145",
      "type": "execute-command",
      "data": {
        "command": "sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -deactivate -stop -configure -privs -none -quiet",
        "command_type": "sh"
      },
      "elevation_required": true
    }
  ],
  "flows": [
    {
      "s": "f33e32e2-b6d6-4ddb-8e27-d77caad852f8",
      "p": "on-success",
      "o": "ec8ba87d-e773-4190-b168-ccfe73723145"
    },
    {
      "s": "f33e32e2-b6d6-4ddb-8e27-d77caad852f8",
      "p": "on-failure",
      "o": "ec8ba87d-e773-4190-b168-ccfe73723145"
    }
  ],
  "tags": [
    "T1021",
    "T1021.005"
  ]
}