{
  "id": "c510d25b-1667-467d-8331-a56d3e9bc4ff",
  "name": "Application uninstall using WMIC",
  "description": "Emulates uninstalling  applications using WMIC.  This method only works if the product was installed with an msi file.  APTs have been seen using this to uninstall security products.",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "5e2ec15e-ca9a-4689-bc9b-98f213f4bf99",
      "type": "execute-command",
      "data": {
        "command": "wmic /node:\"#{node}\" product where \"name like '#{product}%%'\" call uninstall",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "730d319b-1c75-4aed-898d-ebcbbeeda52b",
      "type": "execute-command",
      "data": {
        "command": "msiexec /i \"PathToAtomicsFolder\\..\\ExternalPayloads\\tightvncinstaller.msi\" /qn /norestart",
        "command_type": "command_prompt"
      },
      "elevation_required": false
    },
    {
      "id": "16eca621-56fa-448a-816c-f1c63b3ea0f8",
      "name": "Check dependency 1/1",
      "description": "TightVNC must be installed.",
      "type": "execute-command",
      "data": {
        "command": "if ((Test-Path \"C:\\Program Files\\TightVNC\\tvnviewer.exe\")-Or (Test-Path \"C:\\Program Files (x86)\\TightVNC\\tvnviewer.exe\")) {exit 0} else {exit 1}",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "49f274aa-4786-4490-9016-97d7675cdd4f",
      "name": "Resolve dependency 1/1",
      "description": "TightVNC must be installed.",
      "type": "execute-command",
      "data": {
        "command": "Invoke-WebRequest 'https://www.tightvnc.com/download/2.8.63/tightvnc-2.8.63-gpl-setup-64bit.msi' -OutFile \"PathToAtomicsFolder\\..\\ExternalPayloads\\tightvncinstaller.msi\"\nstart-sleep -s 10\nmsiexec /i \"PathToAtomicsFolder\\..\\ExternalPayloads\\tightvncinstaller.msi\" /qn /norestart\nstart-sleep -s 15",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "6c9664c6-f2da-4778-9155-5c90f47cfb42",
      "name": "Re-check dependency 1/1",
      "description": "TightVNC must be installed.",
      "type": "execute-command",
      "data": {
        "command": "if ((Test-Path \"C:\\Program Files\\TightVNC\\tvnviewer.exe\")-Or (Test-Path \"C:\\Program Files (x86)\\TightVNC\\tvnviewer.exe\")) {exit 0} else {exit 1}",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "5e2ec15e-ca9a-4689-bc9b-98f213f4bf99",
      "p": "on-success",
      "o": "730d319b-1c75-4aed-898d-ebcbbeeda52b"
    },
    {
      "s": "5e2ec15e-ca9a-4689-bc9b-98f213f4bf99",
      "p": "on-failure",
      "o": "730d319b-1c75-4aed-898d-ebcbbeeda52b"
    },
    {
      "s": "16eca621-56fa-448a-816c-f1c63b3ea0f8",
      "p": "on-success",
      "o": "5e2ec15e-ca9a-4689-bc9b-98f213f4bf99"
    },
    {
      "s": "16eca621-56fa-448a-816c-f1c63b3ea0f8",
      "p": "on-failure",
      "o": "49f274aa-4786-4490-9016-97d7675cdd4f"
    },
    {
      "s": "49f274aa-4786-4490-9016-97d7675cdd4f",
      "p": "on-success",
      "o": "6c9664c6-f2da-4778-9155-5c90f47cfb42"
    },
    {
      "s": "6c9664c6-f2da-4778-9155-5c90f47cfb42",
      "p": "on-failure",
      "o": "5e2ec15e-ca9a-4689-bc9b-98f213f4bf99"
    }
  ],
  "tags": [
    "T1047",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "product",
      "type": "string",
      "description": "Enter the product name being uninstalled.  This will default to TightVNC.",
      "value": "Tightvnc"
    },
    {
      "name": "node",
      "type": "string",
      "description": "Computer the action is being executed against but defaults to the localhost.",
      "value": "127.0.0.1"
    }
  ]
}