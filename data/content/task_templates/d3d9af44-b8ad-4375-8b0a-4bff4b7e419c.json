{
  "id": "d3d9af44-b8ad-4375-8b0a-4bff4b7e419c",
  "name": "Search files of interest and save them to a single zip file (Windows)",
  "description": "This test searches for files of certain extensions and saves them to a single zip file prior to extraction.                              \n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "4a6f0b80-6b6e-424f-9aef-faff10203044",
      "type": "execute-command",
      "data": {
        "command": "$startingDirectory = \"#{starting_directory}\"\n$outputZip = \"#{output_zip_folder_path}\"\n$fileExtensionsString = \"#{file_extensions}\" \n$fileExtensions = $fileExtensionsString -split \", \"\n\nNew-Item -Type Directory $outputZip -ErrorAction Ignore -Force | Out-Null\n\nFunction Search-Files {\n  param (\n    [string]$directory\n  )\n  $files = Get-ChildItem -Path $directory -File -Recurse | Where-Object {\n    $fileExtensions -contains $_.Extension.ToLower()\n  }\n  return $files\n}\n\n$foundFiles = Search-Files -directory $startingDirectory\nif ($foundFiles.Count -gt 0) {\n  $foundFilePaths = $foundFiles.FullName\n  Compress-Archive -Path $foundFilePaths -DestinationPath \"$outputZip\\data.zip\"\n\n  Write-Host \"Zip file created: $outputZip\\data.zip\"\n  } else {\n      Write-Host \"No files found with the specified extensions.\"\n  }\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "ad822f2c-5d3c-4da8-859b-a8e04662712a",
      "type": "execute-command",
      "data": {
        "command": "Remove-Item -Path  $outputZip\\data.zip -Force\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "4a6f0b80-6b6e-424f-9aef-faff10203044",
      "p": "on-success",
      "o": "ad822f2c-5d3c-4da8-859b-a8e04662712a"
    },
    {
      "s": "4a6f0b80-6b6e-424f-9aef-faff10203044",
      "p": "on-failure",
      "o": "ad822f2c-5d3c-4da8-859b-a8e04662712a"
    }
  ],
  "tags": [
    "T1005",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "starting_directory",
      "type": "Path",
      "description": "Path to starting directory for the search",
      "value": "C:\\Users"
    },
    {
      "name": "output_zip_folder_path",
      "type": "Path",
      "description": "Path to directory for saving the generated zip file",
      "value": "PathToAtomicsFolder\\..\\ExternalPayloads\\T1005"
    },
    {
      "name": "file_extensions",
      "type": "string",
      "description": "List of file extensions to be searched and zipped, separated by comma and space",
      "value": ".doc, .docx, .txt"
    }
  ]
}