{
  "id": "b1cbdf8b-6078-48f5-a890-11ea19d7f8e9",
  "name": "Packet Capture Linux socket AF_PACKET,SOCK_RAW with BPF filter for UDP with sudo",
  "description": "Captures packets with domain=AF_PACKET,type=SOCK_RAW for a few seconds.\nSets a BPF filter on the socket to filter for UDP traffic.\n",
  "platforms": [
    "linux"
  ],
  "steps": [
    {
      "id": "bb11aaaf-f43e-44e2-afd7-d9f7918359ca",
      "type": "execute-command",
      "data": {
        "command": "sudo #{program_path} -a -f -t 3\n",
        "command_type": "bash"
      },
      "elevation_required": false
    },
    {
      "id": "ae2ef281-f912-4d59-9450-27ffdd5cb57e",
      "type": "execute-command",
      "data": {
        "command": "rm -f #{program_path}\n",
        "command_type": "bash"
      },
      "elevation_required": false
    },
    {
      "id": "c73cd9c0-e2d8-4f7f-bebd-de9c9576865f",
      "name": "Check dependency 1/1",
      "description": "compile C program\n",
      "type": "execute-command",
      "data": {
        "command": "if [ -f \"#{program_path}\" ]; then exit 0; else exit 1; fi\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "c5d9d1a6-fb4a-4b34-ae40-d6be84a5fa92",
      "name": "Resolve dependency 1/1",
      "description": "compile C program\n",
      "type": "execute-command",
      "data": {
        "command": "cc #{csource_path} -o #{program_path}\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "d07d1019-e0c7-4454-a97c-821b149f5a94",
      "name": "Re-check dependency 1/1",
      "description": "compile C program\n",
      "type": "execute-command",
      "data": {
        "command": "if [ -f \"#{program_path}\" ]; then exit 0; else exit 1; fi\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "bb11aaaf-f43e-44e2-afd7-d9f7918359ca",
      "p": "on-success",
      "o": "ae2ef281-f912-4d59-9450-27ffdd5cb57e"
    },
    {
      "s": "bb11aaaf-f43e-44e2-afd7-d9f7918359ca",
      "p": "on-failure",
      "o": "ae2ef281-f912-4d59-9450-27ffdd5cb57e"
    },
    {
      "s": "c73cd9c0-e2d8-4f7f-bebd-de9c9576865f",
      "p": "on-success",
      "o": "bb11aaaf-f43e-44e2-afd7-d9f7918359ca"
    },
    {
      "s": "c73cd9c0-e2d8-4f7f-bebd-de9c9576865f",
      "p": "on-failure",
      "o": "c5d9d1a6-fb4a-4b34-ae40-d6be84a5fa92"
    },
    {
      "s": "c5d9d1a6-fb4a-4b34-ae40-d6be84a5fa92",
      "p": "on-success",
      "o": "d07d1019-e0c7-4454-a97c-821b149f5a94"
    },
    {
      "s": "d07d1019-e0c7-4454-a97c-821b149f5a94",
      "p": "on-failure",
      "o": "bb11aaaf-f43e-44e2-afd7-d9f7918359ca"
    }
  ],
  "tags": [
    "T1040",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "csource_path",
      "type": "string",
      "description": "Path to C program source",
      "value": "PathToAtomicsFolder/T1040/src/linux_pcapdemo.c"
    },
    {
      "name": "program_path",
      "type": "string",
      "description": "Path to compiled C program",
      "value": "/tmp/t1040_linux_pcapdemo"
    }
  ]
}