{
  "id": "89422c87-b57b-4a04-a8ca-802bb9d06121",
  "name": "AWS - CloudWatch Log Group Deletes",
  "description": "Creates a new cloudWatch log group in AWS, Upon successful creation it will Delete the group. Attackers can use this technique to evade defenses by \ndeleting the log stream. Once it is deleted, the logs created by the attackers will not be logged. https://www.elastic.co/guide/en/security/current/aws-cloudwatch-log-group-deletion.html#aws-cloudwatch-log-group-deletion\n",
  "platforms": [
    "iaas:aws"
  ],
  "steps": [
    {
      "id": "9b16fb24-bb67-4371-aa7a-4822695566b5",
      "type": "execute-command",
      "data": {
        "command": "aws logs create-log-group --log-group-name #{cloudwatch_log_group_name} --region #{region} --output json\necho \"*** Log Group Created ***\"\naws logs delete-log-group --log-group-name #{cloudwatch_log_group_name} --region #{region} --output json\necho \"*** Log Group Deleted ***\"",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "e1690814-7477-47b0-a266-d6fca53b1fb1",
      "name": "Check dependency 1/1",
      "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
      "type": "execute-command",
      "data": {
        "command": "cat ~/.aws/credentials | grep \"default\"",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "90d0209a-0cd9-4caa-8644-9b4896b9ec06",
      "name": "Resolve dependency 1/1",
      "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
      "type": "execute-command",
      "data": {
        "command": "echo Please install the aws-cli and configure your AWS defult profile using: aws configure",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "826fbc65-e0d1-4d4a-af59-8e6cd5987166",
      "name": "Re-check dependency 1/1",
      "description": "Check if ~/.aws/credentials file has a default stanza is configured\n",
      "type": "execute-command",
      "data": {
        "command": "cat ~/.aws/credentials | grep \"default\"",
        "command_type": "sh"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "e1690814-7477-47b0-a266-d6fca53b1fb1",
      "p": "on-success",
      "o": "9b16fb24-bb67-4371-aa7a-4822695566b5"
    },
    {
      "s": "e1690814-7477-47b0-a266-d6fca53b1fb1",
      "p": "on-failure",
      "o": "90d0209a-0cd9-4caa-8644-9b4896b9ec06"
    },
    {
      "s": "90d0209a-0cd9-4caa-8644-9b4896b9ec06",
      "p": "on-success",
      "o": "826fbc65-e0d1-4d4a-af59-8e6cd5987166"
    },
    {
      "s": "826fbc65-e0d1-4d4a-af59-8e6cd5987166",
      "p": "on-failure",
      "o": "9b16fb24-bb67-4371-aa7a-4822695566b5"
    }
  ],
  "tags": [
    "T1562",
    "T1562.008"
  ],
  "input_arguments": [
    {
      "name": "cloudwatch_log_group_name",
      "type": "string",
      "description": "Name of the cloudWatch log group",
      "value": "log-test"
    },
    {
      "name": "region",
      "type": "string",
      "description": "Name of the region",
      "value": "us-east-1"
    }
  ]
}