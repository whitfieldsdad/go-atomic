{
  "id": "4ac71389-40f4-448a-b73f-754346b3f928",
  "name": "GCP - Delete Bucket",
  "description": "This Atomic will create a Google Storage Bucket then delete it. The idea for this Atomic came from a Rule published by the Elastic team.\n\nIdentifies when a Google Cloud Platform (GCP) storage bucket is deleted. An adversary may delete a storage bucket in order to disrupt their target's business operations.\nThis atomic will create a bucket then delete the bucket.\n\nReference: https://github.com/elastic/detection-rules/blob/main/rules/integrations/gcp/impact_gcp_storage_bucket_deleted.toml\n",
  "platforms": [
    "iaas:gcp"
  ],
  "steps": [
    {
      "id": "11660002-5df1-4203-8a50-760465b3a553",
      "type": "execute-command",
      "data": {
        "command": "gcloud config set project #{project_id}\ngcloud storage buckets delete gs://#{bucket_name}\n",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "3d528e92-5538-4666-b5e8-0087503f48ec",
      "type": "execute-command",
      "data": {
        "command": "cd \"$PathToAtomicsFolder/T1485/src/T1485-4/\"\nterraform state rm google_storage_bucket.bucket\nterraform destroy -auto-approve\n",
        "command_type": "sh"
      },
      "elevation_required": false
    },
    {
      "id": "084abde5-9afa-404c-9ef1-c2213f9781ef",
      "name": "Check dependency 1/4",
      "description": "Requires gcloud\n",
      "type": "execute-command",
      "data": {
        "command": "if [ -x \"$(command -v gcloud)\" ]; then exit 0; else exit 1; fi;\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "3cc69684-093d-4a6f-9016-8eea2e4b06da",
      "name": "Resolve dependency 1/4",
      "description": "Requires gcloud\n",
      "type": "execute-command",
      "data": {
        "command": "echo \"Please Install Google Cloud SDK before running this atomic test : https://cloud.google.com/sdk/docs/install\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "c6d304de-f286-4864-8af6-f7694423b658",
      "name": "Re-check dependency 1/4",
      "description": "Requires gcloud\n",
      "type": "execute-command",
      "data": {
        "command": "if [ -x \"$(command -v gcloud)\" ]; then exit 0; else exit 1; fi;\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "0791b7ae-d375-4c8b-a36e-6e884124b739",
      "name": "Check dependency 2/4",
      "description": "Check if user is logged in \n",
      "type": "execute-command",
      "data": {
        "command": "gcloud config get-value account\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "9177e1a6-e68d-44d6-bcb8-6ac753b3f1c4",
      "name": "Resolve dependency 2/4",
      "description": "Check if user is logged in \n",
      "type": "execute-command",
      "data": {
        "command": "gcloud auth login --no-launch-browser\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "954c8088-488b-466e-a742-f0ef485fd665",
      "name": "Re-check dependency 2/4",
      "description": "Check if user is logged in \n",
      "type": "execute-command",
      "data": {
        "command": "gcloud config get-value account\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "041690ab-5ea0-424e-a7c8-10ce32dbcb1b",
      "name": "Check dependency 3/4",
      "description": "Check if terraform is installed.\n",
      "type": "execute-command",
      "data": {
        "command": "terraform version\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "db4990bb-7245-4974-85fb-49e488e5b801",
      "name": "Resolve dependency 3/4",
      "description": "Check if terraform is installed.\n",
      "type": "execute-command",
      "data": {
        "command": "echo Please install the terraform.\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "2261d03a-5751-4ef2-ad14-f0820b7540dd",
      "name": "Re-check dependency 3/4",
      "description": "Check if terraform is installed.\n",
      "type": "execute-command",
      "data": {
        "command": "terraform version\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "48716942-a668-4866-b196-27f7e8e7fa25",
      "name": "Check dependency 4/4",
      "description": "Create dependency resources using terraform\n",
      "type": "execute-command",
      "data": {
        "command": "stat \"$PathToAtomicsFolder/T1485/src/T1485-4/terraform.tfstate\"\n",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "9d592acd-bc54-4926-a24c-16331ee243cf",
      "name": "Resolve dependency 4/4",
      "description": "Create dependency resources using terraform\n",
      "type": "execute-command",
      "data": {
        "command": "cd \"$PathToAtomicsFolder/T1485/src/T1485-4/\"\nterraform init\nterraform apply -auto-approve",
        "command_type": ""
      },
      "elevation_required": false
    },
    {
      "id": "ffbefa82-b6e6-45af-8cf0-dbf6ee7c875d",
      "name": "Re-check dependency 4/4",
      "description": "Create dependency resources using terraform\n",
      "type": "execute-command",
      "data": {
        "command": "stat \"$PathToAtomicsFolder/T1485/src/T1485-4/terraform.tfstate\"\n",
        "command_type": ""
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "11660002-5df1-4203-8a50-760465b3a553",
      "p": "on-success",
      "o": "3d528e92-5538-4666-b5e8-0087503f48ec"
    },
    {
      "s": "11660002-5df1-4203-8a50-760465b3a553",
      "p": "on-failure",
      "o": "3d528e92-5538-4666-b5e8-0087503f48ec"
    },
    {
      "s": "084abde5-9afa-404c-9ef1-c2213f9781ef",
      "p": "on-success",
      "o": "11660002-5df1-4203-8a50-760465b3a553"
    },
    {
      "s": "084abde5-9afa-404c-9ef1-c2213f9781ef",
      "p": "on-failure",
      "o": "3cc69684-093d-4a6f-9016-8eea2e4b06da"
    },
    {
      "s": "3cc69684-093d-4a6f-9016-8eea2e4b06da",
      "p": "on-success",
      "o": "c6d304de-f286-4864-8af6-f7694423b658"
    },
    {
      "s": "c6d304de-f286-4864-8af6-f7694423b658",
      "p": "on-failure",
      "o": "11660002-5df1-4203-8a50-760465b3a553"
    },
    {
      "s": "0791b7ae-d375-4c8b-a36e-6e884124b739",
      "p": "on-success",
      "o": "11660002-5df1-4203-8a50-760465b3a553"
    },
    {
      "s": "0791b7ae-d375-4c8b-a36e-6e884124b739",
      "p": "on-failure",
      "o": "9177e1a6-e68d-44d6-bcb8-6ac753b3f1c4"
    },
    {
      "s": "9177e1a6-e68d-44d6-bcb8-6ac753b3f1c4",
      "p": "on-success",
      "o": "954c8088-488b-466e-a742-f0ef485fd665"
    },
    {
      "s": "954c8088-488b-466e-a742-f0ef485fd665",
      "p": "on-failure",
      "o": "11660002-5df1-4203-8a50-760465b3a553"
    },
    {
      "s": "041690ab-5ea0-424e-a7c8-10ce32dbcb1b",
      "p": "on-success",
      "o": "11660002-5df1-4203-8a50-760465b3a553"
    },
    {
      "s": "041690ab-5ea0-424e-a7c8-10ce32dbcb1b",
      "p": "on-failure",
      "o": "db4990bb-7245-4974-85fb-49e488e5b801"
    },
    {
      "s": "db4990bb-7245-4974-85fb-49e488e5b801",
      "p": "on-success",
      "o": "2261d03a-5751-4ef2-ad14-f0820b7540dd"
    },
    {
      "s": "2261d03a-5751-4ef2-ad14-f0820b7540dd",
      "p": "on-failure",
      "o": "11660002-5df1-4203-8a50-760465b3a553"
    },
    {
      "s": "48716942-a668-4866-b196-27f7e8e7fa25",
      "p": "on-success",
      "o": "11660002-5df1-4203-8a50-760465b3a553"
    },
    {
      "s": "48716942-a668-4866-b196-27f7e8e7fa25",
      "p": "on-failure",
      "o": "9d592acd-bc54-4926-a24c-16331ee243cf"
    },
    {
      "s": "9d592acd-bc54-4926-a24c-16331ee243cf",
      "p": "on-success",
      "o": "ffbefa82-b6e6-45af-8cf0-dbf6ee7c875d"
    },
    {
      "s": "ffbefa82-b6e6-45af-8cf0-dbf6ee7c875d",
      "p": "on-failure",
      "o": "11660002-5df1-4203-8a50-760465b3a553"
    }
  ],
  "tags": [
    "T1485",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "project_id",
      "type": "string",
      "description": "ID of the GCP Project you to execute the command against.",
      "value": "atomic-test-1"
    },
    {
      "name": "bucket_name",
      "type": "string",
      "description": "The name of the bucket to delete.",
      "value": "atomic-red-team-bucket"
    }
  ]
}