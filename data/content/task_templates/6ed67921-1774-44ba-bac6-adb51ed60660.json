{
  "id": "6ed67921-1774-44ba-bac6-adb51ed60660",
  "name": "Copy a sensitive File over Administrative share with copy",
  "description": "Copy from sensitive File from the c$ of another LAN computer with copy cmd\nhttps://twitter.com/SBousseaden/status/1211636381086339073",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "1c77dd12-708f-43a5-82e6-433779a9192f",
      "type": "execute-command",
      "data": {
        "command": "copy \\\\#{remote}\\C$\\#{share_file} %TEMP%\\#{local_file}",
        "command_type": "command_prompt"
      },
      "elevation_required": true
    },
    {
      "id": "207bcc7b-b915-4f1c-b494-fd99b0d0d8c5",
      "type": "execute-command",
      "data": {
        "command": "del \\\\#{remote}\\C$\\#{share_file}\ndel %TEMP%\\#{local_file}",
        "command_type": "command_prompt"
      },
      "elevation_required": true
    },
    {
      "id": "a84ccd26-5a52-4ecb-b6e8-fa8586c36ce8",
      "name": "Check dependency 1/2",
      "description": "Administrative share must exist on #{remote}\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"\\\\#{remote}\\C$\") {exit 0} else {exit 1}",
        "command_type": "command_prompt"
      },
      "elevation_required": true
    },
    {
      "id": "75ee69c9-1318-4ca1-ae21-a873cf6a2db5",
      "name": "Resolve dependency 1/2",
      "description": "Administrative share must exist on #{remote}\n",
      "type": "execute-command",
      "data": {
        "command": "Write-Host 'Please Enable \"C$\" share on #{remote}'",
        "command_type": "command_prompt"
      },
      "elevation_required": true
    },
    {
      "id": "0a4dbe79-cf3b-4880-b691-3085613ce961",
      "name": "Re-check dependency 1/2",
      "description": "Administrative share must exist on #{remote}\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"\\\\#{remote}\\C$\") {exit 0} else {exit 1}",
        "command_type": "command_prompt"
      },
      "elevation_required": true
    },
    {
      "id": "189ba513-aeb4-46c9-a0c6-8fae3e194bae",
      "name": "Check dependency 2/2",
      "description": "\"\\\\#{remote}\\C$\\#{share_file}\" must exist on #{remote}\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"\\\\#{remote}\\C$\\#{share_file}\") {exit 0} else {exit 1}",
        "command_type": "command_prompt"
      },
      "elevation_required": true
    },
    {
      "id": "ef516e8d-0249-4f1b-aa8d-faf1d7b3a288",
      "name": "Resolve dependency 2/2",
      "description": "\"\\\\#{remote}\\C$\\#{share_file}\" must exist on #{remote}\n",
      "type": "execute-command",
      "data": {
        "command": "Out-File -FilePath \"\\\\#{remote}\\C$\\#{share_file}\"",
        "command_type": "command_prompt"
      },
      "elevation_required": true
    },
    {
      "id": "7a65f8ca-c996-4276-96f2-304d194efd4a",
      "name": "Re-check dependency 2/2",
      "description": "\"\\\\#{remote}\\C$\\#{share_file}\" must exist on #{remote}\n",
      "type": "execute-command",
      "data": {
        "command": "if (Test-Path \"\\\\#{remote}\\C$\\#{share_file}\") {exit 0} else {exit 1}",
        "command_type": "command_prompt"
      },
      "elevation_required": true
    }
  ],
  "flows": [
    {
      "s": "1c77dd12-708f-43a5-82e6-433779a9192f",
      "p": "on-success",
      "o": "207bcc7b-b915-4f1c-b494-fd99b0d0d8c5"
    },
    {
      "s": "1c77dd12-708f-43a5-82e6-433779a9192f",
      "p": "on-failure",
      "o": "207bcc7b-b915-4f1c-b494-fd99b0d0d8c5"
    },
    {
      "s": "a84ccd26-5a52-4ecb-b6e8-fa8586c36ce8",
      "p": "on-success",
      "o": "1c77dd12-708f-43a5-82e6-433779a9192f"
    },
    {
      "s": "a84ccd26-5a52-4ecb-b6e8-fa8586c36ce8",
      "p": "on-failure",
      "o": "75ee69c9-1318-4ca1-ae21-a873cf6a2db5"
    },
    {
      "s": "75ee69c9-1318-4ca1-ae21-a873cf6a2db5",
      "p": "on-success",
      "o": "0a4dbe79-cf3b-4880-b691-3085613ce961"
    },
    {
      "s": "0a4dbe79-cf3b-4880-b691-3085613ce961",
      "p": "on-failure",
      "o": "1c77dd12-708f-43a5-82e6-433779a9192f"
    },
    {
      "s": "189ba513-aeb4-46c9-a0c6-8fae3e194bae",
      "p": "on-success",
      "o": "1c77dd12-708f-43a5-82e6-433779a9192f"
    },
    {
      "s": "189ba513-aeb4-46c9-a0c6-8fae3e194bae",
      "p": "on-failure",
      "o": "ef516e8d-0249-4f1b-aa8d-faf1d7b3a288"
    },
    {
      "s": "ef516e8d-0249-4f1b-aa8d-faf1d7b3a288",
      "p": "on-success",
      "o": "7a65f8ca-c996-4276-96f2-304d194efd4a"
    },
    {
      "s": "7a65f8ca-c996-4276-96f2-304d194efd4a",
      "p": "on-failure",
      "o": "1c77dd12-708f-43a5-82e6-433779a9192f"
    }
  ],
  "tags": [
    "T1039"
  ],
  "input_arguments": [
    {
      "name": "remote",
      "type": "string",
      "description": "Remote server name",
      "value": "127.0.0.1"
    },
    {
      "name": "share_file",
      "type": "path",
      "description": "Remote Path to the file",
      "value": "Windows\\temp\\Easter_Bunny.password"
    },
    {
      "name": "local_file",
      "type": "string",
      "description": "Local name",
      "value": "Easter_egg.password"
    }
  ]
}